(function(n,j){var a=(function(){var X=function(){if(arguments.length==0){return}var ac=arguments;var ae=" "+String(arguments[0]);var ad=1;ae=ae.replace(/([^\\])\{\}/g,function(ag,ah){var af=(ac.length-1)<ad?"{}":String(V(ac[ad]));ad++;return ah+af});ae=ae.replace(/\\\{\}/g,"{}");return ae.substring(1)};var Z=function(){var af=new Date();var ah=af.getFullYear();var ag="0"+String(af.getMonth()+1);ag=ag.substring(ag.length-2);var ac="0"+String(af.getDate());ac=ac.substring(ac.length-2);var ad="0"+String(af.getHours());ad=ad.substring(ad.length-2);var ai="0"+String(af.getMinutes());ai=ai.substring(ai.length-2);var ae="0"+String(af.getSeconds());ae=ae.substring(ae.length-2);return ag+ac+" "+ad+":"+ai+":"+ae};var V=function(ae){if(null==ae){return null}if((typeof ae=="number")||(typeof ae=="string")||(typeof ae=="boolean")){return ae}else{if(typeof ae=="function"){return"function "+ae.name+"(){...}"}else{if(!(ae instanceof Array)&&(typeof ae=="object")){if(String(ae)!="[object Object]"){return String(ae)}else{try{var ad={};for(var af in ae){ad[af]=V(ae[af])}return JSON.stringify(ad)}catch(ac){return String(ae)}}}else{if(ae instanceof Array){return JSON.stringify(ae.map(function(ag){return V(ag)}))}else{return ae}}}}};var U=function(ac){return Z()+" ["+ac+"]: "};var aa={};var T,Y;(function(){var ac=true;T=function(){return ac};Y=function(ad){ac=ad}})();var ab=function(ad){var ac=true;this.isEnabled=function(){return T()&&ac};this.setIsEnabled=function(ae){ac=ae;return this};this.getName=function(){return ad};this.debug=function(){if(!this.isEnabled()){return}var ae=X.apply(null,arguments);console.debug(U(ad)+ae)};this.info=function(){if(!this.isEnabled()){return}var ae=X.apply(null,arguments);console.info(U(ad)+ae)};this.warn=function(){if(!this.isEnabled()){return}var ae=X.apply(null,arguments);console.warn(U(ad)+ae)};this.error=function(){if(!this.isEnabled()){return}var ae=X.apply(null,arguments);console.error(U(ad)+ae)};this.log=function(){if(!this.isEnabled()){return}var ae=X.apply(null,arguments);console.log(U(ad)+ae)}};var W=function(ac){if(ac in aa){return aa[ac]}var ad=new ab(ac);aa[ac]=ad;return ad};ab.ofName=W;ab.isGloballyEnabled=T;ab.setIsGloballyEnabled=Y;return ab})();var L=(function(){var W="  __com.soft.plugin.touch#"+new Date().getTime()+"__  ";var U=function(Z,Y){Z=Z||{};Y=Y||{};for(var aa in Y){if(!(aa in Z)){Z[aa]=Y[aa]}}return Z};var X=function(Z,Y){Z=Z||{};Z[Y]=Z[Y]||{};return Z[Y]};var V=function(ab,ac,Z){if(!d){ab.addEventListener?ab.addEventListener("click",ac):ab.attachEvent("onclick",ac);return}var aa=X(ab,W+".tap");aa.callbacks=aa.callbacks||[];if(aa.callbacks.indexOf(ac)!=-1){return}aa.callbacks.push(ac);Z=U(Z,{timespan:500,delta:{},useCapture:false});Z.delta=U(Z.delta,{x:10,y:15});var Y=X(ab,W+".tap.meta");if(null==Y.touchstart){Y.touchstart=function(ad){var ae=ad.changedTouches?ad.changedTouches[0]:ad;aa.startX=ae.screenX;aa.startY=ae.screenY;aa.startTimestamp=Date.now()};ab.addEventListener("touchstart",Y.touchstart)}if(null==Y.touchend){Y.touchend=function(af){var ah=af.changedTouches?af.changedTouches[0]:af;aa.stopX=ah.screenX;aa.stopY=ah.screenY;aa.stopTimestamp=Date.now();var ag=aa.stopTimestamp-aa.startTimestamp,ae=Math.abs(aa.stopX-aa.startX),ad=Math.abs(aa.stopY-aa.startY);if(ag<=Z.timespan&&ae<=Z.delta.x&&ad<=Z.delta.y){aa.callbacks.forEach(function(ai){ai&&ai.call(ab,af)})}};ab.addEventListener("touchend",Y.touchend,Z.useCapture)}};var T=function(ac,ad,Y){if(!d){ac.removeEventListener?ac.removeEventListener("click",ad):ac.detachEvent("onclick",ad);return}if(!ac.hasOwnProperty(W)){return}var ab=X(ac,W+".tap");var aa=ab.callbacks.indexOf(ad);if(aa==-1){return}ab.callbacks.splice(aa,1);if(ab.callbacks.length==0){var Z=X(ac,W+".tap.meta");ac.removeEventListener("touchstart",Z.touchstart);ac.removeEventListener("touchend",Z.touchend,Y);delete ac[W].tap}};return{addTapListener:V,removeTapListener:T}})();var v=function(U,T,W){if(arguments.length<3){W=false}U=U||{};T=T||{};for(var V in T){if(!(V in U)||(V in U&&null==U[V]&&W)){U[V]=T[V]}}return U};var F=(function(){var T=function(U,V){this.type=U;this.timestamp=new Date().getTime();this.data=V;Object.freeze&&Object.freeze(this)};return function(V,U){(function(Y,W){var X={};Y.on=function(aa,Z){aa=aa.toLowerCase();X[aa]=X[aa]||[];if(X[aa].indexOf(Z)!=-1){return}X[aa].push(Z)};Y.off=function(ab,aa){ab=ab.toLowerCase();X[ab]=X[ab]||[];var Z=X[ab].indexOf(aa);if(Z==-1){return}X[ab].splice(Z,1)};Y.fire=function(Z,ab){Z=Z.toLowerCase();var aa=new T(Z,ab);X[Z]=X[Z]||[];X[Z].forEach(function(ac){ac.call(W,aa)})}})(V,U)}})();var o=function(U,T,V){Object.defineProperty(U,T,{value:V,configurable:false,writable:false,enumerable:true})};var A=function(V,T,U){if(null==V||typeof V!="function"){return}try{V.apply(T,U)}catch(W){m.error("Error occured while executing function: {}. {}",V.name,W)}};var g=function(U,T){if(arguments.length<2){T=false}if(null===U||undefined===U){return true}U=String(U);if(T){U=U.trim()}return U.length==0};var f=/mobile|tablet|ip(ad|hone|od)|android/i,J=("ontouchstart" in window),d=f.test(navigator.userAgent);
var b=new Object();var r=":back",I=":forward";var m=a.ofName("View");var Q=[];var N=null;var R=("pushState" in history)&&(typeof history.pushState=="function");m.log("History pushState is "+(R?"":"not ")+"supported");var K=[];var i={};var G=function(T){return r==T||I==T};var x=function(T,U,V){if(!P.ifExists(T)&&!G(T)){throw new s("View of id: "+T+" does not exist.")}if(arguments.length<3){throw new Error("Invalid argument length. Both parameter name and value should be specified.")}i[T]=i[T]||{};i[T][String(U)]=V;return P};var u=function(T,U){if(!P.ifExists(T)&&!G(T)){throw new s("View of id: "+T+" does not exist.")}if(undefined===U){U=null}if(typeof U!="object"){throw new Error("Parameters specified should be an object or null.")}i[T]=U;return P};var O=function(T){delete i[T];return P};var k=function(T,V,U){if(arguments.length<3){U=null}if(arguments.length<2){V=Date.now()}o(this,"viewId",T);o(this,"timestamp",V);o(this,"options",U);this.toString=function(){return JSON.stringify(this)};this.clone=function(){return JSON.parse(this.toString())}};k.isConstructorOf=function(T){if(null==T||typeof T!="object"){return false}return T.hasOwnProperty("viewId")&&T.hasOwnProperty("timestamp")};var S=function(T){return encodeURIComponent(String(T)).replace(/\+/gm,"%2B")};var H=function(U,W){var V="!";var Y=String(U);var T=null==W?[]:Object.keys(W);var X=T.reduce(function(ac,ab,aa,Z){return ac+"&"+S(ab)+"="+S(W[ab])},"");if(X.length>0){Y+=V+X.substring(1)}return Y};var z=function(T,W,U){if(arguments.length<3){U=null}if(arguments.length<2){W=Date.now()}var V=new k(T,W,U).clone();m.log("↓ {}",JSON.stringify(V));if(R){history.pushState(V,"","#"+H(T,U))}else{location.hash=H(T,U)}P.currentState=V};var q=function(T,W,U){if(arguments.length<3){U=null}if(arguments.length<2){W=Date.now()}var V=new k(T,W,U).clone();m.log("% {}",JSON.stringify(V));if(R){history.replaceState(V,"","#"+H(T,U))}else{location.hash=H(T,U)}P.currentState=V};var s=function s(T){Error.call(this,T)};s.prototype=Object.create(Error.prototype);var C=function C(T){var V=T,W,U;this.getName=function(){return V};this.getValue=function(){return W};this.setValue=function(X){W=X;return this};this.getApplication=function(){return U};this.setApplication=function(X){U=X;return this};this.apply=function(){if(typeof U=="function"){U(W)}return this};Object.freeze(this)};var t=function t(){var T={};this.has=function(U){return U in T};this.get=function(U){var V;if(U in T){V=T[U]}else{V=new C(U);T[U]=V}return V};this.applyAll=function(){var U=Object.values(T);if(0!=U.length){setTimeout(function(){U.forEach(function(W){try{W.apply()}catch(V){console.error(V)}})},0)}};this.listAll=function(){return Object.keys(T)}};var w=function w(){var T={};o(this,"has",function(U){return U in T});o(this,"set",function(U,V){T[U]=V;return this});o(this,"get",function(U){return T[U]});o(this,"clear",function(){T={};return this})};var P=function(X){if(null===document.querySelector("#"+X+"[data-view=true]")){throw new s("View of id: "+X+" does not exist(No element matching pattern: '#"+X+"[data-view=true]' found)!")}var V={};var T=new w();var W=new t();F(this,document.querySelector("#"+X));var U=this.fire;this.fire=function(Y,Z){V[Y]=Z;U(Y,Z)};o(this,"logger",a.ofName("View#"+X));o(this,"config",W);o(this,"context",T);this.getLatestEventData=function(Y){return V[Y]};this.getContext=function(){return T};this.clearContext=function(){T.clear();return this};this.getId=function(){return X};this.getDomElement=function(){return document.querySelector("#"+X)};this.find=function(Y){return this.getDomElement().querySelector(Y)};this.findAll=function(Y){return this.getDomElement().querySelectorAll(Y)};this.getParameter=function(Y){var Z=i[this.getId()];if(arguments.length<1){return Z}return null==Z?null:Z[Y]};this.isReady=function(){return K.indexOf(this.getId())!=-1};this.isActive=function(){return this.getDomElement().classList.contains("active")};this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))};this.isDirectlyAccessible=function(){var Z=document.documentElement.getAttribute("data-view-directly-accessible");Z=null==Z?"false":Z;Z=Z.toLowerCase();var Y=false;if("true"==Z){if("false"==this.getDomElement().getAttribute("data-view-directly-accessible")){Y=false}else{Y=true}}else{if("true"==this.getDomElement().getAttribute("data-view-directly-accessible")){Y=true}else{Y=false}}return Y};this.getFallbackView=function(){var Y=this;var aa=[this.getId()];do{var Z=Y.getDomElement().getAttribute("data-view-fallback");if(null==Z||!P.ifExists(Z)){m.warn("View: "+Y.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view");return P.getDefaultView()}else{Y=P.ofId(Z);if(aa.indexOf(Y.getId())!=-1){m.error("Cyclical reference of view on fallback configuration on view: {}. Chain: {}, view id: {}",this.getId(),aa,Y.getId());return P.getDefaultView()}if(Y.isDirectlyAccessible()){return Y}aa.push(Z)}}while(true)};Object.freeze&&Object.freeze(this)
};P.SWITCHTYPE_HISTORYFORWARD="history.forward";P.SWITCHTYPE_HISTORYBACK="history.back";P.SWITCHTYPE_VIEWSWITCH="view.switch";P.Logger=a;P.currentState=null;F(P);P.ofId=function(V){for(var U=0;U<Q.length;U++){if(Q[U].getId().trim()==V.trim()){return Q[U]}}var T=new P(V);Q.push(T);return T};P.ifExists=function(U){for(var T=0;T<Q.length;T++){if(Q[T].getId().trim()==U.trim()){return true}}return false};P.isExisting=P.ifExists;P.listAll=function(){return[].concat(Q)};P.getActiveView=function(){for(var T=0;T<Q.length;T++){if(Q[T].isActive()){return Q[T]}}return null};P.getDefaultView=function(){for(var T=0;T<Q.length;T++){if(Q[T].isDefault()){return Q[T]}}return null};P.setSwitchAnimation=function(T){if(!(T instanceof Function)){throw new Error("Invalid argument. Animation of Function is needed.")}N=T;return P};P.getSwitchAnimation=function(){return N};var l=function(Y){if(""==Y){return null}var X=/^#([\w\$]+)(?:!+(.*))?/;var U=Y.match(X);if(null==U){return null}var T=U[1],W=null;if(null!=U[2]&&""!=U[2].trim()){var V=U[2].split(/\s*&\s*/);if(0!=V.length){W={};V.forEach(function(aa){var Z=aa.split(/\s*=\s*/);W[decodeURIComponent(Z[0])]=decodeURIComponent(Z[1])})}}return{viewId:U[1],options:W}};P.getActiveViewOptions=function(){var T=l(location.hash);return null==T?null:T.options};var y=function(V){V=v(V,{srcView:null,targetView:null,type:P.SWITCHTYPE_VIEWSWITCH,withAnimation:true,params:null});var ab=V.srcView,T=V.targetView,Z=V.type,W=V.params;if(null==Z){Z=P.SWITCHTYPE_VIEWSWITCH}var ac=Z.toLowerCase()==P.SWITCHTYPE_HISTORYBACK,aa=Z.toLowerCase()==P.SWITCHTYPE_HISTORYFORWARD;if(!ac&&!aa){Z=P.SWITCHTYPE_VIEWSWITCH}P.fire("beforechange",{currentView:ab,targetView:T,type:Z,params:W});ab&&ab.fire("leave",{targetView:T,type:Z});var Y=function(){ab&&ab.getDomElement().classList.remove("active");T.getDomElement().classList.add("active")};var X=function(){var ad=T.getId();O(ad);if(ac){if(r in i){u(ad,i[r]);delete i[r]}}else{if(aa){if(I in i){u(ad,i[I]);delete i[I]}}else{u(ad,W)}}var ae={sourceView:ab,type:Z,params:W};if(!T.isReady()){K.push(ad);T.fire("ready",ae)}["beforeenter","enter","afterenter"].forEach(function(af){T.fire(af,ae)})};var U=function(){Y();X()};if(!V.withAnimation){U()}else{if(N){N.call(null,ab?ab.getDomElement():null,T.getDomElement(),Z,U)}else{U()}}P.fire("afterchange",{currentView:ab,targetView:T,type:Z,params:W})};var B=function(T,V){V=v(V,{type:P.SWITCHTYPE_VIEWSWITCH},true);if(!P.ifExists(T)){throw new Error("Target view: "+T+" does not exist!")}var W=P.getActiveView();if(W.getId().toLowerCase()==T.toLowerCase()){return P}m.log("{} → {} {}",W.getId(),T,JSON.stringify(V));var U=P.ofId(T);V.srcView=W;V.targetView=U;y(V);return P};P.show=B;P.switchTo=function(T,V,U,W){if(arguments.length<4){W=null}if(arguments.length<3){U=true}if(arguments.length<2){V=P.SWITCHTYPE_VIEWSWITCH}V=V||P.SWITCHTYPE_VIEWSWITCH;B(T,{type:V,withAnimation:U,params:W});return P};P.switchView=P.switchTo;P.navTo=function(T,U){T=T.trim();var V=P.getActiveView();if(V.getId().toLowerCase()==T.toLowerCase()){return P}if(r==T){P.back(U);return P}if(I==T){P.forward(U);return P}B(T,U);z(T,Date.now(),null);return P};P.updateView=P.navTo;P.changeTo=function(T,U){var V=P.getActiveView();if(V.getId().toLowerCase()==T.toLowerCase()){return P}B(T,U);q(T,Date.now(),null);return P};P.back=function(T){O(r);if(null!=T&&"params" in T){u(r,T.params)}history.go(-1)};P.forward=function(T){O(I);if(null!=T&&"params" in T){u(I,T.params)}history.go(1)};var h=document.title;var E=function(T){if(g(T,true)){m.warn("Invalid document title: "+T);return P}document.title=h=T;return P};P.setDocumentTitle=E;var c;P.ready=(function(){var U=false;var T=[];c=function(){U=true;setTimeout(function(){T.forEach(function(V){A(V)})},0)};return function(V){if(U){A(V);return P}if(T.indexOf(V)!=-1){return P}T.push(V);return P}})();var e=function(){var T=P.getActiveView();if(null==T){T=P.getDefaultView()}return T};var p=function(T){var U=null;if(g(T,true)||!P.ifExists(T)){U=e()}else{U=P.ofId(T);if(!U.isDirectlyAccessible()){U=U.getFallbackView()}}return U};var D=function(Y){var aa=P.getActiveView();var V=null==aa?null:aa.getId();m.log("{} Current: {}",R?"State poped!":"Hash changed!",aa.getId());m.log("↑ {}",R?JSON.stringify(Y.state):location.hash);var ac,Z=P.SWITCHTYPE_VIEWSWITCH,ae,T=null;if(null==Y.state){Z=P.SWITCHTYPE_VIEWSWITCH;var ab=l(location.hash);ac=ab.viewId;T=p(ac);var X=T.getId();var U=X==ac,ad=X==V;ae=ad?P.currentState.options:(U?ab.options:null);q(X,Date.now(),ae)}else{var W=Y.state;ac=W.viewId;if(P.ifExists(ac)){T=P.ofId(ac);ae=W.options}else{m.warn("Poped view: "+ac+" does not exist, keeping current.");T=aa;ae=null}var X=T.getId();if(P.currentState!=null){Z=W.timestamp<P.currentState.timestamp?P.SWITCHTYPE_HISTORYBACK:P.SWITCHTYPE_HISTORYFORWARD}q(X,W.timestamp,ae)}P.show(T.getId(),{type:Z,options:ae})};var M=function(){window.addEventListener(R?"popstate":"hashchange",D);var U=document.querySelectorAll("*[data-view=true]");[].forEach.call(U,function(W){P.ofId(W.id);
W.classList.remove("active");W.classList.add("view");(function(){var Y=W.getAttribute("data-view-title");var X=P.ofId(W.id);X.on("enter",function(){document.title=null==Y?h:Y})})()});var V=null;var T=function(){var Y=null;var X=-1;for(var W=0;W<U.length;W++){if("true"==U[W].getAttribute("data-view-default")){X=W;break}}if(-1!=X){Y=U[X];for(var W=X+1;W<U.length;W++){if("true"==U[W].getAttribute("data-view-default")){U[W].removeAttribute("data-view-default")}}}else{if(0!=U.length){Y=U[0];Y.setAttribute("data-view-default","true")}else{m.warn("No view exists to determine the default view.")}}return Y};V=T();if(null!=V){V.classList.add("active")}(function(){var ab=null==V?null:V.id;var Z=l(location.hash);var aa=null==Z?null:Z.viewId,Y=null==Z?null:Z.options;var W=g(aa,true)?ab:aa;if(g(W,true)){m.warn("Can not determine the initial view!");return}var X=p(W);W=X.getId();if(W!=aa){Y=null}q(W,Date.now(),Y);y({srcView:P.getActiveView(),targetView:X,withAnimation:false,params:null})})();(function(){L.addTapListener(document.documentElement,function(ac){var ab=ac.changedTouches?ac.changedTouches[0].target:ac.target;var W;var aa=ab;while(null==aa.getAttribute("data-view-rel")){aa=aa.parentNode;if(!(aa instanceof HTMLElement)){aa=null}if(null==aa){break}}if(null!=aa){W=aa.getAttribute("data-view-rel")}if(null==W){return}var ad="true"==aa.getAttribute("data-view-rel-disabled");if(ad){return}ac.preventDefault();if(/^(http|https|ftp):\/\//gim.test(W)){window.location.href=W;return}if(r==W.toLowerCase().trim()){history.go(-1);return}if(I==W.toLowerCase().trim()){history.go(1);return}var Z=P.getActiveView();var X=null==Z?null:Z.getId();if(null!=X&&X==W){return}var Y=aa.getAttribute("data-view-rel-type");Y=g(Y,true)?"nav":Y;if(!/^(?:nav)|(?:change)$/.test(Y)){m.warn("Unknown view switch type: {}. {}",Y,aa);Y="nav"}P[Y+"To"](W,{type:P.SWITCHTYPE_VIEWSWITCH})},{useCapture:true})})();c()};document.addEventListener("DOMContentLoaded",M);n[j]=P})(window,"View");