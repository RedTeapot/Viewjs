(function(v,H){var z=/mobile|tablet|ip(ad|hone|od)|android/i;var A=("ontouchstart" in window);var q=z.test(navigator.userAgent);var f=new Object();var b=":back",r=":forward";var G=(function(){var M=function(){if(arguments.length==0){return}var R=arguments;var T=" "+String(arguments[0]);var S=1;T=T.replace(/([^\\])\{\}/g,function(V,W){var U=(R.length-1)<S?"{}":String(K(R[S]));S++;return W+U});T=T.replace(/\\\{\}/g,"{}");return T.substring(1)};var O=function(){var U=new Date();var W=U.getFullYear();var V="0"+String(U.getMonth()+1);V=V.substring(V.length-2);var R="0"+String(U.getDate());R=R.substring(R.length-2);var S="0"+String(U.getHours());S=S.substring(S.length-2);var X="0"+String(U.getMinutes());X=X.substring(X.length-2);var T="0"+String(U.getSeconds());T=T.substring(T.length-2);return V+R+" "+S+":"+X+":"+T};var K=function(T){if(null==T){return null}if((typeof T=="number")||(typeof T=="string")||(typeof T=="boolean")){return T}else{if(typeof T=="function"){return"function "+T.name+"(){...}"}else{if(!(T instanceof Array)&&(typeof T=="object")){if(String(T)!="[object Object]"){return String(T)}else{try{var S={};for(var U in T){S[U]=K(T[U])}return JSON.stringify(S)}catch(R){return String(T)}}}else{if(T instanceof Array){return JSON.stringify(T.map(function(V){return K(V)}))}else{return T}}}}};var J=function(R){return O()+" ["+R+"]: "};var P={};var I,N;(function(){var R=true;I=function(){return R};N=function(S){R=S}})();var Q=function(S){var R=true;this.isEnabled=function(){return I()&&R};this.setIsEnabled=function(T){R=T;return this};this.getName=function(){return S};this.debug=function(){if(!this.isEnabled()){return}var T=M.apply(null,arguments);console.debug(J(S)+T)};this.info=function(){if(!this.isEnabled()){return}var T=M.apply(null,arguments);console.info(J(S)+T)};this.warn=function(){if(!this.isEnabled()){return}var T=M.apply(null,arguments);console.warn(J(S)+T)};this.error=function(){if(!this.isEnabled()){return}var T=M.apply(null,arguments);console.error(J(S)+T)};this.log=function(){if(!this.isEnabled()){return}var T=M.apply(null,arguments);console.log(J(S)+T)}};var L=function(R){if(R in P){return P[R]}var S=new Q(R);P[R]=S;return S};Q.ofName=L;Q.isGloballyEnabled=I;Q.setIsGloballyEnabled=N;return Q})();var m=G.ofName("View");var i=(function(){var L="  __com.soft.plugin.touch#"+new Date().getTime()+"__  ";var J=function(O,N){O=O||{};N=N||{};for(var P in N){if(!(P in O)){O[P]=N[P]}}return O};var M=function(O,N){O=O||{};O[N]=O[N]||{};return O[N]};var K=function(Q,R,O){if(!q){Q.addEventListener?Q.addEventListener("click",R):Q.attachEvent("onclick",R);return}var P=M(Q,L+".tap");P.callbacks=P.callbacks||[];if(P.callbacks.indexOf(R)!=-1){return}P.callbacks.push(R);O=J(O,{timespan:500,delta:{},useCapture:false});O.delta=J(O.delta,{x:10,y:15});var N=M(Q,L+".tap.meta");if(null==N.touchstart){N.touchstart=function(S){var T=S.changedTouches?S.changedTouches[0]:S;P.startX=T.screenX;P.startY=T.screenY;P.startTimestamp=Date.now()};Q.addEventListener("touchstart",N.touchstart)}if(null==N.touchend){N.touchend=function(U){var W=U.changedTouches?U.changedTouches[0]:U;P.stopX=W.screenX;P.stopY=W.screenY;P.stopTimestamp=Date.now();var V=P.stopTimestamp-P.startTimestamp,T=Math.abs(P.stopX-P.startX),S=Math.abs(P.stopY-P.startY);if(V<=O.timespan&&T<=O.delta.x&&S<=O.delta.y){P.callbacks.forEach(function(X){X&&X.call(Q,U)})}};Q.addEventListener("touchend",N.touchend,O.useCapture)}};var I=function(R,S,N){if(!q){R.removeEventListener?R.removeEventListener("click",S):R.detachEvent("onclick",S);return}if(!R.hasOwnProperty(L)){return}var Q=M(R,L+".tap");var P=Q.callbacks.indexOf(S);if(P==-1){return}Q.callbacks.splice(P,1);if(Q.callbacks.length==0){var O=M(R,L+".tap.meta");R.removeEventListener("touchstart",O.touchstart);R.removeEventListener("touchend",O.touchend,N);delete R[L].tap}};return{addTapListener:K,removeTapListener:I}})();var C=("pushState" in history)&&(typeof history.pushState=="function");m.log("History pushState is "+(C?"":"not ")+"supported");var e=[];var w={};var a=function(I,J,K){if(!x.isExisting(I)&&b!=I&&r!=I){throw new g("View of id: "+I+" does not exist.")}if(arguments.length<3){throw new Error("Invalid argument length. Both parameter name and value should be specified.")}w[I]=w[I]||{};w[I][String(J)]=K;return x};var h=function(I,J){if(!x.isExisting(I)&&b!=I&&r!=I){throw new g("View of id: "+I+" does not exist.")}if(undefined===J){J=null}if(typeof J!="object"){throw new Error("Parameters specified should be an object or null.")}w[I]=J;return x};var k=function(I){delete w[I];return x};var d=function(J,I,L){if(arguments.length<3){L=false}J=J||{};I=I||{};for(var K in I){if(!(K in J)||(K in J&&null==J[K]&&L)){J[K]=I[K]}}return J};var u=(function(){var I=function(J,K){this.type=J;this.timestamp=new Date().getTime();this.data=K;Object.freeze&&Object.freeze(this)};return function(K,J){(function(N,L){var M={};N.on=function(P,O){P=P.toLowerCase();M[P]=M[P]||[];if(M[P].indexOf(O)!=-1){return}M[P].push(O)};N.off=function(Q,P){Q=Q.toLowerCase();
M[Q]=M[Q]||[];var O=M[Q].indexOf(P);if(O==-1){return}M[Q].splice(O,1)};N.fire=function(O,Q){O=O.toLowerCase();var P=new I(O,Q);M[O]=M[O]||[];M[O].forEach(function(R){R.call(L,P)})}})(K,J)}})();var l=function(I,J){if(arguments.length<2){J=Date.now()}Object.defineProperty(this,"viewId",{value:I,configurable:false,writable:false,enumerable:true});Object.defineProperty(this,"timestamp",{value:J,configurable:false,writable:false,enumerable:true});this.toString=function(){return JSON.stringify(this)};this.clone=function(){return JSON.parse(this.toString())}};l.isConstructorOf=function(I){if(null==I||typeof I!="object"){return false}return I.hasOwnProperty("viewId")&&I.hasOwnProperty("timestamp")};var D=function(I,K,L){if(arguments.length<2){K=Date.now()}if(arguments.length<3){L=true}var J=new l(I,K).clone();m.log("↓ {}",JSON.stringify(J));if(C){history.pushState(J,"","#"+I)}else{location.hash=I}x.currentState=J};var t=function(I,K){if(arguments.length<2){K=Date.now()}if(arguments.length<3){updateLocation=true}var J=new l(I,K).clone();m.log("% {}",J.clon);if(C){history.replaceState(J,"","#"+I)}else{location.hash=I}x.currentState=J};var g=function(I){Error.call(this,I)};g.prototype=Object.create(Error.prototype);var x=function(L){if(null==document.querySelector("#"+L+"[data-view=true]")){throw new g("View of id: "+L+" does not exist(No element matching pattern: '#"+L+"[data-view=true]' found)!")}var K={};var I=(function(){var M={};Object.defineProperty(M,"has",{value:function(N){return N in M},configurable:false,writable:false,enumerable:false});Object.defineProperty(M,"set",{value:function(N,O){M[N]=O},configurable:false,writable:false,enumerable:false});Object.defineProperty(M,"get",{value:function(N,O){return M[N]},configurable:false,writable:false,enumerable:false});return M})();u(this,document.querySelector("#"+L));var J=this.fire;this.fire=function(M,N){K[M]=N;J(M,N)};Object.defineProperty(this,"logger",{value:G.ofName("View#"+L),configurable:false,writable:false,enumerable:true});this.getLatestEventData=function(M){return K[M]};this.getId=function(){return L};this.getDomElement=function(){return document.querySelector("#"+L)};this.find=function(M){return this.getDomElement().querySelector(M)};this.findAll=function(M){return this.getDomElement().querySelectorAll(M)};this.getContext=function(){return I};this.clearContext=function(){I={}};this.getParameter=function(M){var N=w[this.getId()];if(arguments.length<1){return N}return null==N?null:N[M]};this.isReady=function(){return e.indexOf(this.getId())!=-1};this.isActive=function(){return this.getDomElement().classList.contains("active")};this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))};this.isDirectlyAccessible=function(){var M=document.documentElement.getAttribute("data-view-directly-accessible");M=null==M?"false":M;M=M.toLowerCase();var N=false;if("true"==M){if("false"==this.getDomElement().getAttribute("data-view-directly-accessible")){N=false}else{N=true}}else{if("true"==this.getDomElement().getAttribute("data-view-directly-accessible")){N=true}else{N=false}}return N};this.getFallbackView=function(){var M=this;var O=[this.getId()];do{var N=M.getDomElement().getAttribute("data-view-fallback");if(null==N||!x.isExisting(N)){m.warn("View: "+M.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view");return x.getDefaultView()}else{M=x.ofId(N);if(O.indexOf(M.getId())!=-1){m.error("Cyclical reference of view on fallback configuration on view: {}. Chain: {}, view id: {}",this.getId(),O,M.getId());return x.getDefaultView()}if(M.isDirectlyAccessible()){return M}O.push(N)}}while(true)};Object.freeze&&Object.freeze(this)};x.SWITCHTYPE_HISTORYFORWARD="history.forward";x.SWITCHTYPE_HISTORYBACK="history.back";x.SWITCHTYPE_VIEWSWITCH="view.switch";var n=[];var F=null;x.currentState=null;u(x);x.ofId=function(K){for(var J=0;J<n.length;J++){if(n[J].getId().trim()==K.trim()){return n[J]}}var I=new x(K);n.push(I);return I};x.isExisting=function(J){for(var I=0;I<n.length;I++){if(n[I].getId().trim()==J.trim()){return true}}return false};x.getActiveView=function(){for(var I=0;I<n.length;I++){if(n[I].isActive()){return n[I]}}return null};x.getDefaultView=function(){for(var I=0;I<n.length;I++){if(n[I].isDefault()){return n[I]}}return null};x.setSwitchAnimation=function(I){if(!(I instanceof Function)){throw new Error("Invalid argument. Animation of Function is needed.")}F=I;return x};x.getSwitchAnimation=function(){return F};var p=function(K){K=d(K,{srcView:null,targetView:null,type:x.SWITCHTYPE_VIEWSWITCH,withAnimation:true,params:f});var P=K.srcView,I=K.targetView,N=K.type;if(null==N){N=x.SWITCHTYPE_VIEWSWITCH}var Q=N.toLowerCase()==x.SWITCHTYPE_HISTORYBACK,O=N.toLowerCase()==x.SWITCHTYPE_HISTORYFORWARD;if(!Q&&!O){N=x.SWITCHTYPE_VIEWSWITCH}x.fire("beforechange",{currentView:P,targetView:I,type:N});P&&P.fire("leave",{targetView:I,type:N});var M=function(){P&&P.getDomElement().classList.remove("active");
I.getDomElement().classList.add("active")};var L=function(){var R=I.getId();k(R);if(Q){if(b in w){h(R,w[b]);delete w[b]}}else{if(O){if(r in w){h(R,w[r]);delete w[r]}}else{if(f!=K.params){h(R,K.params)}}}var S={sourceView:P,type:N};if(!I.isReady()){e.push(R);I.fire("ready",S)}I.fire("beforeenter",S);I.fire("enter",S);I.fire("afterenter",S)};if(!K.withAnimation){M();L()}else{var J=function(){M();L()};if(F){F.call(null,P?P.getDomElement():null,I.getDomElement(),N,J)}else{J()}}x.fire("afterchange",{currentView:P,targetView:I,type:N})};var E=function(I,K){K=d(K,{type:x.SWITCHTYPE_VIEWSWITCH,},true);if(!x.isExisting(I)){throw new Error("Target view: "+I+" does not exist!")}var L=x.getActiveView();if(L.getId().toLowerCase()==I.toLowerCase()){return}m.log("{} → {} {}",L.getId(),I,K.type);var J=x.ofId(I);K.srcView=L;K.targetView=J;p(K);return x};x.show=E;x.switchTo=function(I,K,J,L){if(arguments.length<4){L=null}if(arguments.length<3){J=true}if(arguments.length<2){K=x.SWITCHTYPE_VIEWSWITCH}K=K||x.SWITCHTYPE_VIEWSWITCH;E(I,{type:K,withAnimation:J,params:L});return x};x.switchView=x.switchTo;x.navTo=function(I,J){I=I.trim().toLowerCase();var K=new l(I,Date.now());if(b==I){x.back(J);return}if(r==I){x.forward(J);return}E(I,J);D(I);return x};x.updateView=x.navTo;x.back=function(I){k(b);if(null!=I&&"params" in I){console.log("!!!!",w);h(b,I.params)}history.go(-1)};x.forward=function(I){k(r);if(null!=I&&"params" in I){console.log("!!!!",w);h(r,I.params)}history.go(1)};x.changeTo=function(I,J){E(I,J);t(I);return x};var o=document.title;var s=function(I){if(null==I||""==I){console.warn("Invalid document title: "+I);return}document.title=o=I};x.setDocumentTitle=s;x.Logger=G;var j;x.ready=(function(){var J=false;var I=[];j=function(){J=true;setTimeout(function(){I.forEach(function(K){K&&K()})},0)};return function(K){if(J){K&&K();return}if(I.indexOf(K)!=-1){return}I.push(K);return x}})();var B=function(I){var J=null;if(null==I||""==I){J=x.getActiveView()}else{if(!x.isExisting(I)){J=x.getActiveView()}else{if(x.ofId(I).isDirectlyAccessible()){J=x.ofId(I)}else{J=x.ofId(I).getFallbackView()}}}return J};var c=function(N){var M=x.getActiveView();m.log("{} Current: {}",C?"State poped!":"Hash changed!",M.getId());m.log("↑ {}",C?JSON.stringify(N.state):location.hash);var J,L=x.SWITCHTYPE_VIEWSWITCH,K=null;if(null==N.state){L=x.SWITCHTYPE_VIEWSWITCH;J=location.hash.replace(/^#/,"").toLowerCase();K=B(J);t(K.getId())}else{var I=N.state;J=I.viewId;if(x.isExisting(J)){K=x.ofId(J)}else{m.warn("Poped view: "+J+" does not exist, keeping current.");K=M}if(x.currentState!=null){L=I.timestamp<x.currentState.timestamp?x.SWITCHTYPE_HISTORYBACK:x.SWITCHTYPE_HISTORYFORWARD}t(K.getId(),I.timestamp)}x.show(K.getId(),{type:L})};var y=function(){window.addEventListener(C?"popstate":"hashchange",c);var J=document.querySelectorAll("*[data-view=true]");var K=null;var I=function(){var M=-1;for(var L=0;L<J.length;L++){if("true"==J[L].getAttribute("data-view-default")){M=L;break}}if(-1!=M){K=J[M];for(var L=M+1;L<J.length;L++){if("true"==J[L].getAttribute("data-view-default")){J[L].removeAttribute("data-view-default")}}}else{if(0!=J.length){K=J[0];K.setAttribute("data-view-default","true")}}return K};[].forEach.call(J,function(L){x.ofId(L.id);L.classList.remove("active");I();if(null!=K){K.classList.add("active")}L.classList.add("view");(function(){var N=L.getAttribute("data-view-title");var M=x.ofId(L.id);M.on("enter",function(){document.title=null==N?o:N})})()});(function(){var O=x.getDefaultView().getId();var N=location.hash.replace(/^#/i,"").toLowerCase().trim();var L=""==N?x.getDefaultView().getId():N;var M=B(L);m.log("Initial target view: "+M.getId());var P=l.isConstructorOf(history.state);if(null!=history.state){m.log("Found existing state: {}, isViewState? {}",JSON.stringify(history.state),P);if(!(P&&history.state.viewId==M.getId())){t(M.getId())}}else{t(M.getId())}p({srcView:x.getActiveView(),targetView:M,withAnimation:false})})();(function(){i.addTapListener(document.documentElement,function(P){var O=P.changedTouches?P.changedTouches[0].target:P.target;var L;var N=O;while(null==N.getAttribute("data-view-rel")){N=N.parentNode;if(!(N instanceof HTMLElement)){N=null}if(null==N){break}}if(null!=N){L=N.getAttribute("data-view-rel")}if(null==L){return}var Q="true"==N.getAttribute("data-view-rel-disabled");if(Q){return}P.preventDefault();if(b==L.toLowerCase().trim()){history.go(-1);return}if(r==L.toLowerCase().trim()){history.go(1);return}var M=N.getAttribute("data-view-rel-type");M=null==M||""==M.trim()?"nav":M;if(!/^(?:nav)|(?:change)$/.test(M)){m.warn("Unknown view switch type: {}. {}",M,N);M="nav"}x[M+"To"](L,{type:x.SWITCHTYPE_VIEWSWITCH})},{useCapture:true})})();j()};document.addEventListener("DOMContentLoaded",y);v[H]=x})(window,"View");