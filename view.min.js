window.View=(function(){var m=/mobile|tablet|ip(ad|hone|od)|android/i;var n=("ontouchstart" in window);var h=m.test(navigator.userAgent);var e=(function(){var x="  __com.soft.plugin.touch#"+new Date().getTime()+"__  ";var v=function(A,z){A=A||{};z=z||{};for(var B in z){if(!(B in A)){A[B]=z[B]}}return A};var y=function(A,z){A=A||{};A[z]=A[z]||{};return A[z]};var w=function(C,D,A){if(!h){C.addEventListener?C.addEventListener("click",D):C.attachEvent("onclick",D);return}var B=y(C,x+".tap");B.callbacks=B.callbacks||[];if(B.callbacks.indexOf(D)!=-1){return}B.callbacks.push(D);A=v(A,{timespan:500,delta:{},useCapture:false});A.delta=v(A.delta,{x:10,y:15});var z=y(C,x+".tap.meta");if(null==z.touchstart){z.touchstart=function(E){var F=E.changedTouches?E.changedTouches[0]:E;B.startX=F.screenX;B.startY=F.screenY;B.startTimestamp=Date.now()};C.addEventListener("touchstart",z.touchstart)}if(null==z.touchend){z.touchend=function(G){var I=G.changedTouches?G.changedTouches[0]:G;B.stopX=I.screenX;B.stopY=I.screenY;B.stopTimestamp=Date.now();var H=B.stopTimestamp-B.startTimestamp,F=Math.abs(B.stopX-B.startX),E=Math.abs(B.stopY-B.startY);if(H<=A.timespan&&F<=A.delta.x&&E<=A.delta.y){B.callbacks.forEach(function(J){J&&J.call(C,G)})}};C.addEventListener("touchend",z.touchend,A.useCapture)}};var u=function(D,E,z){if(!h){D.removeEventListener?D.removeEventListener("click",E):D.detachEvent("onclick",E);return}if(!D.hasOwnProperty(x)){return}var C=y(D,x+".tap");var B=C.callbacks.indexOf(E);if(B==-1){return}C.callbacks.splice(B,1);if(C.callbacks.length==0){var A=y(D,x+".tap.meta");D.removeEventListener("touchstart",A.touchstart);D.removeEventListener("touchend",A.touchend,z);delete D[x].tap}};return{addTapListener:w,removeTapListener:u}})();var p=("pushState" in history)&&(typeof history.pushState=="function");console.log("History pushState is "+(p?"":"not ")+"supported");var c=[];var b=function(v,u){v=v||{};u=u||{};for(var w in u){if(!(w in v)){v[w]=u[w]}}return v};var i=(function(){var u=function(v,w){this.type=v;this.timestamp=new Date().getTime();this.data=w;Object.freeze&&Object.freeze(this)};return function(w,v){(function(z,x){var y={};z.on=function(B,A){B=B.toLowerCase();y[B]=y[B]||[];if(y[B].indexOf(A)!=-1){return}y[B].push(A)};z.off=function(C,B){C=C.toLowerCase();y[C]=y[C]||[];var A=y[C].indexOf(B);if(A==-1){return}y[C].splice(A,1)};z.fire=function(A,C){A=A.toLowerCase();var B=new u(A,C);y[A]=y[A]||[];y[A].forEach(function(D){D.call(x,B)})}})(w,v)}})();var f=function(u,v){if(arguments.length<2){v=Date.now()}Object.defineProperty(this,"viewId",{value:u,configurable:false,writable:false,enumerable:true});Object.defineProperty(this,"timestamp",{value:v,configurable:false,writable:false,enumerable:true})};f.isConstructorOf=function(u){if(null==u||typeof u!="object"){return false}return u.hasOwnProperty("viewId")&&u.hasOwnProperty("timestamp")};var r=function(u,w,x){if(arguments.length<2){w=Date.now()}if(arguments.length<3){x=true}var v=new f(u,w);console.log("↓",v);if(p){history.pushState(v,"","#"+u)}else{location.hash=u}k.currentState=v};var j=function(u,w){if(arguments.length<2){w=Date.now()}if(arguments.length<3){updateLocation=true}var v=new f(u,w);console.log("%",v);if(p){history.replaceState(v,"","#"+u)}else{location.hash=u}k.currentState=v};var d=function(u){Error.call(this,u)};d.prototype=Object.create(Error.prototype);var t=function(u,v){this.type=u;this.timestamp=new Date().getTime();this.data=v;Object.freeze&&Object.freeze(this)};var k=function(v){if(null==document.querySelector("#"+v+"[data-view=true]")){throw new d("View of id: "+v+" does not exist(No element matching pattern: '#"+v+"[data-view=true]' found)!")}var u=(function(){var w={};Object.defineProperty(w,"has",{value:function(x){return x in w},configurable:false,writable:false,enumerable:false});Object.defineProperty(w,"set",{value:function(x,y){w[x]=y},configurable:false,writable:false,enumerable:false});Object.defineProperty(w,"get",{value:function(x,y){return w[x]},configurable:false,writable:false,enumerable:false});return w})();i(this,document.querySelector("#"+v));this.getId=function(){return v};this.getDomElement=function(){return document.querySelector("#"+v)};this.find=function(w){return this.getDomElement().querySelector(w)};this.findAll=function(w){return this.getDomElement().querySelectorAll(w)};this.getContext=function(){return u};this.clearContext=function(){u={}};this.isReady=function(){return c.indexOf(this.getId())!=-1};this.isActive=function(){return this.getDomElement().classList.contains("active")};this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))};this.isDirectlyAccessible=function(){var w=document.documentElement.getAttribute("data-view-directly-accessible");w=null==w?"false":w;w=w.toLowerCase();var x=false;if("true"==w){if("false"==this.getDomElement().getAttribute("data-view-directly-accessible")){x=false}else{x=true}}else{if("true"==this.getDomElement().getAttribute("data-view-directly-accessible")){x=true
}else{x=false}}return x};this.getFallbackView=function(){var w=this;var y=[this.getId()];do{var x=w.getDomElement().getAttribute("data-view-fallback");if(null==x||!k.isExisting(x)){console.warn("View: "+w.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view");return k.getDefaultView()}else{w=k.ofId(x);if(y.indexOf(w.getId())!=-1){console.error("Cyclical reference of view on fallback configuration on view: "+this.getId(),y,w.getId());return k.getDefaultView()}if(w.isDirectlyAccessible()){return w}y.push(x)}}while(true)};Object.freeze&&Object.freeze(this)};k.SWITCHTYPE_HISTORYFORWARD="history.forward";k.SWITCHTYPE_HISTORYBACK="history.back";k.SWITCHTYPE_VIEWSWITCH="view.switch";var g=[];var s=null;k.currentState=null;i(k);k.ofId=function(w){for(var v=0;v<g.length;v++){if(g[v].getId().trim()==w.trim()){return g[v]}}var u=new k(w);g.push(u);return u};k.isExisting=function(v){for(var u=0;u<g.length;u++){if(g[u].getId().trim()==v.trim()){return true}}return false};k.getActiveView=function(){for(var u=0;u<g.length;u++){if(g[u].isActive()){return g[u]}}return null};k.getDefaultView=function(){for(var u=0;u<g.length;u++){if(g[u].isDefault()){return g[u]}}return null};k.setSwitchAnimation=function(u){if(!(u instanceof Function)){throw new Error("Invalid argument. Animation of Function is needed.")}s=u;return k};k.getSwitchAnimation=function(){return s};var q=function(v,u,y,x){if(arguments.length<3){x=true}if(arguments.length<2){y=k.SWITCHTYPE_VIEWSWITCH}y=y||k.SWITCHTYPE_VIEWSWITCH;k.fire("beforechange",{currentView:v,targetView:u,type:y});var z=function(){v&&v.getDomElement().classList.remove("active");u.getDomElement().classList.add("active")};v&&v.fire("leave",y);if(!x){z();if(!u.isReady()){c.push(u.getId());u.fire("ready",y)}u.fire("beforeenter",y);u.fire("enter",y);u.fire("afterenter",y)}else{var w=function(){z();if(!u.isReady()){c.push(u.getId());u.fire("ready",y)}u.fire("beforeenter",y);u.fire("enter",y);u.fire("afterenter",y)};if(s){s.call(null,v?v.getDomElement():null,u.getDomElement(),y,w)}else{w()}}k.fire("afterchange",{currentView:v,targetView:u,type:y})};k.switchTo=function(u,x,w){if(arguments.length<3){w=true}if(arguments.length<2){x=k.SWITCHTYPE_VIEWSWITCH}x=x||k.SWITCHTYPE_VIEWSWITCH;var y=k.getActiveView();if(!k.isExisting(u)){throw new Error("target view: "+u+" does not exist!")}if(y.getId().toLowerCase()==u.toLowerCase()){return}console.log(y.getId()+" → "+u,x);var v=k.ofId(u);x=(x.toLowerCase()==k.SWITCHTYPE_HISTORYFORWARD?k.SWITCHTYPE_HISTORYFORWARD:(x.toLowerCase()==k.SWITCHTYPE_HISTORYBACK?k.SWITCHTYPE_HISTORYBACK:k.SWITCHTYPE_VIEWSWITCH));q(y,v,x,w);return k};k.switchView=k.switchTo;k.navTo=function(u,v){var w=new f(u,Date.now());if(":back"==u.toLowerCase().trim()){history.go(-1);return}if(":forward"==u.toLowerCase().trim()){history.go(1);return}if(!k.isExisting(u)){throw new Error("target view: "+u+" does not exist!")}k.switchTo(u,v);r(u);return k};k.updateView=k.navTo;k.changeTo=function(u,v){k.switchTo(u,v);j(u);return k};k.ready=(function(){var v=false;var u=[];document.addEventListener("DOMContentLoaded",function(){v=true;u.forEach(function(w){w&&w()})});return function(w){if(v){w&&w();return}if(u.indexOf(w)!=-1){return}u.push(w);return k}})();var o=function(u){var v=null;if(null==u||""==u){v=k.getActiveView()}else{if(!k.isExisting(u)){v=k.getActiveView()}else{if(k.ofId(u).isDirectlyAccessible()){v=k.ofId(u)}else{v=k.ofId(u).getFallbackView()}}}return v};var a=function(z){var y=k.getActiveView();console.log(p?"State poped!":"Hash changed!","Current: "+y.getId());console.log("↑",p?JSON.stringify(z.state):location.hash);var v,x=k.SWITCHTYPE_VIEWSWITCH,w=null;if(null==z.state){x=k.SWITCHTYPE_VIEWSWITCH;v=location.hash.replace(/^#/,"").toLowerCase();w=o(v);j(w.getId())}else{var u=z.state;v=u.viewId;if(k.isExisting(v)){w=k.ofId(v)}else{console.warn("Poped view: "+v+" does not exist, keeping current.");w=y}if(k.currentState!=null){x=u.timestamp<k.currentState.timestamp?k.SWITCHTYPE_HISTORYBACK:k.SWITCHTYPE_HISTORYFORWARD}j(w.getId(),u.timestamp)}k.switchTo(w.getId(),x)};var l=function(){window.addEventListener(p?"popstate":"hashchange",a);[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(u){k.ofId(u.id)});[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(u){u.classList.add("view")});(function(){var w=null;var v=document.querySelectorAll("*[data-view-default=true][data-view=true]");if(0==v.length){w=document.querySelector("*[data-view=true]");if(null==w){console.warn("No view found!")}else{w.setAttribute("data-view-default","true")}}else{w=v[0];for(var u=1;u<v.length;u++){v[u].removeAttribute("data-view-default")}}})();(function(){var w=document.querySelectorAll("*[data-view=true].active");for(var v=0;v<w.length;v++){var u=w[v];u.classList.remove("active")}k.getDefaultView().getDomElement().classList.add("active")})();(function(){var x=k.getDefaultView().getId();var w=location.hash.replace(/^#/i,"").toLowerCase().trim();
var u=""==w?k.getDefaultView().getId():w;var v=o(u);console.log("Initial target view: "+v.getId());var y=f.isConstructorOf(history.state);if(null!=history.state){console.log("Found existing state: ",history.state," isViewState? "+y);if(!(y&&history.state.viewId==v.getId())){j(v.getId())}}else{j(v.getId())}q(k.getActiveView(),v,null,false)})();(function(){var u=document.title;[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(v){var x=v.getAttribute("data-view-title");var w=k.ofId(v.id);w.on("enter",function(){document.title=null==x?u:x})})})();(function(){e.addTapListener(document.documentElement,function(y){var x=y.changedTouches?y.changedTouches[0].target:y.target;var u;var w=x;while(null==w.getAttribute("data-view-rel")){w=w.parentNode;if(!(w instanceof HTMLElement)){w=null}if(null==w){break}}if(null!=w){u=w.getAttribute("data-view-rel")}if(null==u){return}var z="true"==w.getAttribute("data-view-rel-disabled");if(z){return}if(":back"==u.toLowerCase().trim()){history.go(-1);return}if(":forward"==u.toLowerCase().trim()){history.go(1);return}var v=w.getAttribute("data-view-rel-type");v=null==v||""==v.trim()?"nav":v;if(!/^(?:nav)|(?:change)$/.test(v)){console.warn("Unknown view switch type: "+v,w);v="nav"}k[v+"To"](u,k.SWITCHTYPE_VIEWSWITCH);y.preventDefault()},{useCapture:true})})()};document.addEventListener("DOMContentLoaded",l);return k})();