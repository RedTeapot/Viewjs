window.View=(function(){var f=(function(){var q="  __com.soft.plugin.touch#"+new Date().getTime()+"__  ";var o=function(t,s){t=t||{};s=s||{};for(var u in s){if(!(u in t)){t[u]=s[u]}}return t};var r=function(t,s){t=t||{};t[s]=t[s]||{};return t[s]};var p=function(v,w,t){if(!("ontouchstart" in window)){v.addEventListener?v.addEventListener("click",w):v.attachEvent("onclick",w);return}var u=r(v,q+".tap");u.callbacks=u.callbacks||[];if(u.callbacks.indexOf(w)!=-1){return}u.callbacks.push(w);t=o(t,{timespan:500,delta:{},useCapture:false});t.delta=o(t.delta,{x:10,y:15});var s=r(v,q+".tap.meta");if(null==s.touchstart){s.touchstart=function(x){var y=x.changedTouches?x.changedTouches[0]:x;u.startX=y.screenX;u.startY=y.screenY;u.startTimestamp=Date.now()};v.addEventListener("touchstart",s.touchstart)}if(null==s.touchend){s.touchend=function(z){var B=z.changedTouches?z.changedTouches[0]:z;u.stopX=B.screenX;u.stopY=B.screenY;u.stopTimestamp=Date.now();var A=u.stopTimestamp-u.startTimestamp,y=Math.abs(u.stopX-u.startX),x=Math.abs(u.stopY-u.startY);if(A<=t.timespan&&y<=t.delta.x&&x<=t.delta.y){u.callbacks.forEach(function(C){C&&C.call(v,z)})}};v.addEventListener("touchend",s.touchend,t.useCapture)}};var n=function(w,x,s){if(!("ontouchstart" in window)){w.removeEventListener?w.removeEventListener("click",x):w.detachEvent("onclick",x);return}if(!w.hasOwnProperty(q)){return}var v=r(w,q+".tap");var u=v.callbacks.indexOf(x);if(u==-1){return}v.callbacks.splice(u,1);if(v.callbacks.length==0){var t=r(w,q+".tap.meta");w.removeEventListener("touchstart",t.touchstart);w.removeEventListener("touchend",t.touchend,s);delete w[q].tap}};return{addTapListener:p,removeTapListener:n}})();var l=("pushState" in history)&&(typeof history.pushState=="function");console.log("history.pushState is "+(l?"":"not ")+"supported");var c=[];var i=function(o,n){o=o||{};n=n||{};for(var q in n){if(!(q in o)){o[q]=n[q]}}return o};var g=(function(){var n=function(o,p){this.type=o;this.timestamp=new Date().getTime();this.data=p;Object.freeze&&Object.freeze(this)};return function(p,o){(function(s,q){var r={};s.on=function(u,t){u=u.toLowerCase();r[u]=r[u]||[];if(r[u].indexOf(t)!=-1){return}r[u].push(t)};s.off=function(v,u){v=v.toLowerCase();r[v]=r[v]||[];var t=r[v].indexOf(u);if(t==-1){return}r[v].splice(t,1)};s.fire=function(t,v){t=t.toLowerCase();var u=new n(t,v);r[t]=r[t]||[];r[t].forEach(function(w){w.call(q,u)})}})(p,o)}})();var d=function(n,o){history.pushState({viewId:n,timestamp:null==o?Date.now():o},"","#"+n)};var e=function(n,o){history.replaceState({viewId:n,timestamp:null==o?Date.now():o},"","#"+n)};var k=function(n){Error.call(this,n)};k.prototype=Object.create(Error.prototype);var j=function(n,o){this.type=n;this.timestamp=new Date().getTime();this.data=o;Object.freeze&&Object.freeze(this)};var a=function(q){if(null==document.querySelector("#"+q+"[data-view=true]")){throw new k("View of id: "+q+" does not exist(No element matching pattern: '#"+q+"[data-view=true]' found)!")}var p={};g(this,document.querySelector("#"+q));var o=function(r,t,s){};var n=function(t,s,r){r()};this.getId=function(){return q};this.getDomElement=function(){return document.querySelector("#"+q)};this.getContext=function(){return p};this.clearContext=function(){p={}};this.isReady=function(){return c.indexOf(this.getId())!=-1};this.isActive=function(){return this.getDomElement().classList.contains("active")};this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))};this.isDirectlyAccessible=function(){var r=document.documentElement.getAttribute("data-view-directly-accessible");r=null==r?"false":r;r=r.toLowerCase();var s=false;if("true"==r){if("false"==this.getDomElement().getAttribute("data-view-directly-accessible")){s=false}else{s=true}}else{if("true"==this.getDomElement().getAttribute("data-view-directly-accessible")){s=true}else{s=false}}return s};this.getFallbackView=function(){var r=this;var t=[this.getId()];do{if(r.isDirectlyAccessible()){return r}var s=this.getDomElement().getAttribute("data-view-fallback");if(null==s||!a.isExisting(s)){console.warn("View: "+this.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view");return a.getDefaultView()}else{r=a.ofId(s);if(t.indexOf(r.getId())!=-1){console.error("cyclical reference of view on fallback configuration on view: "+this.getId());return a.getDefaultView()}t.push(s)}}while(true)};this.setLeaveAnimation=function(r){o=r};this.getLeaveAnimation=function(){return o};this.setEnterAnimation=function(r){n=r};this.getEnterAnimation=function(){return n};Object.freeze&&Object.freeze(this)};a.SWITCHTYPE_HISTORYFORWARD="history.forward";a.SWITCHTYPE_HISTORYBACK="history.back";a.SWITCHTYPE_VIEWSWITCH="view.switch";var h=[];a.currentState=null;g(a);a.ofId=function(p){for(var o=0;o<h.length;o++){if(h[o].getId().toLowerCase().trim()==p.toLowerCase().trim()){return h[o]}}var n=new a(p);h.push(n);return n};a.isExisting=function(o){for(var n=0;
n<h.length;n++){if(h[n].getId().toLowerCase().trim()==o.toLowerCase().trim()){return true}}return false};a.getActiveView=function(){for(var n=0;n<h.length;n++){if(h[n].isActive()){return h[n]}}return null};a.getDefaultView=function(){for(var n=0;n<h.length;n++){if(h[n].isDefault()){return h[n]}}return null};a.switchView=function(n,q,p){var s=a.getActiveView();if(arguments.length<3){p=true}if(arguments.length<2){q=a.SWITCHTYPE_VIEWSWITCH}q=q||a.SWITCHTYPE_VIEWSWITCH;if(""==n.trim()){if(null==a.getDefaultView()){return}else{n=a.getDefaultView().getId()}}if(!a.isExisting(n)){console.error("target view: "+n+" does not exist!");return}console.log(s.getId()+" -> "+n,q);if(s.getId().toLowerCase()==n.toLowerCase()){return}var o=a.ofId(n);q=(q.toLowerCase()==a.SWITCHTYPE_HISTORYFORWARD?a.SWITCHTYPE_HISTORYFORWARD:(q.toLowerCase()==a.SWITCHTYPE_HISTORYBACK?a.SWITCHTYPE_HISTORYBACK:a.SWITCHTYPE_VIEWSWITCH));a.fire("beforechange",{currentView:s,targetView:o,type:q});var r=function(){s.getDomElement().classList.remove("active");o.getDomElement().classList.add("active")};s.fire("leave",q);if(!p){r();if(!o.isReady()){c.push(o.getId());o.fire("ready",q)}o.fire("enter",q)}else{s.getLeaveAnimation()&&s.getLeaveAnimation().call(s.getDomElement(),n,q,r);o.getEnterAnimation()&&o.getEnterAnimation().call(o.getDomElement(),s.getId(),q,function(){r();if(!o.isReady()){c.push(o.getId());o.fire("ready",q)}o.fire("enter",q)})}a.fire("afterchange",{currentView:s,targetView:o,type:q})};a.updateView=function(n,o){var p={viewId:n,timestamp:Date.now()};if(":back"==n.toLowerCase().trim()){history.go(-1);return}if(":forward"==n.toLowerCase().trim()){history.go(1);return}if(!a.isExisting(n)){console.error("target view: "+n+" does not exist!");return}a.currentState=p;if(l){d(n);console.log("pushed state by update view",p)}else{location.hash=n}a.switchView(n,o)};a.ready=(function(){var o=false;var n=[];return function(p){if(o){p&&p();return}if(n.indexOf(p)!=-1){return}n.push(p)};document.addEventListener("DOMContentLoaded",function(){o=true;n.forEach(function(p){p&&p()})})})();var b=function(s){var r=a.getActiveView();console.log(l?"state poped!":"hash changed!","current: "+r.getId());l&&console.log("poped state",JSON.stringify(s.state));var q,p=a.SWITCHTYPE_VIEWSWITCH,o=null;if(!l||null==s.state){q=location.hash.replace(/^#/,"").toLowerCase();if(""==q){o=a.getDefaultView()}else{if(!a.isExisting(q)){o=a.getDefaultView()}else{if(a.ofId(q).isDirectlyAccessible()){o=a.ofId(q)}else{o=a.ofId(q).getFallbackView()}}}p=a.SWITCHTYPE_VIEWSWITCH;location.hash=o.getId()}else{var n=s.state;q=n.viewId;if(null==q||!a.isExisting(q)){o=a.getDefaultView()}else{o=a.ofId(q)}if(a.currentState!=null){p=n.timestamp<a.currentState.timestamp?a.SWITCHTYPE_HISTORYBACK:a.SWITCHTYPE_HISTORYFORWARD}a.currentState=n;e(o.getId(),n.timestamp)}o&&a.switchView(o.getId(),p)};var m=function(){[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(n){a.ofId(n.id)});[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(n){n.classList.add("view")});(function(){var p=null;var o=document.querySelectorAll("*[data-view-default=true][data-view=true]");if(0==o.length){p=document.querySelector("*[data-view=true]");if(null==p){console.warn("No view found!")}else{p.setAttribute("data-view-default","true")}}else{p=o[0];for(var n=1;n<o.length;n++){o[n].removeAttribute("data-view-default")}}})();(function(){f.addTapListener(document.documentElement,function(q){var p=q.changedTouches?q.changedTouches[0].target:q.target;var n;var o=p;while(null==o.getAttribute("data-view-rel")){o=o.parentNode;if(!(o instanceof HTMLElement)){o=null}if(null==o){break}}if(null!=o){n=o.getAttribute("data-view-rel")}if(null==n){return}var r=false;o=p;while(null==o.getAttribute("data-view-rel-disabled")){o=o.parentNode;if(!(o instanceof HTMLElement)){o=null}if(null==o){break}}if(null!=o){r="true"==o.getAttribute("data-view-rel-disabled")}if(r){return}q.preventDefault();if(":back"==n.toLowerCase().trim()){history.go(-1);return}if(":forward"==n.toLowerCase().trim()){history.go(1);return}a.updateView(n,a.SWITCHTYPE_VIEWSWITCH)},{useCapture:true})})();(function(){var n=location.hash.replace(/^#/i,"").toLowerCase();var o=null;if(""==n){o=a.getDefaultView()}else{if(!a.isExisting(n)){o=a.getDefaultView()}else{if(a.ofId(n).isDirectlyAccessible()){o=a.ofId(n)}else{o=a.ofId(n).getFallbackView()}}}if(null!=o){if(l){e(o.getId())}else{location.hash=o.getId()}o.getDomElement().classList.add("active")}})();window.addEventListener(l?"popstate":"hashchange",b)};document.addEventListener("DOMContentLoaded",function(){m();var n=a.getActiveView();if(n){c.push(n.getId());n.fire("ready",a.SWITCHTYPE_VIEWSWITCH);n.fire("enter",a.SWITCHTYPE_VIEWSWITCH)}(function(){var o=document.title;[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(p){var r=p.getAttribute("data-view-title");if(null==r){return}var q=a.ofId(p.id);q.on("enter",function(){document.title=r});q.on("leave",function(){document.title=o
})})})()});return a})();