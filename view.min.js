window.View=(function(){var m=/mobile|tablet|ip(ad|hone|od)|android/i;var n=("ontouchstart" in window);var h=m.test(navigator.userAgent);var e=(function(){var w="  __com.soft.plugin.touch#"+new Date().getTime()+"__  ";var u=function(z,y){z=z||{};y=y||{};for(var A in y){if(!(A in z)){z[A]=y[A]}}return z};var x=function(z,y){z=z||{};z[y]=z[y]||{};return z[y]};var v=function(B,C,z){if(!h){B.addEventListener?B.addEventListener("click",C):B.attachEvent("onclick",C);return}var A=x(B,w+".tap");A.callbacks=A.callbacks||[];if(A.callbacks.indexOf(C)!=-1){return}A.callbacks.push(C);z=u(z,{timespan:500,delta:{},useCapture:false});z.delta=u(z.delta,{x:10,y:15});var y=x(B,w+".tap.meta");if(null==y.touchstart){y.touchstart=function(D){var E=D.changedTouches?D.changedTouches[0]:D;A.startX=E.screenX;A.startY=E.screenY;A.startTimestamp=Date.now()};B.addEventListener("touchstart",y.touchstart)}if(null==y.touchend){y.touchend=function(F){var H=F.changedTouches?F.changedTouches[0]:F;A.stopX=H.screenX;A.stopY=H.screenY;A.stopTimestamp=Date.now();var G=A.stopTimestamp-A.startTimestamp,E=Math.abs(A.stopX-A.startX),D=Math.abs(A.stopY-A.startY);if(G<=z.timespan&&E<=z.delta.x&&D<=z.delta.y){A.callbacks.forEach(function(I){I&&I.call(B,F)})}};B.addEventListener("touchend",y.touchend,z.useCapture)}};var t=function(C,D,y){if(!h){C.removeEventListener?C.removeEventListener("click",D):C.detachEvent("onclick",D);return}if(!C.hasOwnProperty(w)){return}var B=x(C,w+".tap");var A=B.callbacks.indexOf(D);if(A==-1){return}B.callbacks.splice(A,1);if(B.callbacks.length==0){var z=x(C,w+".tap.meta");C.removeEventListener("touchstart",z.touchstart);C.removeEventListener("touchend",z.touchend,y);delete C[w].tap}};return{addTapListener:v,removeTapListener:t}})();var o=("pushState" in history)&&(typeof history.pushState=="function");console.log("History pushState is "+(o?"":"not ")+"supported");var c=[];var b=function(u,t){u=u||{};t=t||{};for(var v in t){if(!(v in u)){u[v]=t[v]}}return u};var i=(function(){var t=function(u,v){this.type=u;this.timestamp=new Date().getTime();this.data=v;Object.freeze&&Object.freeze(this)};return function(v,u){(function(y,w){var x={};y.on=function(A,z){A=A.toLowerCase();x[A]=x[A]||[];if(x[A].indexOf(z)!=-1){return}x[A].push(z)};y.off=function(B,A){B=B.toLowerCase();x[B]=x[B]||[];var z=x[B].indexOf(A);if(z==-1){return}x[B].splice(z,1)};y.fire=function(z,B){z=z.toLowerCase();var A=new t(z,B);x[z]=x[z]||[];x[z].forEach(function(C){C.call(w,A)})}})(v,u)}})();var f=function(t,u){if(arguments.length<2){u=Date.now()}Object.defineProperty(this,"viewId",{value:t,configurable:false,writable:false,enumerable:true});Object.defineProperty(this,"timestamp",{value:u,configurable:false,writable:false,enumerable:true})};f.isConstructorOf=function(t){if(null==t||typeof t!="object"){return false}return t.hasOwnProperty("viewId")&&t.hasOwnProperty("timestamp")};var q=function(t,v,w){if(arguments.length<2){v=Date.now()}if(arguments.length<3){w=true}var u=new f(t,v);console.log("↓",u);if(o){history.pushState(u,"","#"+t)}else{location.hash=t}k.currentState=u};var j=function(t,v){if(arguments.length<2){v=Date.now()}if(arguments.length<3){updateLocation=true}var u=new f(t,v);console.log("%",u);if(o){history.replaceState(u,"","#"+t)}else{location.hash=t}k.currentState=u};var d=function(t){Error.call(this,t)};d.prototype=Object.create(Error.prototype);var s=function(t,u){this.type=t;this.timestamp=new Date().getTime();this.data=u;Object.freeze&&Object.freeze(this)};var k=function(u){if(null==document.querySelector("#"+u+"[data-view=true]")){throw new d("View of id: "+u+" does not exist(No element matching pattern: '#"+u+"[data-view=true]' found)!")}var t=(function(){var v={};Object.defineProperty(v,"has",{value:function(w){return w in v},configurable:false,writable:false,enumerable:false});Object.defineProperty(v,"set",{value:function(w,x){v[w]=x},configurable:false,writable:false,enumerable:false});Object.defineProperty(v,"get",{value:function(w,x){return v[w]},configurable:false,writable:false,enumerable:false});return v})();i(this,document.querySelector("#"+u));this.getId=function(){return u};this.getDomElement=function(){return document.querySelector("#"+u)};this.find=function(v){return this.getDomElement().querySelector(v)};this.findAll=function(v){return this.getDomElement().querySelectorAll(v)};this.getContext=function(){return t};this.clearContext=function(){t={}};this.isReady=function(){return c.indexOf(this.getId())!=-1};this.isActive=function(){return this.getDomElement().classList.contains("active")};this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))};this.isDirectlyAccessible=function(){var v=document.documentElement.getAttribute("data-view-directly-accessible");v=null==v?"false":v;v=v.toLowerCase();var w=false;if("true"==v){if("false"==this.getDomElement().getAttribute("data-view-directly-accessible")){w=false}else{w=true}}else{if("true"==this.getDomElement().getAttribute("data-view-directly-accessible")){w=true
}else{w=false}}return w};this.getFallbackView=function(){var v=this;var x=[this.getId()];do{if(v.isDirectlyAccessible()){return v}var w=this.getDomElement().getAttribute("data-view-fallback");if(null==w||!k.isExisting(w)){console.warn("View: "+this.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view");return k.getDefaultView()}else{v=k.ofId(w);if(x.indexOf(v.getId())!=-1){console.error("Cyclical reference of view on fallback configuration on view: "+this.getId());return k.getDefaultView()}x.push(w)}}while(true)};Object.freeze&&Object.freeze(this)};k.SWITCHTYPE_HISTORYFORWARD="history.forward";k.SWITCHTYPE_HISTORYBACK="history.back";k.SWITCHTYPE_VIEWSWITCH="view.switch";var g=[];var r=null;k.currentState=null;i(k);k.ofId=function(v){for(var u=0;u<g.length;u++){if(g[u].getId().trim()==v.trim()){return g[u]}}var t=new k(v);g.push(t);return t};k.isExisting=function(u){for(var t=0;t<g.length;t++){if(g[t].getId().trim()==u.trim()){return true}}return false};k.getActiveView=function(){for(var t=0;t<g.length;t++){if(g[t].isActive()){return g[t]}}return null};k.getDefaultView=function(){for(var t=0;t<g.length;t++){if(g[t].isDefault()){return g[t]}}return null};k.setSwitchAnimation=function(t){if(!(t instanceof Function)){throw new Error("Invalid argument. Animation of Function is needed.")}r=t;return k};k.getSwitchAnimation=function(){return r};k.switchTo=function(t,x,w){if(arguments.length<3){w=true}if(arguments.length<2){x=k.SWITCHTYPE_VIEWSWITCH}x=x||k.SWITCHTYPE_VIEWSWITCH;var z=k.getActiveView();if(!k.isExisting(t)){console.error("target view: "+t+" does not exist!");return}if(z.getId().toLowerCase()==t.toLowerCase()){return}console.log(z.getId()+" → "+t,x);var u=k.ofId(t);x=(x.toLowerCase()==k.SWITCHTYPE_HISTORYFORWARD?k.SWITCHTYPE_HISTORYFORWARD:(x.toLowerCase()==k.SWITCHTYPE_HISTORYBACK?k.SWITCHTYPE_HISTORYBACK:k.SWITCHTYPE_VIEWSWITCH));k.fire("beforechange",{currentView:z,targetView:u,type:x});var y=function(){z.getDomElement().classList.remove("active");u.getDomElement().classList.add("active")};z.fire("leave",x);if(!w){y();if(!u.isReady()){c.push(u.getId());u.fire("ready",x)}u.fire("beforeenter",x);u.fire("enter",x);u.fire("afterenter",x)}else{var v=function(){y();if(!u.isReady()){c.push(u.getId());u.fire("ready",x)}u.fire("beforeenter",x);u.fire("enter",x);u.fire("afterenter",x)};if(r){r.call(null,z.getDomElement(),u.getDomElement(),x,v)}else{v()}}k.fire("afterchange",{currentView:z,targetView:u,type:x});return k};k.switchView=k.switchTo;k.navTo=function(t,u){var v=new f(t,Date.now());if(":back"==t.toLowerCase().trim()){history.go(-1);return}if(":forward"==t.toLowerCase().trim()){history.go(1);return}if(!k.isExisting(t)){console.error("Target view: "+t+" does not exist!");return}k.switchTo(t,u);q(t);return k};k.updateView=k.navTo;k.ready=(function(){var u=false;var t=[];document.addEventListener("DOMContentLoaded",function(){u=true;t.forEach(function(v){v&&v()})});return function(v){if(u){v&&v();return}if(t.indexOf(v)!=-1){return}t.push(v);return k}})();var p=function(t){var u=null;if(null==t||""==t){u=k.getActiveView()}else{if(!k.isExisting(t)){u=k.getActiveView()}else{if(k.ofId(t).isDirectlyAccessible()){u=k.ofId(t)}else{u=k.ofId(t).getFallbackView()}}}return u};var a=function(y){var x=k.getActiveView();console.log(o?"State poped!":"Hash changed!","Current: "+x.getId());console.log("↑",o?JSON.stringify(y.state):location.hash);var u,w=k.SWITCHTYPE_VIEWSWITCH,v=null;if(null==y.state){w=k.SWITCHTYPE_VIEWSWITCH;u=location.hash.replace(/^#/,"").toLowerCase();if(k.isExisting(u)){v=k.ofId(u)}else{console.warn("Poped view: "+u+" does not exist, keeping current.");v=x}j(v.getId())}else{var t=y.state;u=t.viewId;if(k.isExisting(u)){v=k.ofId(u)}else{console.warn("Poped view: "+u+" does not exist, keeping current.");v=x}if(k.currentState!=null){w=t.timestamp<k.currentState.timestamp?k.SWITCHTYPE_HISTORYBACK:k.SWITCHTYPE_HISTORYFORWARD}j(v.getId(),t.timestamp)}k.switchTo(v.getId(),w)};var l=function(){window.addEventListener(o?"popstate":"hashchange",a);[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(t){k.ofId(t.id)});[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(t){t.classList.add("view")});(function(){var v=null;var u=document.querySelectorAll("*[data-view-default=true][data-view=true]");if(0==u.length){v=document.querySelector("*[data-view=true]");if(null==v){console.warn("No view found!")}else{v.setAttribute("data-view-default","true")}}else{v=u[0];for(var t=1;t<u.length;t++){u[t].removeAttribute("data-view-default")}}})();(function(){var v=document.querySelectorAll("*[data-view=true].active");for(var u=0;u<v.length;u++){var t=v[u];t.classList.remove("active")}k.getDefaultView().getDomElement().classList.add("active")})();(function(){var w=k.getDefaultView().getId();var v=location.hash.replace(/^#/i,"").toLowerCase().trim();var t=""==v?k.getDefaultView().getId():v;var u=p(t);var x=f.isConstructorOf(history.state);
if(null!=history.state){console.log("Found existing state: ",history.state," isViewState? "+x);if(!(x&&history.state.viewId==u.getId())){j(u.getId())}}else{j(u.getId())}if(v==w){c.push(t);u.fire("ready",k.SWITCHTYPE_VIEWSWITCH);u.fire("beforeenter",k.SWITCHTYPE_VIEWSWITCH);u.fire("enter",k.SWITCHTYPE_VIEWSWITCH);u.fire("afterenter",k.SWITCHTYPE_VIEWSWITCH)}k.switchTo(u.getId(),null,false)})();(function(){var t=document.title;[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(u){var w=u.getAttribute("data-view-title");var v=k.ofId(u.id);v.on("enter",function(){document.title=null==w?t:w})})})();(function(){e.addTapListener(document.documentElement,function(w){var v=w.changedTouches?w.changedTouches[0].target:w.target;var t;var u=v;while(null==u.getAttribute("data-view-rel")){u=u.parentNode;if(!(u instanceof HTMLElement)){u=null}if(null==u){break}}if(null!=u){t=u.getAttribute("data-view-rel")}if(null==t){return}var x=false;u=v;while(null==u.getAttribute("data-view-rel-disabled")){u=u.parentNode;if(!(u instanceof HTMLElement)){u=null}if(null==u){break}}if(null!=u){x="true"==u.getAttribute("data-view-rel-disabled")}if(x){return}w.preventDefault();if(":back"==t.toLowerCase().trim()){history.go(-1);return}if(":forward"==t.toLowerCase().trim()){history.go(1);return}k.navTo(t,k.SWITCHTYPE_VIEWSWITCH)},{useCapture:true})})()};document.addEventListener("DOMContentLoaded",l);return k})();