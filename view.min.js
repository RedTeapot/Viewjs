window.View=(function(){var j=/mobile|tablet|ip(ad|hone|od)|android/i;var b=("ontouchstart" in window);var d=j.test(navigator.userAgent);var h=(function(){var t="  __com.soft.plugin.touch#"+new Date().getTime()+"__  ";var r=function(w,v){w=w||{};v=v||{};for(var x in v){if(!(x in w)){w[x]=v[x]}}return w};var u=function(w,v){w=w||{};w[v]=w[v]||{};return w[v]};var s=function(y,z,w){if(!d){y.addEventListener?y.addEventListener("click",z):y.attachEvent("onclick",z);return}var x=u(y,t+".tap");x.callbacks=x.callbacks||[];if(x.callbacks.indexOf(z)!=-1){return}x.callbacks.push(z);w=r(w,{timespan:500,delta:{},useCapture:false});w.delta=r(w.delta,{x:10,y:15});var v=u(y,t+".tap.meta");if(null==v.touchstart){v.touchstart=function(A){var B=A.changedTouches?A.changedTouches[0]:A;x.startX=B.screenX;x.startY=B.screenY;x.startTimestamp=Date.now()};y.addEventListener("touchstart",v.touchstart)}if(null==v.touchend){v.touchend=function(C){var E=C.changedTouches?C.changedTouches[0]:C;x.stopX=E.screenX;x.stopY=E.screenY;x.stopTimestamp=Date.now();var D=x.stopTimestamp-x.startTimestamp,B=Math.abs(x.stopX-x.startX),A=Math.abs(x.stopY-x.startY);if(D<=w.timespan&&B<=w.delta.x&&A<=w.delta.y){x.callbacks.forEach(function(F){F&&F.call(y,C)})}};y.addEventListener("touchend",v.touchend,w.useCapture)}};var q=function(z,A,v){if(!d){z.removeEventListener?z.removeEventListener("click",A):z.detachEvent("onclick",A);return}if(!z.hasOwnProperty(t)){return}var y=u(z,t+".tap");var x=y.callbacks.indexOf(A);if(x==-1){return}y.callbacks.splice(x,1);if(y.callbacks.length==0){var w=u(z,t+".tap.meta");z.removeEventListener("touchstart",w.touchstart);z.removeEventListener("touchend",w.touchend,v);delete z[t].tap}};return{addTapListener:s,removeTapListener:q}})();var o=("pushState" in history)&&(typeof history.pushState=="function");console.log("history.pushState is "+(o?"":"not ")+"supported");var e=[];var l=function(r,q){r=r||{};q=q||{};for(var s in q){if(!(s in r)){r[s]=q[s]}}return r};var i=(function(){var q=function(r,s){this.type=r;this.timestamp=new Date().getTime();this.data=s;Object.freeze&&Object.freeze(this)};return function(s,r){(function(v,t){var u={};v.on=function(x,w){x=x.toLowerCase();u[x]=u[x]||[];if(u[x].indexOf(w)!=-1){return}u[x].push(w)};v.off=function(y,x){y=y.toLowerCase();u[y]=u[y]||[];var w=u[y].indexOf(x);if(w==-1){return}u[y].splice(w,1)};v.fire=function(w,y){w=w.toLowerCase();var x=new q(w,y);u[w]=u[w]||[];u[w].forEach(function(z){z.call(t,x)})}})(s,r)}})();var g=function(q,r){history.pushState({viewId:q,timestamp:null==r?Date.now():r},"","#"+q)};var f=function(q,r){history.replaceState({viewId:q,timestamp:null==r?Date.now():r},"","#"+q)};var n=function(q){Error.call(this,q)};n.prototype=Object.create(Error.prototype);var m=function(q,r){this.type=q;this.timestamp=new Date().getTime();this.data=r;Object.freeze&&Object.freeze(this)};var a=function(t){if(null==document.querySelector("#"+t+"[data-view=true]")){throw new n("View of id: "+t+" does not exist(No element matching pattern: '#"+t+"[data-view=true]' found)!")}var s={};i(this,document.querySelector("#"+t));var r=function(u,w,v){};var q=function(w,v,u){u()};this.getId=function(){return t};this.getDomElement=function(){return document.querySelector("#"+t)};this.getContext=function(){return s};this.clearContext=function(){s={}};this.isReady=function(){return e.indexOf(this.getId())!=-1};this.isActive=function(){return this.getDomElement().classList.contains("active")};this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))};this.isDirectlyAccessible=function(){var u=document.documentElement.getAttribute("data-view-directly-accessible");u=null==u?"false":u;u=u.toLowerCase();var v=false;if("true"==u){if("false"==this.getDomElement().getAttribute("data-view-directly-accessible")){v=false}else{v=true}}else{if("true"==this.getDomElement().getAttribute("data-view-directly-accessible")){v=true}else{v=false}}return v};this.getFallbackView=function(){var u=this;var w=[this.getId()];do{if(u.isDirectlyAccessible()){return u}var v=this.getDomElement().getAttribute("data-view-fallback");if(null==v||!a.isExisting(v)){console.warn("View: "+this.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view");return a.getDefaultView()}else{u=a.ofId(v);if(w.indexOf(u.getId())!=-1){console.error("cyclical reference of view on fallback configuration on view: "+this.getId());return a.getDefaultView()}w.push(v)}}while(true)};this.setLeaveAnimation=function(u){r=u};this.getLeaveAnimation=function(){return r};this.setEnterAnimation=function(u){q=u};this.getEnterAnimation=function(){return q};Object.freeze&&Object.freeze(this)};a.SWITCHTYPE_HISTORYFORWARD="history.forward";a.SWITCHTYPE_HISTORYBACK="history.back";a.SWITCHTYPE_VIEWSWITCH="view.switch";var k=[];a.currentState=null;i(a);a.ofId=function(s){for(var r=0;r<k.length;r++){if(k[r].getId().toLowerCase().trim()==s.toLowerCase().trim()){return k[r]}}var q=new a(s);
k.push(q);return q};a.isExisting=function(r){for(var q=0;q<k.length;q++){if(k[q].getId().toLowerCase().trim()==r.toLowerCase().trim()){return true}}return false};a.getActiveView=function(){for(var q=0;q<k.length;q++){if(k[q].isActive()){return k[q]}}return null};a.getDefaultView=function(){for(var q=0;q<k.length;q++){if(k[q].isDefault()){return k[q]}}return null};a.switchView=function(q,t,s){var v=a.getActiveView();if(arguments.length<3){s=true}if(arguments.length<2){t=a.SWITCHTYPE_VIEWSWITCH}t=t||a.SWITCHTYPE_VIEWSWITCH;if(""==q.trim()){if(null==a.getDefaultView()){return}else{q=a.getDefaultView().getId()}}if(!a.isExisting(q)){console.error("target view: "+q+" does not exist!");return}console.log(v.getId()+" -> "+q,t);if(v.getId().toLowerCase()==q.toLowerCase()){return}var r=a.ofId(q);t=(t.toLowerCase()==a.SWITCHTYPE_HISTORYFORWARD?a.SWITCHTYPE_HISTORYFORWARD:(t.toLowerCase()==a.SWITCHTYPE_HISTORYBACK?a.SWITCHTYPE_HISTORYBACK:a.SWITCHTYPE_VIEWSWITCH));a.fire("beforechange",{currentView:v,targetView:r,type:t});var u=function(){v.getDomElement().classList.remove("active");r.getDomElement().classList.add("active")};v.fire("leave",t);if(!s){u();if(!r.isReady()){e.push(r.getId());r.fire("ready",t)}r.fire("enter",t)}else{v.getLeaveAnimation()&&v.getLeaveAnimation().call(v.getDomElement(),q,t,u);r.getEnterAnimation()&&r.getEnterAnimation().call(r.getDomElement(),v.getId(),t,function(){u();if(!r.isReady()){e.push(r.getId());r.fire("ready",t)}r.fire("enter",t)})}a.fire("afterchange",{currentView:v,targetView:r,type:t})};a.updateView=function(q,r){var s={viewId:q,timestamp:Date.now()};if(":back"==q.toLowerCase().trim()){history.go(-1);return}if(":forward"==q.toLowerCase().trim()){history.go(1);return}if(!a.isExisting(q)){console.error("target view: "+q+" does not exist!");return}a.currentState=s;if(o){g(q);console.log("pushed state by update view",s)}else{location.hash=q}a.switchView(q,r)};a.ready=(function(){var r=false;var q=[];return function(s){if(r){s&&s();return}if(q.indexOf(s)!=-1){return}q.push(s)};document.addEventListener("DOMContentLoaded",function(){r=true;q.forEach(function(s){s&&s()})})})();var c=function(v){var u=a.getActiveView();console.log(o?"state poped!":"hash changed!","current: "+u.getId());o&&console.log("poped state",JSON.stringify(v.state));var t,s=a.SWITCHTYPE_VIEWSWITCH,r=null;if(!o||null==v.state){t=location.hash.replace(/^#/,"").toLowerCase();if(""==t){r=a.getDefaultView()}else{if(!a.isExisting(t)){r=a.getDefaultView()}else{if(a.ofId(t).isDirectlyAccessible()){r=a.ofId(t)}else{r=a.ofId(t).getFallbackView()}}}s=a.SWITCHTYPE_VIEWSWITCH;location.hash=r.getId()}else{var q=v.state;t=q.viewId;if(null==t||!a.isExisting(t)){r=a.getDefaultView()}else{r=a.ofId(t)}if(a.currentState!=null){s=q.timestamp<a.currentState.timestamp?a.SWITCHTYPE_HISTORYBACK:a.SWITCHTYPE_HISTORYFORWARD}a.currentState=q;f(r.getId(),q.timestamp)}r&&a.switchView(r.getId(),s)};var p=function(){[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(q){a.ofId(q.id)});[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(q){q.classList.add("view")});(function(){var s=null;var r=document.querySelectorAll("*[data-view-default=true][data-view=true]");if(0==r.length){s=document.querySelector("*[data-view=true]");if(null==s){console.warn("No view found!")}else{s.setAttribute("data-view-default","true")}}else{s=r[0];for(var q=1;q<r.length;q++){r[q].removeAttribute("data-view-default")}}})();(function(){h.addTapListener(document.documentElement,function(t){var s=t.changedTouches?t.changedTouches[0].target:t.target;var q;var r=s;while(null==r.getAttribute("data-view-rel")){r=r.parentNode;if(!(r instanceof HTMLElement)){r=null}if(null==r){break}}if(null!=r){q=r.getAttribute("data-view-rel")}if(null==q){return}var u=false;r=s;while(null==r.getAttribute("data-view-rel-disabled")){r=r.parentNode;if(!(r instanceof HTMLElement)){r=null}if(null==r){break}}if(null!=r){u="true"==r.getAttribute("data-view-rel-disabled")}if(u){return}t.preventDefault();if(":back"==q.toLowerCase().trim()){history.go(-1);return}if(":forward"==q.toLowerCase().trim()){history.go(1);return}a.updateView(q,a.SWITCHTYPE_VIEWSWITCH)},{useCapture:true})})();(function(){var q=location.hash.replace(/^#/i,"").toLowerCase();var r=null;if(""==q){r=a.getDefaultView()}else{if(!a.isExisting(q)){r=a.getDefaultView()}else{if(a.ofId(q).isDirectlyAccessible()){r=a.ofId(q)}else{r=a.ofId(q).getFallbackView()}}}if(null!=r){if(o){f(r.getId())}else{location.hash=r.getId()}r.getDomElement().classList.add("active")}})();window.addEventListener(o?"popstate":"hashchange",c)};document.addEventListener("DOMContentLoaded",function(){p();var q=a.getActiveView();if(q){e.push(q.getId());q.fire("ready",a.SWITCHTYPE_VIEWSWITCH);q.fire("enter",a.SWITCHTYPE_VIEWSWITCH)}(function(){var r=document.title;[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(s){var u=s.getAttribute("data-view-title");if(null==u){return}var t=a.ofId(s.id);t.on("enter",function(){document.title=u
});t.on("leave",function(){document.title=r})})})()});return a})();