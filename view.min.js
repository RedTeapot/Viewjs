(function(k,h){var e=/mobile|tablet|ip(ad|hone|od)|android/i;var B=("ontouchstart" in window);var d=e.test(navigator.userAgent);var b=new Object();var n=":back",A=":forward";var a=(function(){var O=function(){if(arguments.length==0){return}var T=arguments;var V=" "+String(arguments[0]);var U=1;V=V.replace(/([^\\])\{\}/g,function(X,Y){var W=(T.length-1)<U?"{}":String(M(T[U]));U++;return Y+W});V=V.replace(/\\\{\}/g,"{}");return V.substring(1)};var Q=function(){var W=new Date();var Y=W.getFullYear();var X="0"+String(W.getMonth()+1);X=X.substring(X.length-2);var T="0"+String(W.getDate());T=T.substring(T.length-2);var U="0"+String(W.getHours());U=U.substring(U.length-2);var Z="0"+String(W.getMinutes());Z=Z.substring(Z.length-2);var V="0"+String(W.getSeconds());V=V.substring(V.length-2);return X+T+" "+U+":"+Z+":"+V};var M=function(V){if(null==V){return null}if((typeof V=="number")||(typeof V=="string")||(typeof V=="boolean")){return V}else{if(typeof V=="function"){return"function "+V.name+"(){...}"}else{if(!(V instanceof Array)&&(typeof V=="object")){if(String(V)!="[object Object]"){return String(V)}else{try{var U={};for(var W in V){U[W]=M(V[W])}return JSON.stringify(U)}catch(T){return String(V)}}}else{if(V instanceof Array){return JSON.stringify(V.map(function(X){return M(X)}))}else{return V}}}}};var L=function(T){return Q()+" ["+T+"]: "};var R={};var K,P;(function(){var T=true;K=function(){return T};P=function(U){T=U}})();var S=function(U){var T=true;this.isEnabled=function(){return K()&&T};this.setIsEnabled=function(V){T=V;return this};this.getName=function(){return U};this.debug=function(){if(!this.isEnabled()){return}var V=O.apply(null,arguments);console.debug(L(U)+V)};this.info=function(){if(!this.isEnabled()){return}var V=O.apply(null,arguments);console.info(L(U)+V)};this.warn=function(){if(!this.isEnabled()){return}var V=O.apply(null,arguments);console.warn(L(U)+V)};this.error=function(){if(!this.isEnabled()){return}var V=O.apply(null,arguments);console.error(L(U)+V)};this.log=function(){if(!this.isEnabled()){return}var V=O.apply(null,arguments);console.log(L(U)+V)}};var N=function(T){if(T in R){return R[T]}var U=new S(T);R[T]=U;return U};S.ofName=N;S.isGloballyEnabled=K;S.setIsGloballyEnabled=P;return S})();var j=a.ofName("View");var D=(function(){var N="  __com.soft.plugin.touch#"+new Date().getTime()+"__  ";var L=function(Q,P){Q=Q||{};P=P||{};for(var R in P){if(!(R in Q)){Q[R]=P[R]}}return Q};var O=function(Q,P){Q=Q||{};Q[P]=Q[P]||{};return Q[P]};var M=function(S,T,Q){if(!d){S.addEventListener?S.addEventListener("click",T):S.attachEvent("onclick",T);return}var R=O(S,N+".tap");R.callbacks=R.callbacks||[];if(R.callbacks.indexOf(T)!=-1){return}R.callbacks.push(T);Q=L(Q,{timespan:500,delta:{},useCapture:false});Q.delta=L(Q.delta,{x:10,y:15});var P=O(S,N+".tap.meta");if(null==P.touchstart){P.touchstart=function(U){var V=U.changedTouches?U.changedTouches[0]:U;R.startX=V.screenX;R.startY=V.screenY;R.startTimestamp=Date.now()};S.addEventListener("touchstart",P.touchstart)}if(null==P.touchend){P.touchend=function(W){var Y=W.changedTouches?W.changedTouches[0]:W;R.stopX=Y.screenX;R.stopY=Y.screenY;R.stopTimestamp=Date.now();var X=R.stopTimestamp-R.startTimestamp,V=Math.abs(R.stopX-R.startX),U=Math.abs(R.stopY-R.startY);if(X<=Q.timespan&&V<=Q.delta.x&&U<=Q.delta.y){R.callbacks.forEach(function(Z){Z&&Z.call(S,W)})}};S.addEventListener("touchend",P.touchend,Q.useCapture)}};var K=function(T,U,P){if(!d){T.removeEventListener?T.removeEventListener("click",U):T.detachEvent("onclick",U);return}if(!T.hasOwnProperty(N)){return}var S=O(T,N+".tap");var R=S.callbacks.indexOf(U);if(R==-1){return}S.callbacks.splice(R,1);if(S.callbacks.length==0){var Q=O(T,N+".tap.meta");T.removeEventListener("touchstart",Q.touchstart);T.removeEventListener("touchend",Q.touchend,P);delete T[N].tap}};return{addTapListener:M,removeTapListener:K}})();var J=("pushState" in history)&&(typeof history.pushState=="function");j.log("History pushState is "+(J?"":"not ")+"supported");var C=[];var f={};var s=function(K,L,M){if(!H.isExisting(K)&&n!=K&&A!=K){throw new o("View of id: "+K+" does not exist.")}if(arguments.length<3){throw new Error("Invalid argument length. Both parameter name and value should be specified.")}f[K]=f[K]||{};f[K][String(L)]=M;return H};var q=function(K,L){if(!H.isExisting(K)&&n!=K&&A!=K){throw new o("View of id: "+K+" does not exist.")}if(undefined===L){L=null}if(typeof L!="object"){throw new Error("Parameters specified should be an object or null.")}f[K]=L;return H};var G=function(K){delete f[K];return H};var r=function(L,K,N){if(arguments.length<3){N=false}L=L||{};K=K||{};for(var M in K){if(!(M in L)||(M in L&&null==L[M]&&N)){L[M]=K[M]}}return L};var y=(function(){var K=function(L,M){this.type=L;this.timestamp=new Date().getTime();this.data=M;Object.freeze&&Object.freeze(this)};return function(M,L){(function(P,N){var O={};P.on=function(R,Q){R=R.toLowerCase();O[R]=O[R]||[];if(O[R].indexOf(Q)!=-1){return}O[R].push(Q)};P.off=function(S,R){S=S.toLowerCase();
O[S]=O[S]||[];var Q=O[S].indexOf(R);if(Q==-1){return}O[S].splice(Q,1)};P.fire=function(Q,S){Q=Q.toLowerCase();var R=new K(Q,S);O[Q]=O[Q]||[];O[Q].forEach(function(T){T.call(N,R)})}})(M,L)}})();var i=function(K,L){if(arguments.length<2){L=Date.now()}Object.defineProperty(this,"viewId",{value:K,configurable:false,writable:false,enumerable:true});Object.defineProperty(this,"timestamp",{value:L,configurable:false,writable:false,enumerable:true});this.toString=function(){return JSON.stringify(this)};this.clone=function(){return JSON.parse(this.toString())}};i.isConstructorOf=function(K){if(null==K||typeof K!="object"){return false}return K.hasOwnProperty("viewId")&&K.hasOwnProperty("timestamp")};var t=function(K,M,N){if(arguments.length<2){M=Date.now()}if(arguments.length<3){N=true}var L=new i(K,M).clone();j.log("↓ {}",JSON.stringify(L));if(J){history.pushState(L,"","#"+K)}else{location.hash=K}H.currentState=L};var m=function(K,M){if(arguments.length<2){M=Date.now()}if(arguments.length<3){updateLocation=true}var L=new i(K,M).clone();j.log("% {}",L.clon);if(J){history.replaceState(L,"","#"+K)}else{location.hash=K}H.currentState=L};var o=function o(K){Error.call(this,K)};o.prototype=Object.create(Error.prototype);var w=function w(K){var M=K,N,L;this.getName=function(){return M};this.getValue=function(){return N};this.setValue=function(O){N=O;return this};this.getApplication=function(){return L};this.setApplication=function(O){L=O;return this};this.apply=function(){if(typeof L=="function"){L(N)}return this};Object.freeze(this)};var p=function p(){var K={};this.has=function(L){return L in K};this.get=function(L){var M;if(L in K){M=K[L]}else{M=new w(L);K[L]=M}return M};this.applyAll=function(){var L=Object.values(K);if(0!=L.length){setTimeout(function(){L.forEach(function(N){try{N.apply()}catch(M){console.error(M)}})},0)}};this.listAll=function(){return Object.keys(K)}};var H=function(O){if(null==document.querySelector("#"+O+"[data-view=true]")){throw new o("View of id: "+O+" does not exist(No element matching pattern: '#"+O+"[data-view=true]' found)!")}var M={};var K=(function(){var P={};Object.defineProperty(P,"has",{value:function(Q){return Q in P},configurable:false,writable:false,enumerable:false});Object.defineProperty(P,"set",{value:function(Q,R){P[Q]=R},configurable:false,writable:false,enumerable:false});Object.defineProperty(P,"get",{value:function(Q,R){return P[Q]},configurable:false,writable:false,enumerable:false});return P})();var N=new p();y(this,document.querySelector("#"+O));var L=this.fire;this.fire=function(P,Q){M[P]=Q;L(P,Q)};Object.defineProperty(this,"logger",{value:a.ofName("View#"+O),configurable:false,writable:false,enumerable:true});Object.defineProperty(this,"config",{value:N,configurable:false,writable:false,enumerable:true});this.getLatestEventData=function(P){return M[P]};this.getId=function(){return O};this.getDomElement=function(){return document.querySelector("#"+O)};this.find=function(P){return this.getDomElement().querySelector(P)};this.findAll=function(P){return this.getDomElement().querySelectorAll(P)};this.getContext=function(){return K};this.clearContext=function(){K={}};this.getParameter=function(P){var Q=f[this.getId()];if(arguments.length<1){return Q}return null==Q?null:Q[P]};this.isReady=function(){return C.indexOf(this.getId())!=-1};this.isActive=function(){return this.getDomElement().classList.contains("active")};this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))};this.isDirectlyAccessible=function(){var P=document.documentElement.getAttribute("data-view-directly-accessible");P=null==P?"false":P;P=P.toLowerCase();var Q=false;if("true"==P){if("false"==this.getDomElement().getAttribute("data-view-directly-accessible")){Q=false}else{Q=true}}else{if("true"==this.getDomElement().getAttribute("data-view-directly-accessible")){Q=true}else{Q=false}}return Q};this.getFallbackView=function(){var P=this;var R=[this.getId()];do{var Q=P.getDomElement().getAttribute("data-view-fallback");if(null==Q||!H.isExisting(Q)){j.warn("View: "+P.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view");return H.getDefaultView()}else{P=H.ofId(Q);if(R.indexOf(P.getId())!=-1){j.error("Cyclical reference of view on fallback configuration on view: {}. Chain: {}, view id: {}",this.getId(),R,P.getId());return H.getDefaultView()}if(P.isDirectlyAccessible()){return P}R.push(Q)}}while(true)};Object.freeze&&Object.freeze(this)};H.SWITCHTYPE_HISTORYFORWARD="history.forward";H.SWITCHTYPE_HISTORYBACK="history.back";H.SWITCHTYPE_VIEWSWITCH="view.switch";var I=[];var F=null;H.currentState=null;y(H);H.ofId=function(M){for(var L=0;L<I.length;L++){if(I[L].getId().trim()==M.trim()){return I[L]}}var K=new H(M);I.push(K);return K};H.isExisting=function(L){for(var K=0;K<I.length;K++){if(I[K].getId().trim()==L.trim()){return true}}return false};H.listAll=function(){return[].concat(I)};H.getActiveView=function(){for(var K=0;
K<I.length;K++){if(I[K].isActive()){return I[K]}}return null};H.getDefaultView=function(){for(var K=0;K<I.length;K++){if(I[K].isDefault()){return I[K]}}return null};H.setSwitchAnimation=function(K){if(!(K instanceof Function)){throw new Error("Invalid argument. Animation of Function is needed.")}F=K;return H};H.getSwitchAnimation=function(){return F};var v=function(M){M=r(M,{srcView:null,targetView:null,type:H.SWITCHTYPE_VIEWSWITCH,withAnimation:true,params:b});var R=M.srcView,K=M.targetView,P=M.type;if(null==P){P=H.SWITCHTYPE_VIEWSWITCH}var S=P.toLowerCase()==H.SWITCHTYPE_HISTORYBACK,Q=P.toLowerCase()==H.SWITCHTYPE_HISTORYFORWARD;if(!S&&!Q){P=H.SWITCHTYPE_VIEWSWITCH}H.fire("beforechange",{currentView:R,targetView:K,type:P});R&&R.fire("leave",{targetView:K,type:P});var O=function(){R&&R.getDomElement().classList.remove("active");K.getDomElement().classList.add("active")};var N=function(){var T=K.getId();G(T);if(S){if(n in f){q(T,f[n]);delete f[n]}}else{if(Q){if(A in f){q(T,f[A]);delete f[A]}}else{if(b!=M.params){q(T,M.params)}}}var U={sourceView:R,type:P};if(!K.isReady()){C.push(T);K.fire("ready",U)}K.fire("beforeenter",U);K.fire("enter",U);K.fire("afterenter",U)};if(!M.withAnimation){O();N()}else{var L=function(){O();N()};if(F){F.call(null,R?R.getDomElement():null,K.getDomElement(),P,L)}else{L()}}H.fire("afterchange",{currentView:R,targetView:K,type:P})};var u=function(K,M){M=r(M,{type:H.SWITCHTYPE_VIEWSWITCH,},true);if(!H.isExisting(K)){throw new Error("Target view: "+K+" does not exist!")}var N=H.getActiveView();if(N.getId().toLowerCase()==K.toLowerCase()){return}j.log("{} → {} {}",N.getId(),K,M.type);var L=H.ofId(K);M.srcView=N;M.targetView=L;v(M);return H};H.show=u;H.switchTo=function(K,M,L,N){if(arguments.length<4){N=null}if(arguments.length<3){L=true}if(arguments.length<2){M=H.SWITCHTYPE_VIEWSWITCH}M=M||H.SWITCHTYPE_VIEWSWITCH;u(K,{type:M,withAnimation:L,params:N});return H};H.switchView=H.switchTo;H.navTo=function(K,L){K=K.trim();var M=new i(K,Date.now());if(n==K){H.back(L);return}if(A==K){H.forward(L);return}u(K,L);t(K);return H};H.updateView=H.navTo;H.back=function(K){G(n);if(null!=K&&"params" in K){console.log("!!!!",f);q(n,K.params)}history.go(-1)};H.forward=function(K){G(A);if(null!=K&&"params" in K){console.log("!!!!",f);q(A,K.params)}history.go(1)};H.changeTo=function(K,L){u(K,L);m(K);return H};var g=document.title;var z=function(K){if(null==K||""==K){console.warn("Invalid document title: "+K);return}document.title=g=K};H.setDocumentTitle=z;H.Logger=a;var c;H.ready=(function(){var L=false;var K=[];c=function(){L=true;setTimeout(function(){K.forEach(function(M){M&&M()})},0)};return function(M){if(L){M&&M();return}if(K.indexOf(M)!=-1){return}K.push(M);return H}})();var l=function(K){var L=null;if(null==K||""==K){L=H.getActiveView()}else{if(!H.isExisting(K)){L=H.getActiveView()}else{if(H.ofId(K).isDirectlyAccessible()){L=H.ofId(K)}else{L=H.ofId(K).getFallbackView()}}}return L};var x=function(P){var O=H.getActiveView();j.log("{} Current: {}",J?"State poped!":"Hash changed!",O.getId());j.log("↑ {}",J?JSON.stringify(P.state):location.hash);var L,N=H.SWITCHTYPE_VIEWSWITCH,M=null;if(null==P.state){N=H.SWITCHTYPE_VIEWSWITCH;L=location.hash.replace(/^#/,"");M=l(L);m(M.getId())}else{var K=P.state;L=K.viewId;if(H.isExisting(L)){M=H.ofId(L)}else{j.warn("Poped view: "+L+" does not exist, keeping current.");M=O}if(H.currentState!=null){N=K.timestamp<H.currentState.timestamp?H.SWITCHTYPE_HISTORYBACK:H.SWITCHTYPE_HISTORYFORWARD}m(M.getId(),K.timestamp)}H.show(M.getId(),{type:N})};var E=function(){window.addEventListener(J?"popstate":"hashchange",x);var L=document.querySelectorAll("*[data-view=true]");var M=null;var K=function(){var O=-1;for(var N=0;N<L.length;N++){if("true"==L[N].getAttribute("data-view-default")){O=N;break}}if(-1!=O){M=L[O];for(var N=O+1;N<L.length;N++){if("true"==L[N].getAttribute("data-view-default")){L[N].removeAttribute("data-view-default")}}}else{if(0!=L.length){M=L[0];M.setAttribute("data-view-default","true")}}return M};[].forEach.call(L,function(N){H.ofId(N.id);N.classList.remove("active");K();if(null!=M){M.classList.add("active")}N.classList.add("view");(function(){var P=N.getAttribute("data-view-title");var O=H.ofId(N.id);O.on("enter",function(){document.title=null==P?g:P})})()});(function(){var Q=null==M?"":M.id;var P=location.hash.replace(/^#/i,"").trim();var N=""==P?Q:P;if(""==N){j.warn("Can not determine the initial view!");return}var O=l(N);j.log("Initial target view: "+O.getId());var R=i.isConstructorOf(history.state);if(null!=history.state){j.log("Found existing state: {}, isViewState? {}",JSON.stringify(history.state),R);if(!(R&&history.state.viewId==O.getId())){m(O.getId())}}else{m(O.getId())}v({srcView:H.getActiveView(),targetView:O,withAnimation:false})})();(function(){D.addTapListener(document.documentElement,function(R){var Q=R.changedTouches?R.changedTouches[0].target:R.target;var N;var P=Q;while(null==P.getAttribute("data-view-rel")){P=P.parentNode;if(!(P instanceof HTMLElement)){P=null
}if(null==P){break}}if(null!=P){N=P.getAttribute("data-view-rel")}if(null==N){return}var S="true"==P.getAttribute("data-view-rel-disabled");if(S){return}R.preventDefault();if(n==N.toLowerCase().trim()){history.go(-1);return}if(A==N.toLowerCase().trim()){history.go(1);return}var O=P.getAttribute("data-view-rel-type");O=null==O||""==O.trim()?"nav":O;if(!/^(?:nav)|(?:change)$/.test(O)){j.warn("Unknown view switch type: {}. {}",O,P);O="nav"}H[O+"To"](N,{type:H.SWITCHTYPE_VIEWSWITCH})},{useCapture:true})})();c()};document.addEventListener("DOMContentLoaded",E);k[h]=H})(window,"View");