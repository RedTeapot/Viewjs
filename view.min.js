window.View=(function(){var j=("pushState" in history)&&(typeof history.pushState=="function");console.log("history.pushState is "+(j?"":"not ")+"supported");var g=function(m,l){m=m||{};l=l||{};for(var n in l){if(!(n in m)){m[n]=l[n]}}return m};var e=function(m,l){(function(o){var n={};o.on=function(q,p){q=q.toLowerCase();n[q]=n[q]||[];if(n[q].indexOf(p)!=-1){return}n[q].push(p)};o.off=function(r,q){r=r.toLowerCase();n[r]=n[r]||[];var p=n[r].indexOf(q);if(p==-1){return}n[r].splice(p,1)};o.fire=function(p,r){p=p.toLowerCase();var q=new i(p,r);n[p]=n[p]||[];n[p].forEach(function(s){s.call(l,q)})}})(m,l)};var c=function(l){history.pushState({viewId:l,timestamp:Date.now()},"","#"+l)};var d=function(l){history.replaceState({viewId:l,timestamp:Date.now()},"","#"+l)};var h=function(l){Error.call(this,l)};h.prototype=Object.create(Error.prototype);var i=function(l,m){this.type=l;this.timestamp=new Date().getTime();this.data=m;Object.freeze&&Object.freeze(this)};var a=function(o){if(null==document.querySelector("#"+o+"[data-view=true]")){throw new h("View of id: "+o+" does not exist(No element matching pattern: '#"+o+"[data-view=true]' found)!")}var n={};e(this,document.querySelector("#"+o));var m=function(p,r,q){};var l=function(r,q,p){p()};this.getId=function(){return o};this.getDomElement=function(){return document.querySelector("#"+o)};this.getContext=function(){return n};this.clearContext=function(){n={}};this.isActive=function(){return this.getDomElement().classList.contains("active")};this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))};this.isDirectlyAccessible=function(){var p=document.documentElement.getAttribute("data-view-directly-accessible");p=null==p?"false":p;p=p.toLowerCase();var q=false;if("true"==p){if("false"==this.getDomElement().getAttribute("data-view-directly-accessible")){q=false}else{q=true}}else{if("true"==this.getDomElement().getAttribute("data-view-directly-accessible")){q=true}else{q=false}}return q};this.getFallbackView=function(){var p=this;var r=[this.getId()];do{if(p.isDirectlyAccessible()){return p}var q=this.getDomElement().getAttribute("data-view-fallback");if(null==q||!a.isExisting(q)){console.warn("View: "+this.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view");return a.getDefaultView()}else{p=a.ofId(q);if(r.indexOf(p.getId())!=-1){console.error("cyclical reference of view on fallback configuration on view: "+this.getId());return a.getDefaultView()}r.push(q)}}while(true)};this.setLeaveAnimation=function(p){m=p};this.getLeaveAnimation=function(){return m};this.setEnterAnimation=function(p){l=p};this.getEnterAnimation=function(){return l};Object.freeze&&Object.freeze(this)};a.SWITCHTYPE_HISTORYFORWARD="history.forward";a.SWITCHTYPE_HISTORYBACK="history.back";a.SWITCHTYPE_VIEWSWITCH="view.switch";var f=[];a.currentState=null;e(a);a.ofId=function(n){for(var m=0;m<f.length;m++){if(f[m].getId().toLowerCase().trim()==n.toLowerCase().trim()){return f[m]}}var l=new a(n);f.push(l);return l};a.isExisting=function(m){for(var l=0;l<f.length;l++){if(f[l].getId().toLowerCase().trim()==m.toLowerCase().trim()){return true}}return false};a.getActiveView=function(){for(var l=0;l<f.length;l++){if(f[l].isActive()){return f[l]}}return null};a.getDefaultView=function(){for(var l=0;l<f.length;l++){if(f[l].isDefault()){return f[l]}}return null};a.switchView=function(l,o,n){var q=a.getActiveView();if(arguments.length<3){n=true}if(arguments.length<2){o=a.SWITCHTYPE_VIEWSWITCH}o=o||a.SWITCHTYPE_VIEWSWITCH;if(""==l.trim()){if(null==a.getDefaultView()){return}else{l=a.getDefaultView().getId()}}if(!a.isExisting(l)){console.error("target view: "+l+" does not exist!");return}console.log(q.getId()+" -> "+l,o);if(q.getId().toLowerCase()==l.toLowerCase()){return}a.fire("beforechange",{currentView:q,targetView:m,type:o});var m=a.ofId(l);o=(o.toLowerCase()==a.SWITCHTYPE_HISTORYFORWARD?a.SWITCHTYPE_HISTORYFORWARD:(o.toLowerCase()==a.SWITCHTYPE_HISTORYBACK?a.SWITCHTYPE_HISTORYBACK:a.SWITCHTYPE_VIEWSWITCH));var p=function(){q.getDomElement().classList.remove("active");m.getDomElement().classList.add("active")};q.fire("leave",o);if(!n){p();m.fire("enter",o);m.fire("ready",o)}else{q.getLeaveAnimation()&&q.getLeaveAnimation().call(q.getDomElement(),l,o,p);m.getEnterAnimation()&&m.getEnterAnimation().call(m.getDomElement(),q.getId(),o,function(){p();m.fire("enter",o);m.fire("ready",o)})}a.fire("afterchange",{currentView:q,targetView:m,type:o})};a.updateView=function(l,m){var n={viewId:l,timestamp:Date.now()};if(":back"==l.toLowerCase().trim()){history.go(-1);return}if(":forward"==l.toLowerCase().trim()){history.go(1);return}if(!a.isExisting(l)){console.error("target view: "+l+" does not exist!");return}a.currentState=n;if(j){c(l);console.log("pushed state by update view",n)}else{location.hash=l}a.switchView(l,m)};var b=function(q){var p=a.getActiveView();console.log(j?"state poped!":"hash changed!","current: "+p.getId());
j&&console.log("poped state",JSON.stringify(q.state));var o,n=a.SWITCHTYPE_VIEWSWITCH,m=null;if(!j||null==q.state){o=location.hash.replace(/^#/,"").toLowerCase();if(""==o){m=a.getDefaultView()}else{if(!a.isExisting(o)){m=a.getDefaultView()}else{if(a.ofId(o).isDirectlyAccessible()){m=a.ofId(o)}else{m=a.ofId(o).getFallbackView()}}}n=a.SWITCHTYPE_VIEWSWITCH}else{var l=q.state;o=l.viewId;if(null==o||!a.isExisting(o)){m=a.getDefaultView()}else{m=a.ofId(o)}if(a.currentState!=null){n=l.timestamp<a.currentState.timestamp?a.SWITCHTYPE_HISTORYBACK:a.SWITCHTYPE_HISTORYFORWARD}a.currentState=l}m&&a.switchView(m.getId(),n);if(null!=m){if(j){d(m.getId())}else{location.hash=m.getId()}}};var k=function(){[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(l){a.ofId(l.id)});[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(l){l.classList.add("view")});(function(){var n=null;var m=document.querySelectorAll("*[data-view-default=true][data-view=true]");if(0==m.length){n=document.querySelector("*[data-view=true]");if(null==n){console.warn("No view found!")}else{n.setAttribute("data-view-default","true")}}else{n=m[0];for(var l=1;l<m.length;l++){m[l].removeAttribute("data-view-default")}}})();(function(){document.addEventListener("touchend",function(o){var n=o.changedTouches[0].target;var l;var m=n;while(null==m.getAttribute("data-view-rel")){m=m.parentNode;if(!(m instanceof HTMLElement)){m=null}if(null==m){break}}if(null!=m){l=m.getAttribute("data-view-rel")}if(null==l){return}var p=false;m=n;while(null==m.getAttribute("data-view-rel-disabled")){m=m.parentNode;if(!(m instanceof HTMLElement)){m=null}if(null==m){break}}if(null!=m){p="true"==m.getAttribute("data-view-rel-disabled")}if(p){return}o.preventDefault();if(":back"==l.toLowerCase().trim()){history.go(-1);return}if(":forward"==l.toLowerCase().trim()){history.go(1);return}a.updateView(l,a.SWITCHTYPE_VIEWSWITCH)},true)})();(function(){var l=location.hash.replace(/^#/i,"").toLowerCase();var m=null;if(""==l){m=a.getDefaultView()}else{if(!a.isExisting(l)){m=a.getDefaultView()}else{if(a.ofId(l).isDirectlyAccessible()){m=a.ofId(l)}else{m=a.ofId(l).getFallbackView()}}}if(null!=m){if(j){d(m.getId())}else{location.hash=m.getId()}m.getDomElement().classList.add("active")}})();window.addEventListener(j?"popstate":"hashchange",b)};document.addEventListener("DOMContentLoaded",function(){k();var l=a.getActiveView();if(l){l.fire("enter",a.SWITCHTYPE_VIEWSWITCH);l.fire("ready",a.SWITCHTYPE_VIEWSWITCH)}});return a})();