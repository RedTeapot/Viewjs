(function(p,D){var u=/mobile|tablet|ip(ad|hone|od)|android/i;var v=("ontouchstart" in window);var n=u.test(navigator.userAgent);var e=new Object();var B=(function(){var I=function(){if(arguments.length==0){return}var N=arguments;var P=" "+String(arguments[0]);var O=1;P=P.replace(/([^\\])\{\}/g,function(R,S){var Q=(N.length-1)<O?"{}":String(G(N[O]));O++;return S+Q});P=P.replace(/\\\{\}/g,"{}");return P.substring(1)};var K=function(){var Q=new Date();var S=Q.getFullYear();var R="0"+String(Q.getMonth()+1);R=R.substring(R.length-2);var N="0"+String(Q.getDate());N=N.substring(N.length-2);var O="0"+String(Q.getHours());O=O.substring(O.length-2);var T="0"+String(Q.getMinutes());T=T.substring(T.length-2);var P="0"+String(Q.getSeconds());P=P.substring(P.length-2);return R+N+" "+O+":"+T+":"+P};var G=function(P){if(null==P){return null}if((typeof P=="number")||(typeof P=="string")||(typeof P=="boolean")){return P}else{if(typeof P=="function"){return"function "+P.name+"(){...}"}else{if(!(P instanceof Array)&&(typeof P=="object")){if(String(P)!="[object Object]"){return String(P)}else{try{var O={};for(var Q in P){O[Q]=G(P[Q])}return JSON.stringify(O)}catch(N){return String(P)}}}else{if(P instanceof Array){return JSON.stringify(P.map(function(R){return G(R)}))}else{return P}}}}};var F=function(N){return K()+" ["+N+"]: "};var L={};var E,J;(function(){var N=true;E=function(){return N};J=function(O){N=O}})();var M=function(O){var N=true;this.isEnabled=function(){return E()&&N};this.setIsEnabled=function(P){N=P;return this};this.getName=function(){return O};this.debug=function(){if(!this.isEnabled()){return}var P=I.apply(null,arguments);console.debug(F(O)+P)};this.info=function(){if(!this.isEnabled()){return}var P=I.apply(null,arguments);console.info(F(O)+P)};this.warn=function(){if(!this.isEnabled()){return}var P=I.apply(null,arguments);console.warn(F(O)+P)};this.error=function(){if(!this.isEnabled()){return}var P=I.apply(null,arguments);console.error(F(O)+P)};this.log=function(){if(!this.isEnabled()){return}var P=I.apply(null,arguments);console.log(F(O)+P)}};var H=function(N){if(N in L){return L[N]}var O=new M(N);L[N]=O;return O};M.ofName=H;M.isGloballyEnabled=E;M.setIsGloballyEnabled=J;return M})();var k=B.ofName("View");var h=(function(){var H="  __com.soft.plugin.touch#"+new Date().getTime()+"__  ";var F=function(K,J){K=K||{};J=J||{};for(var L in J){if(!(L in K)){K[L]=J[L]}}return K};var I=function(K,J){K=K||{};K[J]=K[J]||{};return K[J]};var G=function(M,N,K){if(!n){M.addEventListener?M.addEventListener("click",N):M.attachEvent("onclick",N);return}var L=I(M,H+".tap");L.callbacks=L.callbacks||[];if(L.callbacks.indexOf(N)!=-1){return}L.callbacks.push(N);K=F(K,{timespan:500,delta:{},useCapture:false});K.delta=F(K.delta,{x:10,y:15});var J=I(M,H+".tap.meta");if(null==J.touchstart){J.touchstart=function(O){var P=O.changedTouches?O.changedTouches[0]:O;L.startX=P.screenX;L.startY=P.screenY;L.startTimestamp=Date.now()};M.addEventListener("touchstart",J.touchstart)}if(null==J.touchend){J.touchend=function(Q){var S=Q.changedTouches?Q.changedTouches[0]:Q;L.stopX=S.screenX;L.stopY=S.screenY;L.stopTimestamp=Date.now();var R=L.stopTimestamp-L.startTimestamp,P=Math.abs(L.stopX-L.startX),O=Math.abs(L.stopY-L.startY);if(R<=K.timespan&&P<=K.delta.x&&O<=K.delta.y){L.callbacks.forEach(function(T){T&&T.call(M,Q)})}};M.addEventListener("touchend",J.touchend,K.useCapture)}};var E=function(N,O,J){if(!n){N.removeEventListener?N.removeEventListener("click",O):N.detachEvent("onclick",O);return}if(!N.hasOwnProperty(H)){return}var M=I(N,H+".tap");var L=M.callbacks.indexOf(O);if(L==-1){return}M.callbacks.splice(L,1);if(M.callbacks.length==0){var K=I(N,H+".tap.meta");N.removeEventListener("touchstart",K.touchstart);N.removeEventListener("touchend",K.touchend,J);delete N[H].tap}};return{addTapListener:G,removeTapListener:E}})();var x=("pushState" in history)&&(typeof history.pushState=="function");k.log("History pushState is "+(x?"":"not ")+"supported");var d=[];var r={};var a=function(E,F,G){if(!s.isExisting(E)){throw new f("View of id: "+E+" does not exist.")}if(arguments.length<3){throw new Error("Invalid argument length. Both parameter name and value should be specified.")}r[E]=r[E]||{};r[E][String(F)]=G;return s};var g=function(E,H){if(!s.isExisting(E)){throw new f("View of id: "+E+" does not exist.")}if(null==H||typeof H!="object"){throw new Error("Parameters specified should be an object.")}r[E]=r[E]||{};var G=r[E];for(var F in H){G[F]=H[F]}return s};var C=function(E){delete r[E];return s};var c=function(F,E,H){if(arguments.length<3){H=false}F=F||{};E=E||{};for(var G in E){if(!(G in F)||(G in F&&null==F[G]&&H)){F[G]=E[G]}}return F};var q=(function(){var E=function(F,G){this.type=F;this.timestamp=new Date().getTime();this.data=G;Object.freeze&&Object.freeze(this)};return function(G,F){(function(J,H){var I={};J.on=function(L,K){L=L.toLowerCase();I[L]=I[L]||[];if(I[L].indexOf(K)!=-1){return}I[L].push(K)};J.off=function(M,L){M=M.toLowerCase();I[M]=I[M]||[];
var K=I[M].indexOf(L);if(K==-1){return}I[M].splice(K,1)};J.fire=function(K,M){K=K.toLowerCase();var L=new E(K,M);I[K]=I[K]||[];I[K].forEach(function(N){N.call(H,L)})}})(G,F)}})();var j=function(E,F){if(arguments.length<2){F=Date.now()}Object.defineProperty(this,"viewId",{value:E,configurable:false,writable:false,enumerable:true});Object.defineProperty(this,"timestamp",{value:F,configurable:false,writable:false,enumerable:true});this.toString=function(){return JSON.stringify(this)};this.clone=function(){return JSON.parse(this.toString())}};j.isConstructorOf=function(E){if(null==E||typeof E!="object"){return false}return E.hasOwnProperty("viewId")&&E.hasOwnProperty("timestamp")};var y=function(E,G,H){if(arguments.length<2){G=Date.now()}if(arguments.length<3){H=true}var F=new j(E,G).clone();k.log("↓ {}",JSON.stringify(F));if(x){history.pushState(F,"","#"+E)}else{location.hash=E}s.currentState=F};var o=function(E,G){if(arguments.length<2){G=Date.now()}if(arguments.length<3){updateLocation=true}var F=new j(E,G).clone();k.log("% {}",F.clon);if(x){history.replaceState(F,"","#"+E)}else{location.hash=E}s.currentState=F};var f=function(E){Error.call(this,E)};f.prototype=Object.create(Error.prototype);var s=function(H){if(null==document.querySelector("#"+H+"[data-view=true]")){throw new f("View of id: "+H+" does not exist(No element matching pattern: '#"+H+"[data-view=true]' found)!")}var G={};var E=(function(){var I={};Object.defineProperty(I,"has",{value:function(J){return J in I},configurable:false,writable:false,enumerable:false});Object.defineProperty(I,"set",{value:function(J,K){I[J]=K},configurable:false,writable:false,enumerable:false});Object.defineProperty(I,"get",{value:function(J,K){return I[J]},configurable:false,writable:false,enumerable:false});return I})();q(this,document.querySelector("#"+H));var F=this.fire;this.fire=function(I,J){G[I]=J;F(I,J)};Object.defineProperty(this,"logger",{value:B.ofName("View#"+H),configurable:false,writable:false,enumerable:true});this.getLatestEventData=function(I){return G[I]};this.getId=function(){return H};this.getDomElement=function(){return document.querySelector("#"+H)};this.find=function(I){return this.getDomElement().querySelector(I)};this.findAll=function(I){return this.getDomElement().querySelectorAll(I)};this.getContext=function(){return E};this.clearContext=function(){E={}};this.getParameter=function(I){var J=r[this.getId()];if(arguments.length<1){return J}return null==J?null:J[I]};this.setParameter=function(I,J){if(arguments.length<2){throw new Error("Invalid argument length. Both name and value should be specified.")}a(this.getId(),I,J);return this};this.setParameters=function(I){if(arguments.length<1){throw new Error("No key-value map specified.")}g(I);return this};this.isReady=function(){return d.indexOf(this.getId())!=-1};this.isActive=function(){return this.getDomElement().classList.contains("active")};this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))};this.isDirectlyAccessible=function(){var I=document.documentElement.getAttribute("data-view-directly-accessible");I=null==I?"false":I;I=I.toLowerCase();var J=false;if("true"==I){if("false"==this.getDomElement().getAttribute("data-view-directly-accessible")){J=false}else{J=true}}else{if("true"==this.getDomElement().getAttribute("data-view-directly-accessible")){J=true}else{J=false}}return J};this.getFallbackView=function(){var I=this;var K=[this.getId()];do{var J=I.getDomElement().getAttribute("data-view-fallback");if(null==J||!s.isExisting(J)){k.warn("View: "+I.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view");return s.getDefaultView()}else{I=s.ofId(J);if(K.indexOf(I.getId())!=-1){k.error("Cyclical reference of view on fallback configuration on view: {}. Chain: {}, view id: {}",this.getId(),K,I.getId());return s.getDefaultView()}if(I.isDirectlyAccessible()){return I}K.push(J)}}while(true)};Object.freeze&&Object.freeze(this)};s.SWITCHTYPE_HISTORYFORWARD="history.forward";s.SWITCHTYPE_HISTORYBACK="history.back";s.SWITCHTYPE_VIEWSWITCH="view.switch";var l=[];var A=null;s.currentState=null;q(s);s.ofId=function(G){for(var F=0;F<l.length;F++){if(l[F].getId().trim()==G.trim()){return l[F]}}var E=new s(G);l.push(E);return E};s.isExisting=function(F){for(var E=0;E<l.length;E++){if(l[E].getId().trim()==F.trim()){return true}}return false};s.getActiveView=function(){for(var E=0;E<l.length;E++){if(l[E].isActive()){return l[E]}}return null};s.getDefaultView=function(){for(var E=0;E<l.length;E++){if(l[E].isDefault()){return l[E]}}return null};s.setSwitchAnimation=function(E){if(!(E instanceof Function)){throw new Error("Invalid argument. Animation of Function is needed.")}A=E;return s};s.getSwitchAnimation=function(){return A};var m=function(I){I=c(I,{srcView:null,targetView:null,type:s.SWITCHTYPE_VIEWSWITCH,withAnimation:true,params:e});var F=I.srcView,E=I.targetView,H=I.type||s.SWITCHTYPE_VIEWSWITCH;H=(H.toLowerCase()==s.SWITCHTYPE_HISTORYFORWARD?s.SWITCHTYPE_HISTORYFORWARD:(H.toLowerCase()==s.SWITCHTYPE_HISTORYBACK?s.SWITCHTYPE_HISTORYBACK:s.SWITCHTYPE_VIEWSWITCH));
s.fire("beforechange",{currentView:F,targetView:E,type:H});F&&F.fire("leave",H);var J=function(){F&&F.getDomElement().classList.remove("active");E.getDomElement().classList.add("active")};var K=function(){var L=E.getId();if(e!=I.params&&null!=I.params){g(E.getId(),I.params)}if(!E.isReady()){d.push(L);E.fire("ready",H)}E.fire("beforeenter",H);E.fire("enter",H);E.fire("afterenter",H)};if(!I.withAnimation){J();K()}else{var G=function(){J();K()};if(A){A.call(null,F?F.getDomElement():null,E.getDomElement(),H,G)}else{G()}}s.fire("afterchange",{currentView:F,targetView:E,type:H})};var z=function(E,G){G=c(G,{type:s.SWITCHTYPE_VIEWSWITCH,},true);if(!s.isExisting(E)){throw new Error("Target view: "+E+" does not exist!")}var H=s.getActiveView();if(H.getId().toLowerCase()==E.toLowerCase()){return}k.log("{} → {} {}",H.getId(),E,G.type);var F=s.ofId(E);G.srcView=H;G.targetView=F;m(G);return s};s.show=z;s.switchTo=function(E,G,F,H){if(arguments.length<4){H=null}if(arguments.length<3){F=true}if(arguments.length<2){G=s.SWITCHTYPE_VIEWSWITCH}G=G||s.SWITCHTYPE_VIEWSWITCH;z(E,{type:G,withAnimation:F,params:H});return s};s.switchView=s.switchTo;s.navTo=function(E,F){var G=new j(E,Date.now());if(":back"==E.toLowerCase().trim()){history.go(-1);return}if(":forward"==E.toLowerCase().trim()){history.go(1);return}z(E,F);y(E);return s};s.updateView=s.navTo;s.back=function(){history.go(-1)};s.forward=function(){history.go(1)};s.changeTo=function(E,F){z(E,F);o(E);return s};s.Logger=B;var i;s.ready=(function(){var F=false;var E=[];i=function(){F=true;setTimeout(function(){E.forEach(function(G){G&&G()})},0)};return function(G){if(F){G&&G();return}if(E.indexOf(G)!=-1){return}E.push(G);return s}})();var w=function(E){var F=null;if(null==E||""==E){F=s.getActiveView()}else{if(!s.isExisting(E)){F=s.getActiveView()}else{if(s.ofId(E).isDirectlyAccessible()){F=s.ofId(E)}else{F=s.ofId(E).getFallbackView()}}}return F};var b=function(J){var I=s.getActiveView();k.log("{} Current: {}",x?"State poped!":"Hash changed!",I.getId());k.log("↑ {}",x?JSON.stringify(J.state):location.hash);var F,H=s.SWITCHTYPE_VIEWSWITCH,G=null;if(null==J.state){H=s.SWITCHTYPE_VIEWSWITCH;F=location.hash.replace(/^#/,"").toLowerCase();G=w(F);o(G.getId())}else{var E=J.state;F=E.viewId;if(s.isExisting(F)){G=s.ofId(F)}else{k.warn("Poped view: "+F+" does not exist, keeping current.");G=I}if(s.currentState!=null){H=E.timestamp<s.currentState.timestamp?s.SWITCHTYPE_HISTORYBACK:s.SWITCHTYPE_HISTORYFORWARD}o(G.getId(),E.timestamp)}s.switchTo(G.getId(),H)};var t=function(){window.addEventListener(x?"popstate":"hashchange",b);var G=document.querySelectorAll("*[data-view=true]");var H=null;var F=document.title;var E=function(){var J=-1;for(var I=0;I<G.length;I++){if("true"==G[I].getAttribute("data-view-default")){J=I;break}}if(-1!=J){H=G[J];for(var I=J+1;I<G.length;I++){if("true"==G[I].getAttribute("data-view-default")){G[I].removeAttribute("data-view-default")}}}else{if(0!=G.length){H=G[0];H.setAttribute("data-view-default","true")}}return H};[].forEach.call(G,function(I){s.ofId(I.id);I.classList.remove("active");E();if(null!=H){H.classList.add("active")}I.classList.add("view");(function(){var K=I.getAttribute("data-view-title");var J=s.ofId(I.id);J.on("enter",function(){document.title=null==K?F:K})})()});(function(){var L=s.getDefaultView().getId();var K=location.hash.replace(/^#/i,"").toLowerCase().trim();var I=""==K?s.getDefaultView().getId():K;var J=w(I);k.log("Initial target view: "+J.getId());var M=j.isConstructorOf(history.state);if(null!=history.state){k.log("Found existing state: {}, isViewState? {}",JSON.stringify(history.state),M);if(!(M&&history.state.viewId==J.getId())){o(J.getId())}}else{o(J.getId())}m({srcView:s.getActiveView(),targetView:J,withAnimation:false})})();(function(){h.addTapListener(document.documentElement,function(M){var L=M.changedTouches?M.changedTouches[0].target:M.target;var I;var K=L;while(null==K.getAttribute("data-view-rel")){K=K.parentNode;if(!(K instanceof HTMLElement)){K=null}if(null==K){break}}if(null!=K){I=K.getAttribute("data-view-rel")}if(null==I){return}var N="true"==K.getAttribute("data-view-rel-disabled");if(N){return}if(":back"==I.toLowerCase().trim()){history.go(-1);return}if(":forward"==I.toLowerCase().trim()){history.go(1);return}var J=K.getAttribute("data-view-rel-type");J=null==J||""==J.trim()?"nav":J;if(!/^(?:nav)|(?:change)$/.test(J)){k.warn("Unknown view switch type: {}. {}",J,K);J="nav"}s[J+"To"](I,{type:s.SWITCHTYPE_VIEWSWITCH});M.preventDefault()},{useCapture:true})})();i()};document.addEventListener("DOMContentLoaded",t);p[D]=s})(window,"View");