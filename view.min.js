window.View=(function(){var k=("pushState" in history)&&(typeof history.pushState=="function");console.log("history.pushState is "+(k?"":"not ")+"supported");var c=[];var h=function(n,m){n=n||{};m=m||{};for(var o in m){if(!(o in n)){n[o]=m[o]}}return n};var f=function(n,m){(function(p){var o={};p.on=function(r,q){r=r.toLowerCase();o[r]=o[r]||[];if(o[r].indexOf(q)!=-1){return}o[r].push(q)};p.off=function(s,r){s=s.toLowerCase();o[s]=o[s]||[];var q=o[s].indexOf(r);if(q==-1){return}o[s].splice(q,1)};p.fire=function(q,s){q=q.toLowerCase();var r=new j(q,s);o[q]=o[q]||[];o[q].forEach(function(t){t.call(m,r)})}})(n,m)};var d=function(m,n){history.pushState({viewId:m,timestamp:null==n?Date.now():n},"","#"+m)};var e=function(m,n){history.replaceState({viewId:m,timestamp:null==n?Date.now():n},"","#"+m)};var i=function(m){Error.call(this,m)};i.prototype=Object.create(Error.prototype);var j=function(m,n){this.type=m;this.timestamp=new Date().getTime();this.data=n;Object.freeze&&Object.freeze(this)};var a=function(p){if(null==document.querySelector("#"+p+"[data-view=true]")){throw new i("View of id: "+p+" does not exist(No element matching pattern: '#"+p+"[data-view=true]' found)!")}var o={};f(this,document.querySelector("#"+p));var n=function(q,s,r){};var m=function(s,r,q){q()};this.getId=function(){return p};this.getDomElement=function(){return document.querySelector("#"+p)};this.getContext=function(){return o};this.clearContext=function(){o={}};this.isReady=function(){return c.indexOf(this.getId())!=-1};this.isActive=function(){return this.getDomElement().classList.contains("active")};this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))};this.isDirectlyAccessible=function(){var q=document.documentElement.getAttribute("data-view-directly-accessible");q=null==q?"false":q;q=q.toLowerCase();var r=false;if("true"==q){if("false"==this.getDomElement().getAttribute("data-view-directly-accessible")){r=false}else{r=true}}else{if("true"==this.getDomElement().getAttribute("data-view-directly-accessible")){r=true}else{r=false}}return r};this.getFallbackView=function(){var q=this;var s=[this.getId()];do{if(q.isDirectlyAccessible()){return q}var r=this.getDomElement().getAttribute("data-view-fallback");if(null==r||!a.isExisting(r)){console.warn("View: "+this.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view");return a.getDefaultView()}else{q=a.ofId(r);if(s.indexOf(q.getId())!=-1){console.error("cyclical reference of view on fallback configuration on view: "+this.getId());return a.getDefaultView()}s.push(r)}}while(true)};this.setLeaveAnimation=function(q){n=q};this.getLeaveAnimation=function(){return n};this.setEnterAnimation=function(q){m=q};this.getEnterAnimation=function(){return m};Object.freeze&&Object.freeze(this)};a.SWITCHTYPE_HISTORYFORWARD="history.forward";a.SWITCHTYPE_HISTORYBACK="history.back";a.SWITCHTYPE_VIEWSWITCH="view.switch";var g=[];a.currentState=null;f(a);a.ofId=function(o){for(var n=0;n<g.length;n++){if(g[n].getId().toLowerCase().trim()==o.toLowerCase().trim()){return g[n]}}var m=new a(o);g.push(m);return m};a.isExisting=function(n){for(var m=0;m<g.length;m++){if(g[m].getId().toLowerCase().trim()==n.toLowerCase().trim()){return true}}return false};a.getActiveView=function(){for(var m=0;m<g.length;m++){if(g[m].isActive()){return g[m]}}return null};a.getDefaultView=function(){for(var m=0;m<g.length;m++){if(g[m].isDefault()){return g[m]}}return null};a.switchView=function(m,p,o){var r=a.getActiveView();if(arguments.length<3){o=true}if(arguments.length<2){p=a.SWITCHTYPE_VIEWSWITCH}p=p||a.SWITCHTYPE_VIEWSWITCH;if(""==m.trim()){if(null==a.getDefaultView()){return}else{m=a.getDefaultView().getId()}}if(!a.isExisting(m)){console.error("target view: "+m+" does not exist!");return}console.log(r.getId()+" -> "+m,p);if(r.getId().toLowerCase()==m.toLowerCase()){return}a.fire("beforechange",{currentView:r,targetView:n,type:p});var n=a.ofId(m);p=(p.toLowerCase()==a.SWITCHTYPE_HISTORYFORWARD?a.SWITCHTYPE_HISTORYFORWARD:(p.toLowerCase()==a.SWITCHTYPE_HISTORYBACK?a.SWITCHTYPE_HISTORYBACK:a.SWITCHTYPE_VIEWSWITCH));var q=function(){r.getDomElement().classList.remove("active");n.getDomElement().classList.add("active")};r.fire("leave",p);if(!o){q();if(!n.isReady()){c.push(n.getId());n.fire("ready",p)}n.fire("enter",p)}else{r.getLeaveAnimation()&&r.getLeaveAnimation().call(r.getDomElement(),m,p,q);n.getEnterAnimation()&&n.getEnterAnimation().call(n.getDomElement(),r.getId(),p,function(){q();if(!n.isReady()){c.push(n.getId());n.fire("ready",p)}n.fire("enter",p)})}a.fire("afterchange",{currentView:r,targetView:n,type:p})};a.updateView=function(m,n){var o={viewId:m,timestamp:Date.now()};if(":back"==m.toLowerCase().trim()){history.go(-1);return}if(":forward"==m.toLowerCase().trim()){history.go(1);return}if(!a.isExisting(m)){console.error("target view: "+m+" does not exist!");return}a.currentState=o;if(k){d(m);console.log("pushed state by update view",o)
}else{location.hash=m}a.switchView(m,n)};var b=function(r){var q=a.getActiveView();console.log(k?"state poped!":"hash changed!","current: "+q.getId());k&&console.log("poped state",JSON.stringify(r.state));var p,o=a.SWITCHTYPE_VIEWSWITCH,n=null;if(!k||null==r.state){p=location.hash.replace(/^#/,"").toLowerCase();if(""==p){n=a.getDefaultView()}else{if(!a.isExisting(p)){n=a.getDefaultView()}else{if(a.ofId(p).isDirectlyAccessible()){n=a.ofId(p)}else{n=a.ofId(p).getFallbackView()}}}o=a.SWITCHTYPE_VIEWSWITCH;location.hash=n.getId()}else{var m=r.state;p=m.viewId;if(null==p||!a.isExisting(p)){n=a.getDefaultView()}else{n=a.ofId(p)}if(a.currentState!=null){o=m.timestamp<a.currentState.timestamp?a.SWITCHTYPE_HISTORYBACK:a.SWITCHTYPE_HISTORYFORWARD}a.currentState=m;e(n.getId(),m.timestamp)}n&&a.switchView(n.getId(),o)};var l=function(){[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(m){a.ofId(m.id)});[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(m){m.classList.add("view")});(function(){var o=null;var n=document.querySelectorAll("*[data-view-default=true][data-view=true]");if(0==n.length){o=document.querySelector("*[data-view=true]");if(null==o){console.warn("No view found!")}else{o.setAttribute("data-view-default","true")}}else{o=n[0];for(var m=1;m<n.length;m++){n[m].removeAttribute("data-view-default")}}})();(function(){document.addEventListener("touchend",function(p){var o=p.changedTouches[0].target;var m;var n=o;while(null==n.getAttribute("data-view-rel")){n=n.parentNode;if(!(n instanceof HTMLElement)){n=null}if(null==n){break}}if(null!=n){m=n.getAttribute("data-view-rel")}if(null==m){return}var q=false;n=o;while(null==n.getAttribute("data-view-rel-disabled")){n=n.parentNode;if(!(n instanceof HTMLElement)){n=null}if(null==n){break}}if(null!=n){q="true"==n.getAttribute("data-view-rel-disabled")}if(q){return}p.preventDefault();if(":back"==m.toLowerCase().trim()){history.go(-1);return}if(":forward"==m.toLowerCase().trim()){history.go(1);return}a.updateView(m,a.SWITCHTYPE_VIEWSWITCH)},true)})();(function(){var m=location.hash.replace(/^#/i,"").toLowerCase();var n=null;if(""==m){n=a.getDefaultView()}else{if(!a.isExisting(m)){n=a.getDefaultView()}else{if(a.ofId(m).isDirectlyAccessible()){n=a.ofId(m)}else{n=a.ofId(m).getFallbackView()}}}if(null!=n){if(k){e(n.getId())}else{location.hash=n.getId()}n.getDomElement().classList.add("active")}})();window.addEventListener(k?"popstate":"hashchange",b)};document.addEventListener("DOMContentLoaded",function(){l();var m=a.getActiveView();if(m){c.push(m.getId());m.fire("ready",a.SWITCHTYPE_VIEWSWITCH);m.fire("enter",a.SWITCHTYPE_VIEWSWITCH)}});return a})();