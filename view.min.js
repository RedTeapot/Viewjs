(function(t,F){var x=/mobile|tablet|ip(ad|hone|od)|android/i;var y=("ontouchstart" in window);var p=x.test(navigator.userAgent);var f=new Object();var b=":back",q=":forward";var E=(function(){var K=function(){if(arguments.length==0){return}var P=arguments;var R=" "+String(arguments[0]);var Q=1;R=R.replace(/([^\\])\{\}/g,function(T,U){var S=(P.length-1)<Q?"{}":String(I(P[Q]));Q++;return U+S});R=R.replace(/\\\{\}/g,"{}");return R.substring(1)};var M=function(){var S=new Date();var U=S.getFullYear();var T="0"+String(S.getMonth()+1);T=T.substring(T.length-2);var P="0"+String(S.getDate());P=P.substring(P.length-2);var Q="0"+String(S.getHours());Q=Q.substring(Q.length-2);var V="0"+String(S.getMinutes());V=V.substring(V.length-2);var R="0"+String(S.getSeconds());R=R.substring(R.length-2);return T+P+" "+Q+":"+V+":"+R};var I=function(R){if(null==R){return null}if((typeof R=="number")||(typeof R=="string")||(typeof R=="boolean")){return R}else{if(typeof R=="function"){return"function "+R.name+"(){...}"}else{if(!(R instanceof Array)&&(typeof R=="object")){if(String(R)!="[object Object]"){return String(R)}else{try{var Q={};for(var S in R){Q[S]=I(R[S])}return JSON.stringify(Q)}catch(P){return String(R)}}}else{if(R instanceof Array){return JSON.stringify(R.map(function(T){return I(T)}))}else{return R}}}}};var H=function(P){return M()+" ["+P+"]: "};var N={};var G,L;(function(){var P=true;G=function(){return P};L=function(Q){P=Q}})();var O=function(Q){var P=true;this.isEnabled=function(){return G()&&P};this.setIsEnabled=function(R){P=R;return this};this.getName=function(){return Q};this.debug=function(){if(!this.isEnabled()){return}var R=K.apply(null,arguments);console.debug(H(Q)+R)};this.info=function(){if(!this.isEnabled()){return}var R=K.apply(null,arguments);console.info(H(Q)+R)};this.warn=function(){if(!this.isEnabled()){return}var R=K.apply(null,arguments);console.warn(H(Q)+R)};this.error=function(){if(!this.isEnabled()){return}var R=K.apply(null,arguments);console.error(H(Q)+R)};this.log=function(){if(!this.isEnabled()){return}var R=K.apply(null,arguments);console.log(H(Q)+R)}};var J=function(P){if(P in N){return N[P]}var Q=new O(P);N[P]=Q;return Q};O.ofName=J;O.isGloballyEnabled=G;O.setIsGloballyEnabled=L;return O})();var m=E.ofName("View");var i=(function(){var J="  __com.soft.plugin.touch#"+new Date().getTime()+"__  ";var H=function(M,L){M=M||{};L=L||{};for(var N in L){if(!(N in M)){M[N]=L[N]}}return M};var K=function(M,L){M=M||{};M[L]=M[L]||{};return M[L]};var I=function(O,P,M){if(!p){O.addEventListener?O.addEventListener("click",P):O.attachEvent("onclick",P);return}var N=K(O,J+".tap");N.callbacks=N.callbacks||[];if(N.callbacks.indexOf(P)!=-1){return}N.callbacks.push(P);M=H(M,{timespan:500,delta:{},useCapture:false});M.delta=H(M.delta,{x:10,y:15});var L=K(O,J+".tap.meta");if(null==L.touchstart){L.touchstart=function(Q){var R=Q.changedTouches?Q.changedTouches[0]:Q;N.startX=R.screenX;N.startY=R.screenY;N.startTimestamp=Date.now()};O.addEventListener("touchstart",L.touchstart)}if(null==L.touchend){L.touchend=function(S){var U=S.changedTouches?S.changedTouches[0]:S;N.stopX=U.screenX;N.stopY=U.screenY;N.stopTimestamp=Date.now();var T=N.stopTimestamp-N.startTimestamp,R=Math.abs(N.stopX-N.startX),Q=Math.abs(N.stopY-N.startY);if(T<=M.timespan&&R<=M.delta.x&&Q<=M.delta.y){N.callbacks.forEach(function(V){V&&V.call(O,S)})}};O.addEventListener("touchend",L.touchend,M.useCapture)}};var G=function(P,Q,L){if(!p){P.removeEventListener?P.removeEventListener("click",Q):P.detachEvent("onclick",Q);return}if(!P.hasOwnProperty(J)){return}var O=K(P,J+".tap");var N=O.callbacks.indexOf(Q);if(N==-1){return}O.callbacks.splice(N,1);if(O.callbacks.length==0){var M=K(P,J+".tap.meta");P.removeEventListener("touchstart",M.touchstart);P.removeEventListener("touchend",M.touchend,L);delete P[J].tap}};return{addTapListener:I,removeTapListener:G}})();var A=("pushState" in history)&&(typeof history.pushState=="function");m.log("History pushState is "+(A?"":"not ")+"supported");var e=[];var u={};var a=function(G,H,I){if(!v.isExisting(G)&&b!=G&&q!=G){throw new g("View of id: "+G+" does not exist.")}if(arguments.length<3){throw new Error("Invalid argument length. Both parameter name and value should be specified.")}u[G]=u[G]||{};u[G][String(H)]=I;return v};var h=function(G,H){if(!v.isExisting(G)&&b!=G&&q!=G){throw new g("View of id: "+G+" does not exist.")}if(undefined===H){H=null}if(typeof H!="object"){throw new Error("Parameters specified should be an object or null.")}u[G]=H;return v};var k=function(G){delete u[G];return v};var d=function(H,G,J){if(arguments.length<3){J=false}H=H||{};G=G||{};for(var I in G){if(!(I in H)||(I in H&&null==H[I]&&J)){H[I]=G[I]}}return H};var s=(function(){var G=function(H,I){this.type=H;this.timestamp=new Date().getTime();this.data=I;Object.freeze&&Object.freeze(this)};return function(I,H){(function(L,J){var K={};L.on=function(N,M){N=N.toLowerCase();K[N]=K[N]||[];if(K[N].indexOf(M)!=-1){return}K[N].push(M)};L.off=function(O,N){O=O.toLowerCase();
K[O]=K[O]||[];var M=K[O].indexOf(N);if(M==-1){return}K[O].splice(M,1)};L.fire=function(M,O){M=M.toLowerCase();var N=new G(M,O);K[M]=K[M]||[];K[M].forEach(function(P){P.call(J,N)})}})(I,H)}})();var l=function(G,H){if(arguments.length<2){H=Date.now()}Object.defineProperty(this,"viewId",{value:G,configurable:false,writable:false,enumerable:true});Object.defineProperty(this,"timestamp",{value:H,configurable:false,writable:false,enumerable:true});this.toString=function(){return JSON.stringify(this)};this.clone=function(){return JSON.parse(this.toString())}};l.isConstructorOf=function(G){if(null==G||typeof G!="object"){return false}return G.hasOwnProperty("viewId")&&G.hasOwnProperty("timestamp")};var B=function(G,I,J){if(arguments.length<2){I=Date.now()}if(arguments.length<3){J=true}var H=new l(G,I).clone();m.log("↓ {}",JSON.stringify(H));if(A){history.pushState(H,"","#"+G)}else{location.hash=G}v.currentState=H};var r=function(G,I){if(arguments.length<2){I=Date.now()}if(arguments.length<3){updateLocation=true}var H=new l(G,I).clone();m.log("% {}",H.clon);if(A){history.replaceState(H,"","#"+G)}else{location.hash=G}v.currentState=H};var g=function(G){Error.call(this,G)};g.prototype=Object.create(Error.prototype);var v=function(J){if(null==document.querySelector("#"+J+"[data-view=true]")){throw new g("View of id: "+J+" does not exist(No element matching pattern: '#"+J+"[data-view=true]' found)!")}var I={};var G=(function(){var K={};Object.defineProperty(K,"has",{value:function(L){return L in K},configurable:false,writable:false,enumerable:false});Object.defineProperty(K,"set",{value:function(L,M){K[L]=M},configurable:false,writable:false,enumerable:false});Object.defineProperty(K,"get",{value:function(L,M){return K[L]},configurable:false,writable:false,enumerable:false});return K})();s(this,document.querySelector("#"+J));var H=this.fire;this.fire=function(K,L){I[K]=L;H(K,L)};Object.defineProperty(this,"logger",{value:E.ofName("View#"+J),configurable:false,writable:false,enumerable:true});this.getLatestEventData=function(K){return I[K]};this.getId=function(){return J};this.getDomElement=function(){return document.querySelector("#"+J)};this.find=function(K){return this.getDomElement().querySelector(K)};this.findAll=function(K){return this.getDomElement().querySelectorAll(K)};this.getContext=function(){return G};this.clearContext=function(){G={}};this.getParameter=function(K){var L=u[this.getId()];if(arguments.length<1){return L}return null==L?null:L[K]};this.isReady=function(){return e.indexOf(this.getId())!=-1};this.isActive=function(){return this.getDomElement().classList.contains("active")};this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))};this.isDirectlyAccessible=function(){var K=document.documentElement.getAttribute("data-view-directly-accessible");K=null==K?"false":K;K=K.toLowerCase();var L=false;if("true"==K){if("false"==this.getDomElement().getAttribute("data-view-directly-accessible")){L=false}else{L=true}}else{if("true"==this.getDomElement().getAttribute("data-view-directly-accessible")){L=true}else{L=false}}return L};this.getFallbackView=function(){var K=this;var M=[this.getId()];do{var L=K.getDomElement().getAttribute("data-view-fallback");if(null==L||!v.isExisting(L)){m.warn("View: "+K.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view");return v.getDefaultView()}else{K=v.ofId(L);if(M.indexOf(K.getId())!=-1){m.error("Cyclical reference of view on fallback configuration on view: {}. Chain: {}, view id: {}",this.getId(),M,K.getId());return v.getDefaultView()}if(K.isDirectlyAccessible()){return K}M.push(L)}}while(true)};Object.freeze&&Object.freeze(this)};v.SWITCHTYPE_HISTORYFORWARD="history.forward";v.SWITCHTYPE_HISTORYBACK="history.back";v.SWITCHTYPE_VIEWSWITCH="view.switch";var n=[];var D=null;v.currentState=null;s(v);v.ofId=function(I){for(var H=0;H<n.length;H++){if(n[H].getId().trim()==I.trim()){return n[H]}}var G=new v(I);n.push(G);return G};v.isExisting=function(H){for(var G=0;G<n.length;G++){if(n[G].getId().trim()==H.trim()){return true}}return false};v.getActiveView=function(){for(var G=0;G<n.length;G++){if(n[G].isActive()){return n[G]}}return null};v.getDefaultView=function(){for(var G=0;G<n.length;G++){if(n[G].isDefault()){return n[G]}}return null};v.setSwitchAnimation=function(G){if(!(G instanceof Function)){throw new Error("Invalid argument. Animation of Function is needed.")}D=G;return v};v.getSwitchAnimation=function(){return D};var o=function(I){I=d(I,{srcView:null,targetView:null,type:v.SWITCHTYPE_VIEWSWITCH,withAnimation:true,params:f});var N=I.srcView,G=I.targetView,L=I.type;var O=L.toLowerCase()==v.SWITCHTYPE_HISTORYBACK,M=L.toLowerCase()==v.SWITCHTYPE_HISTORYFORWARD;if(!O&&!M){L=v.SWITCHTYPE_VIEWSWITCH}v.fire("beforechange",{currentView:N,targetView:G,type:L});N&&N.fire("leave",{targetView:G,type:L});var K=function(){N&&N.getDomElement().classList.remove("active");G.getDomElement().classList.add("active")
};var J=function(){var P=G.getId();k(P);if(O){if(b in u){h(P,u[b]);delete u[b]}}else{if(M){if(q in u){h(P,u[q]);delete u[q]}}else{if(f!=I.params){h(P,I.params)}}}var Q={sourceView:N,type:L};if(!G.isReady()){e.push(P);G.fire("ready",Q)}G.fire("beforeenter",Q);G.fire("enter",Q);G.fire("afterenter",Q)};if(!I.withAnimation){K();J()}else{var H=function(){K();J()};if(D){D.call(null,N?N.getDomElement():null,G.getDomElement(),L,H)}else{H()}}v.fire("afterchange",{currentView:N,targetView:G,type:L})};var C=function(G,I){I=d(I,{type:v.SWITCHTYPE_VIEWSWITCH,},true);if(!v.isExisting(G)){throw new Error("Target view: "+G+" does not exist!")}var J=v.getActiveView();if(J.getId().toLowerCase()==G.toLowerCase()){return}m.log("{} → {} {}",J.getId(),G,I.type);var H=v.ofId(G);I.srcView=J;I.targetView=H;o(I);return v};v.show=C;v.switchTo=function(G,I,H,J){if(arguments.length<4){J=null}if(arguments.length<3){H=true}if(arguments.length<2){I=v.SWITCHTYPE_VIEWSWITCH}I=I||v.SWITCHTYPE_VIEWSWITCH;C(G,{type:I,withAnimation:H,params:J});return v};v.switchView=v.switchTo;v.navTo=function(G,H){G=G.trim().toLowerCase();var I=new l(G,Date.now());if(b==G){v.back(H);return}if(q==G){v.forward(H);return}C(G,H);B(G);return v};v.updateView=v.navTo;v.back=function(G){k(b);if(null!=G&&"params" in G){console.log("!!!!",u);h(b,G.params)}history.go(-1)};v.forward=function(G){k(q);if(null!=G&&"params" in G){console.log("!!!!",u);h(q,G.params)}history.go(1)};v.changeTo=function(G,H){C(G,H);r(G);return v};v.Logger=E;var j;v.ready=(function(){var H=false;var G=[];j=function(){H=true;setTimeout(function(){G.forEach(function(I){I&&I()})},0)};return function(I){if(H){I&&I();return}if(G.indexOf(I)!=-1){return}G.push(I);return v}})();var z=function(G){var H=null;if(null==G||""==G){H=v.getActiveView()}else{if(!v.isExisting(G)){H=v.getActiveView()}else{if(v.ofId(G).isDirectlyAccessible()){H=v.ofId(G)}else{H=v.ofId(G).getFallbackView()}}}return H};var c=function(L){var K=v.getActiveView();m.log("{} Current: {}",A?"State poped!":"Hash changed!",K.getId());m.log("↑ {}",A?JSON.stringify(L.state):location.hash);var H,J=v.SWITCHTYPE_VIEWSWITCH,I=null;if(null==L.state){J=v.SWITCHTYPE_VIEWSWITCH;H=location.hash.replace(/^#/,"").toLowerCase();I=z(H);r(I.getId())}else{var G=L.state;H=G.viewId;if(v.isExisting(H)){I=v.ofId(H)}else{m.warn("Poped view: "+H+" does not exist, keeping current.");I=K}if(v.currentState!=null){J=G.timestamp<v.currentState.timestamp?v.SWITCHTYPE_HISTORYBACK:v.SWITCHTYPE_HISTORYFORWARD}r(I.getId(),G.timestamp)}v.show(I.getId(),{type:J})};var w=function(){window.addEventListener(A?"popstate":"hashchange",c);var I=document.querySelectorAll("*[data-view=true]");var J=null;var H=document.title;var G=function(){var L=-1;for(var K=0;K<I.length;K++){if("true"==I[K].getAttribute("data-view-default")){L=K;break}}if(-1!=L){J=I[L];for(var K=L+1;K<I.length;K++){if("true"==I[K].getAttribute("data-view-default")){I[K].removeAttribute("data-view-default")}}}else{if(0!=I.length){J=I[0];J.setAttribute("data-view-default","true")}}return J};[].forEach.call(I,function(K){v.ofId(K.id);K.classList.remove("active");G();if(null!=J){J.classList.add("active")}K.classList.add("view");(function(){var M=K.getAttribute("data-view-title");var L=v.ofId(K.id);L.on("enter",function(){document.title=null==M?H:M})})()});(function(){var N=v.getDefaultView().getId();var M=location.hash.replace(/^#/i,"").toLowerCase().trim();var K=""==M?v.getDefaultView().getId():M;var L=z(K);m.log("Initial target view: "+L.getId());var O=l.isConstructorOf(history.state);if(null!=history.state){m.log("Found existing state: {}, isViewState? {}",JSON.stringify(history.state),O);if(!(O&&history.state.viewId==L.getId())){r(L.getId())}}else{r(L.getId())}o({srcView:v.getActiveView(),targetView:L,withAnimation:false})})();(function(){i.addTapListener(document.documentElement,function(O){var N=O.changedTouches?O.changedTouches[0].target:O.target;var K;var M=N;while(null==M.getAttribute("data-view-rel")){M=M.parentNode;if(!(M instanceof HTMLElement)){M=null}if(null==M){break}}if(null!=M){K=M.getAttribute("data-view-rel")}if(null==K){return}var P="true"==M.getAttribute("data-view-rel-disabled");if(P){return}if(b==K.toLowerCase().trim()){history.go(-1);return}if(q==K.toLowerCase().trim()){history.go(1);return}var L=M.getAttribute("data-view-rel-type");L=null==L||""==L.trim()?"nav":L;if(!/^(?:nav)|(?:change)$/.test(L)){m.warn("Unknown view switch type: {}. {}",L,M);L="nav"}v[L+"To"](K,{type:v.SWITCHTYPE_VIEWSWITCH});O.preventDefault()},{useCapture:true})})();j()};document.addEventListener("DOMContentLoaded",w);t[F]=v})(window,"View");