window.View=(function(){var l=/mobile|tablet|ip(ad|hone|od)|android/i;var m=("ontouchstart" in window);var g=l.test(navigator.userAgent);var e=(function(){var v="  __com.soft.plugin.touch#"+new Date().getTime()+"__  ";var t=function(y,x){y=y||{};x=x||{};for(var z in x){if(!(z in y)){y[z]=x[z]}}return y};var w=function(y,x){y=y||{};y[x]=y[x]||{};return y[x]};var u=function(A,B,y){if(!g){A.addEventListener?A.addEventListener("click",B):A.attachEvent("onclick",B);return}var z=w(A,v+".tap");z.callbacks=z.callbacks||[];if(z.callbacks.indexOf(B)!=-1){return}z.callbacks.push(B);y=t(y,{timespan:500,delta:{},useCapture:false});y.delta=t(y.delta,{x:10,y:15});var x=w(A,v+".tap.meta");if(null==x.touchstart){x.touchstart=function(C){var D=C.changedTouches?C.changedTouches[0]:C;z.startX=D.screenX;z.startY=D.screenY;z.startTimestamp=Date.now()};A.addEventListener("touchstart",x.touchstart)}if(null==x.touchend){x.touchend=function(E){var G=E.changedTouches?E.changedTouches[0]:E;z.stopX=G.screenX;z.stopY=G.screenY;z.stopTimestamp=Date.now();var F=z.stopTimestamp-z.startTimestamp,D=Math.abs(z.stopX-z.startX),C=Math.abs(z.stopY-z.startY);if(F<=y.timespan&&D<=y.delta.x&&C<=y.delta.y){z.callbacks.forEach(function(H){H&&H.call(A,E)})}};A.addEventListener("touchend",x.touchend,y.useCapture)}};var s=function(B,C,x){if(!g){B.removeEventListener?B.removeEventListener("click",C):B.detachEvent("onclick",C);return}if(!B.hasOwnProperty(v)){return}var A=w(B,v+".tap");var z=A.callbacks.indexOf(C);if(z==-1){return}A.callbacks.splice(z,1);if(A.callbacks.length==0){var y=w(B,v+".tap.meta");B.removeEventListener("touchstart",y.touchstart);B.removeEventListener("touchend",y.touchend,x);delete B[v].tap}};return{addTapListener:u,removeTapListener:s}})();var n=("pushState" in history)&&(typeof history.pushState=="function");console.log("History pushState is "+(n?"":"not ")+"supported");var c=[];var b=function(t,s){t=t||{};s=s||{};for(var u in s){if(!(u in t)){t[u]=s[u]}}return t};var h=(function(){var s=function(t,u){this.type=t;this.timestamp=new Date().getTime();this.data=u;Object.freeze&&Object.freeze(this)};return function(u,t){(function(x,v){var w={};x.on=function(z,y){z=z.toLowerCase();w[z]=w[z]||[];if(w[z].indexOf(y)!=-1){return}w[z].push(y)};x.off=function(A,z){A=A.toLowerCase();w[A]=w[A]||[];var y=w[A].indexOf(z);if(y==-1){return}w[A].splice(y,1)};x.fire=function(y,A){y=y.toLowerCase();var z=new s(y,A);w[y]=w[y]||[];w[y].forEach(function(B){B.call(v,z)})}})(u,t)}})();var p=function(s,u){var t={viewId:s,timestamp:null==u?Date.now():u};console.log("↓",t);history.pushState(t,"","#"+s);j.currentState=t};var i=function(s,u){var t={viewId:s,timestamp:null==u?Date.now():u};console.log("%",t);history.replaceState(t,"","#"+s);j.currentState=t};var d=function(s){Error.call(this,s)};d.prototype=Object.create(Error.prototype);var r=function(s,t){this.type=s;this.timestamp=new Date().getTime();this.data=t;Object.freeze&&Object.freeze(this)};var j=function(t){if(null==document.querySelector("#"+t+"[data-view=true]")){throw new d("View of id: "+t+" does not exist(No element matching pattern: '#"+t+"[data-view=true]' found)!")}var s={};h(this,document.querySelector("#"+t));this.getId=function(){return t};this.getDomElement=function(){return document.querySelector("#"+t)};this.find=function(u){return this.getDomElement().querySelector(u)};this.findAll=function(u){return this.getDomElement().querySelectorAll(u)};this.getContext=function(){return s};this.clearContext=function(){s={}};this.isReady=function(){return c.indexOf(this.getId())!=-1};this.isActive=function(){return this.getDomElement().classList.contains("active")};this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))};this.isDirectlyAccessible=function(){var u=document.documentElement.getAttribute("data-view-directly-accessible");u=null==u?"false":u;u=u.toLowerCase();var v=false;if("true"==u){if("false"==this.getDomElement().getAttribute("data-view-directly-accessible")){v=false}else{v=true}}else{if("true"==this.getDomElement().getAttribute("data-view-directly-accessible")){v=true}else{v=false}}return v};this.getFallbackView=function(){var u=this;var w=[this.getId()];do{if(u.isDirectlyAccessible()){return u}var v=this.getDomElement().getAttribute("data-view-fallback");if(null==v||!j.isExisting(v)){console.warn("View: "+this.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view");return j.getDefaultView()}else{u=j.ofId(v);if(w.indexOf(u.getId())!=-1){console.error("cyclical reference of view on fallback configuration on view: "+this.getId());return j.getDefaultView()}w.push(v)}}while(true)};Object.freeze&&Object.freeze(this)};j.SWITCHTYPE_HISTORYFORWARD="history.forward";j.SWITCHTYPE_HISTORYBACK="history.back";j.SWITCHTYPE_VIEWSWITCH="view.switch";var f=[];var q=null;j.currentState=null;h(j);j.ofId=function(u){for(var t=0;t<f.length;t++){if(f[t].getId().toLowerCase().trim()==u.toLowerCase().trim()){return f[t]
}}var s=new j(u);f.push(s);return s};j.isExisting=function(t){for(var s=0;s<f.length;s++){if(f[s].getId().toLowerCase().trim()==t.toLowerCase().trim()){return true}}return false};j.getActiveView=function(){for(var s=0;s<f.length;s++){if(f[s].isActive()){return f[s]}}return null};j.getDefaultView=function(){for(var s=0;s<f.length;s++){if(f[s].isDefault()){return f[s]}}return null};j.setSwitchAnimation=function(s){if(!(s instanceof Function)){throw new Error("Invalid argument. Animation of Function is needed.")}q=s;return j};j.getSwitchAnimation=function(){return q};j.switchView=function(s,w,v){var y=j.getActiveView();if(arguments.length<3){v=true}if(arguments.length<2){w=j.SWITCHTYPE_VIEWSWITCH}w=w||j.SWITCHTYPE_VIEWSWITCH;if(""==s.trim()){if(null==j.getDefaultView()){return}else{s=j.getDefaultView().getId()}}if(!j.isExisting(s)){console.error("target view: "+s+" does not exist!");return}console.log(y.getId()+" → "+s,w);if(y.getId().toLowerCase()==s.toLowerCase()){return}var t=j.ofId(s);w=(w.toLowerCase()==j.SWITCHTYPE_HISTORYFORWARD?j.SWITCHTYPE_HISTORYFORWARD:(w.toLowerCase()==j.SWITCHTYPE_HISTORYBACK?j.SWITCHTYPE_HISTORYBACK:j.SWITCHTYPE_VIEWSWITCH));j.fire("beforechange",{currentView:y,targetView:t,type:w});var x=function(){y.getDomElement().classList.remove("active");t.getDomElement().classList.add("active")};y.fire("leave",w);if(!v){x();if(!t.isReady()){c.push(t.getId());t.fire("ready",w)}t.fire("beforeenter",w);t.fire("enter",w);t.fire("afterenter",w)}else{var u=function(){x();if(!t.isReady()){c.push(t.getId());t.fire("ready",w)}t.fire("beforeenter",w);t.fire("enter",w);t.fire("afterenter",w)};if(q){q.call(null,y.getDomElement(),t.getDomElement(),w,u)}else{u()}}j.fire("afterchange",{currentView:y,targetView:t,type:w});return j};j.show=j.switchView;j.updateView=function(s,t){var u={viewId:s,timestamp:Date.now()};if(":back"==s.toLowerCase().trim()){history.go(-1);return}if(":forward"==s.toLowerCase().trim()){history.go(1);return}if(!j.isExisting(s)){console.error("target view: "+s+" does not exist!");return}if(n){p(s)}else{location.hash=s}j.switchView(s,t);return j};j.switchTo=j.updateView;j.ready=(function(){var t=false;var s=[];document.addEventListener("DOMContentLoaded",function(){t=true;s.forEach(function(u){u&&u()})});return function(u){if(t){u&&u();return}if(s.indexOf(u)!=-1){return}s.push(u);return j}})();var o=function(s){var t=null;if(null==s||""==s){t=j.getDefaultView()}else{if(!j.isExisting(s)){t=j.getDefaultView()}else{if(j.ofId(s).isDirectlyAccessible()){t=j.ofId(s)}else{t=j.ofId(s).getFallbackView()}}}return t};var a=function(x){var w=j.getActiveView();console.log(n?"State poped!":"Hash changed!","Current: "+w.getId());n&&console.log("↑",JSON.stringify(x.state));var v,u=j.SWITCHTYPE_VIEWSWITCH,t=null;if(!n||null==x.state){v=location.hash.replace(/^#/,"").toLowerCase();t=o(v);u=j.SWITCHTYPE_VIEWSWITCH;location.hash=t.getId()}else{var s=x.state;v=s.viewId;if(null==v||!j.isExisting(v)){t=j.getDefaultView()}else{t=j.ofId(v)}if(j.currentState!=null){u=s.timestamp<j.currentState.timestamp?j.SWITCHTYPE_HISTORYBACK:j.SWITCHTYPE_HISTORYFORWARD}j.currentState=s;i(t.getId(),s.timestamp)}t&&j.switchView(t.getId(),u)};var k=function(){window.addEventListener(n?"popstate":"hashchange",a);[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(s){j.ofId(s.id)});[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(s){s.classList.add("view")});(function(){var u=null;var t=document.querySelectorAll("*[data-view-default=true][data-view=true]");if(0==t.length){u=document.querySelector("*[data-view=true]");if(null==u){console.warn("No view found!")}else{u.setAttribute("data-view-default","true")}}else{u=t[0];for(var s=1;s<t.length;s++){t[s].removeAttribute("data-view-default")}}})();(function(){e.addTapListener(document.documentElement,function(v){var u=v.changedTouches?v.changedTouches[0].target:v.target;var s;var t=u;while(null==t.getAttribute("data-view-rel")){t=t.parentNode;if(!(t instanceof HTMLElement)){t=null}if(null==t){break}}if(null!=t){s=t.getAttribute("data-view-rel")}if(null==s){return}var w=false;t=u;while(null==t.getAttribute("data-view-rel-disabled")){t=t.parentNode;if(!(t instanceof HTMLElement)){t=null}if(null==t){break}}if(null!=t){w="true"==t.getAttribute("data-view-rel-disabled")}if(w){return}v.preventDefault();if(":back"==s.toLowerCase().trim()){history.go(-1);return}if(":forward"==s.toLowerCase().trim()){history.go(1);return}j.updateView(s,j.SWITCHTYPE_VIEWSWITCH)},{useCapture:true})})();(function(){var s=location.hash.replace(/^#/i,"").toLowerCase();var t=o(s);if(null!=t){if(n){if(null==history.state){i(t.getId())}else{j.currentState=history.state}}else{location.hash=t.getId()}[].forEach.call(document.querySelectorAll("*[data-view=true].active"),function(u){u.classList.remove("active")});t.getDomElement().classList.add("active")}})()};document.addEventListener("DOMContentLoaded",function(){k();var s=j.getActiveView();if(s){c.push(s.getId());s.fire("ready",j.SWITCHTYPE_VIEWSWITCH);
s.fire("beforeenter",j.SWITCHTYPE_VIEWSWITCH);s.fire("enter",j.SWITCHTYPE_VIEWSWITCH);s.fire("afterenter",j.SWITCHTYPE_VIEWSWITCH)}(function(){var t=document.title;[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(u){var w=u.getAttribute("data-view-title");if(null==w){return}var v=j.ofId(u.id);v.on("enter",function(){document.title=w});v.on("leave",function(){document.title=t})})})()});return j})();