(function(l,A){var r=/mobile|tablet|ip(ad|hone|od)|android/i;var s=("ontouchstart" in window);var k=r.test(navigator.userAgent);var y=(function(){var F=function(){if(arguments.length==0){return}var J=arguments;var I=" "+String(arguments[0]);var K=1;I=I.replace(/([^\\])\{\}/g,function(N,L){var M=(J.length-1)<K?"{}":String(D(J[K]));K++;return L+M});I=I.replace(/\\\{\}/g,"{}");return I.substring(1)};var G=function(){var N=new Date();var I=N.getFullYear();var O="0"+String(N.getMonth()+1);O=O.substring(O.length-2);var K="0"+String(N.getDate());K=K.substring(K.length-2);var L="0"+String(N.getHours());L=L.substring(L.length-2);var J="0"+String(N.getMinutes());J=J.substring(J.length-2);var M="0"+String(N.getSeconds());M=M.substring(M.length-2);return O+K+" "+L+":"+J+":"+M};var D=function(I){if(null==I){return null}if((typeof I=="number")||(typeof I=="string")||(typeof I=="boolean")){return I}else{if(typeof I=="function"){return"function "+I.name+"(){...}"}else{if(!(I instanceof Array)&&(typeof I=="object")){if(String(I)!="[object Object]"){return String(I)}else{try{var L={};for(var J in I){L[J]=D(I[J])}return JSON.stringify(L)}catch(K){return String(I)}}}else{if(I instanceof Array){return JSON.stringify(I.map(function(M){return D(M)}))}else{return I}}}}};var C=function(I){return G()+" ["+I+"]: "};var H={};var B=function(I){this.getName=function(){return I};this.debug=function(){var J=F.apply(null,arguments);console.debug(C(I)+J)};this.info=function(){var J=F.apply(null,arguments);console.info(C(I)+J)};this.warn=function(){var J=F.apply(null,arguments);console.warn(C(I)+J)};this.error=function(){var J=F.apply(null,arguments);console.error(C(I)+J)};this.log=function(){var J=F.apply(null,arguments);console.log(C(I)+J)}};var E=function(I){if(I in H){return H[I]}var J=new B(I);H[I]=J;return J};B.ofName=E;return B})();var h=y.ofName("View");var e=(function(){var E="  __com.soft.plugin.touch#"+new Date().getTime()+"__  ";var C=function(H,G){H=H||{};G=G||{};for(var I in G){if(!(I in H)){H[I]=G[I]}}return H};var F=function(H,G){H=H||{};H[G]=H[G]||{};return H[G]};var D=function(J,K,H){if(!k){J.addEventListener?J.addEventListener("click",K):J.attachEvent("onclick",K);return}var I=F(J,E+".tap");I.callbacks=I.callbacks||[];if(I.callbacks.indexOf(K)!=-1){return}I.callbacks.push(K);H=C(H,{timespan:500,delta:{},useCapture:false});H.delta=C(H.delta,{x:10,y:15});var G=F(J,E+".tap.meta");if(null==G.touchstart){G.touchstart=function(L){var M=L.changedTouches?L.changedTouches[0]:L;I.startX=M.screenX;I.startY=M.screenY;I.startTimestamp=Date.now()};J.addEventListener("touchstart",G.touchstart)}if(null==G.touchend){G.touchend=function(N){var P=N.changedTouches?N.changedTouches[0]:N;I.stopX=P.screenX;I.stopY=P.screenY;I.stopTimestamp=Date.now();var O=I.stopTimestamp-I.startTimestamp,M=Math.abs(I.stopX-I.startX),L=Math.abs(I.stopY-I.startY);if(O<=H.timespan&&M<=H.delta.x&&L<=H.delta.y){I.callbacks.forEach(function(Q){Q&&Q.call(J,N)})}};J.addEventListener("touchend",G.touchend,H.useCapture)}};var B=function(K,L,G){if(!k){K.removeEventListener?K.removeEventListener("click",L):K.detachEvent("onclick",L);return}if(!K.hasOwnProperty(E)){return}var J=F(K,E+".tap");var I=J.callbacks.indexOf(L);if(I==-1){return}J.callbacks.splice(I,1);if(J.callbacks.length==0){var H=F(K,E+".tap.meta");K.removeEventListener("touchstart",H.touchstart);K.removeEventListener("touchend",H.touchend,G);delete K[E].tap}};return{addTapListener:D,removeTapListener:B}})();var u=("pushState" in history)&&(typeof history.pushState=="function");h.log("History pushState is "+(u?"":"not ")+"supported");var c=[];var o={};var b=function(C,B,E){if(arguments.length<3){E=false}C=C||{};B=B||{};for(var D in B){if(!(D in C)||(D in C&&null==C[D]&&E)){C[D]=B[D]}}return C};var m=(function(){var B=function(C,D){this.type=C;this.timestamp=new Date().getTime();this.data=D;Object.freeze&&Object.freeze(this)};return function(D,C){(function(G,E){var F={};G.on=function(I,H){I=I.toLowerCase();F[I]=F[I]||[];if(F[I].indexOf(H)!=-1){return}F[I].push(H)};G.off=function(J,I){J=J.toLowerCase();F[J]=F[J]||[];var H=F[J].indexOf(I);if(H==-1){return}F[J].splice(H,1)};G.fire=function(H,J){H=H.toLowerCase();var I=new B(H,J);F[H]=F[H]||[];setTimeout(function(){F[H].forEach(function(K){K.call(E,I)})},0)}})(D,C)}})();var g=function(B,C){if(arguments.length<2){C=Date.now()}Object.defineProperty(this,"viewId",{value:B,configurable:false,writable:false,enumerable:true});Object.defineProperty(this,"timestamp",{value:C,configurable:false,writable:false,enumerable:true});this.toString=function(){return JSON.stringify(this)};this.clone=function(){return JSON.parse(this.toString())}};g.isConstructorOf=function(B){if(null==B||typeof B!="object"){return false}return B.hasOwnProperty("viewId")&&B.hasOwnProperty("timestamp")};var v=function(B,D,E){if(arguments.length<2){D=Date.now()}if(arguments.length<3){E=true}var C=new g(B,D).clone();h.log("↓ {}",JSON.stringify(C));if(u){history.pushState(C,"","#"+B)}else{location.hash=B}p.currentState=C
};var n=function(B,D){if(arguments.length<2){D=Date.now()}if(arguments.length<3){updateLocation=true}var C=new g(B,D).clone();h.log("% {}",C.clon);if(u){history.replaceState(C,"","#"+B)}else{location.hash=B}p.currentState=C};var d=function(B){Error.call(this,B)};d.prototype=Object.create(Error.prototype);var z=function(B,C){this.type=B;this.timestamp=new Date().getTime();this.data=C;Object.freeze&&Object.freeze(this)};var p=function(E){if(null==document.querySelector("#"+E+"[data-view=true]")){throw new d("View of id: "+E+" does not exist(No element matching pattern: '#"+E+"[data-view=true]' found)!")}var D={};var B=(function(){var F={};Object.defineProperty(F,"has",{value:function(G){return G in F},configurable:false,writable:false,enumerable:false});Object.defineProperty(F,"set",{value:function(G,H){F[G]=H},configurable:false,writable:false,enumerable:false});Object.defineProperty(F,"get",{value:function(G,H){return F[G]},configurable:false,writable:false,enumerable:false});return F})();m(this,document.querySelector("#"+E));var C=this.fire;this.fire=function(F,G){D[F]=G;C(F,G)};Object.defineProperty(this,"logger",{value:y.ofName("View#"+E),configurable:false,writable:false,enumerable:true});this.getLatestEventData=function(F){return D[F]};this.getId=function(){return E};this.getDomElement=function(){return document.querySelector("#"+E)};this.find=function(F){return this.getDomElement().querySelector(F)};this.findAll=function(F){return this.getDomElement().querySelectorAll(F)};this.getContext=function(){return B};this.clearContext=function(){B={}};this.getParameter=function(F){var G=o[this.getId()];if(arguments.length<1){return G}return null==G?null:G[F]};this.isReady=function(){return c.indexOf(this.getId())!=-1};this.isActive=function(){return this.getDomElement().classList.contains("active")};this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))};this.isDirectlyAccessible=function(){var F=document.documentElement.getAttribute("data-view-directly-accessible");F=null==F?"false":F;F=F.toLowerCase();var G=false;if("true"==F){if("false"==this.getDomElement().getAttribute("data-view-directly-accessible")){G=false}else{G=true}}else{if("true"==this.getDomElement().getAttribute("data-view-directly-accessible")){G=true}else{G=false}}return G};this.getFallbackView=function(){var F=this;var H=[this.getId()];do{var G=F.getDomElement().getAttribute("data-view-fallback");if(null==G||!p.isExisting(G)){h.warn("View: "+F.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view");return p.getDefaultView()}else{F=p.ofId(G);if(H.indexOf(F.getId())!=-1){h.error("Cyclical reference of view on fallback configuration on view: {}. Chain: {}, view id: {}",this.getId(),H,F.getId());return p.getDefaultView()}if(F.isDirectlyAccessible()){return F}H.push(G)}}while(true)};Object.freeze&&Object.freeze(this)};p.SWITCHTYPE_HISTORYFORWARD="history.forward";p.SWITCHTYPE_HISTORYBACK="history.back";p.SWITCHTYPE_VIEWSWITCH="view.switch";var i=[];var x=null;p.currentState=null;m(p);p.ofId=function(D){for(var C=0;C<i.length;C++){if(i[C].getId().trim()==D.trim()){return i[C]}}var B=new p(D);i.push(B);return B};p.isExisting=function(C){for(var B=0;B<i.length;B++){if(i[B].getId().trim()==C.trim()){return true}}return false};p.getActiveView=function(){for(var B=0;B<i.length;B++){if(i[B].isActive()){return i[B]}}return null};p.getDefaultView=function(){for(var B=0;B<i.length;B++){if(i[B].isDefault()){return i[B]}}return null};p.setSwitchAnimation=function(B){if(!(B instanceof Function)){throw new Error("Invalid argument. Animation of Function is needed.")}x=B;return p};p.getSwitchAnimation=function(){return x};var j=function(D){D=b(D,{srcView:null,targetView:null,type:p.SWITCHTYPE_VIEWSWITCH,withAnimation:true,params:null});var J=D.srcView,B=D.targetView,I=D.type||p.SWITCHTYPE_VIEWSWITCH,F=D.withAnimation,E=D.params;p.fire("beforechange",{currentView:J,targetView:B,type:I});J&&J.fire("leave",I);var H=function(){J&&J.getDomElement().classList.remove("active");B.getDomElement().classList.add("active")};var G=function(){o[B.getId()]=null;o[B.getId()]=E;if(!B.isReady()){c.push(B.getId());B.fire("ready",I)}B.fire("beforeenter",I);B.fire("enter",I);B.fire("afterenter",I)};if(!F){H();G()}else{var C=function(){H();G()};if(x){x.call(null,J?J.getDomElement():null,B.getDomElement(),I,C)}else{C()}}p.fire("afterchange",{currentView:J,targetView:B,type:I})};var w=function(B,E){E=b(E,{type:p.SWITCHTYPE_VIEWSWITCH,withAnimation:true,params:null},true);if(!p.isExisting(B)){throw new Error("Target view: "+B+" does not exist!")}var F=p.getActiveView();var D=E.type;if(F.getId().toLowerCase()==B.toLowerCase()){return}h.log("{} → {} {}",F.getId(),B,D);var C=p.ofId(B);D=(D.toLowerCase()==p.SWITCHTYPE_HISTORYFORWARD?p.SWITCHTYPE_HISTORYFORWARD:(D.toLowerCase()==p.SWITCHTYPE_HISTORYBACK?p.SWITCHTYPE_HISTORYBACK:p.SWITCHTYPE_VIEWSWITCH));j({srcView:F,targetView:C,type:D,withAnimation:E.withAnimation,params:E.params});
return p};p.switchTo=function(B,D,C,E){if(arguments.length<4){E=null}if(arguments.length<3){C=true}if(arguments.length<2){D=p.SWITCHTYPE_VIEWSWITCH}D=D||p.SWITCHTYPE_VIEWSWITCH;w(B,{type:D,withAnimation:C,params:E});return p};p.switchView=p.switchTo;p.navTo=function(B,C,E){var D=new g(B,Date.now());if(":back"==B.toLowerCase().trim()){history.go(-1);return}if(":forward"==B.toLowerCase().trim()){history.go(1);return}w(B,{type:C,withAnimation:true,params:E});v(B);return p};p.updateView=p.navTo;p.back=function(){history.go(-1)};p.forward=function(){history.go(1)};p.changeTo=function(B,C,D){w(B,{type:C,withAnimation:true,params:D});n(B);return p};p.Logger=y;var f;p.ready=(function(){var C=false;var B=[];f=function(){C=true;setTimeout(function(){B.forEach(function(D){D&&D()})},0)};return function(D){if(C){D&&D();return}if(B.indexOf(D)!=-1){return}B.push(D);return p}})();var t=function(B){var C=null;if(null==B||""==B){C=p.getActiveView()}else{if(!p.isExisting(B)){C=p.getActiveView()}else{if(p.ofId(B).isDirectlyAccessible()){C=p.ofId(B)}else{C=p.ofId(B).getFallbackView()}}}return C};var a=function(G){var F=p.getActiveView();h.log("{} Current: {}",u?"State poped!":"Hash changed!",F.getId());h.log("↑ {}",u?JSON.stringify(G.state):location.hash);var C,E=p.SWITCHTYPE_VIEWSWITCH,D=null;if(null==G.state){E=p.SWITCHTYPE_VIEWSWITCH;C=location.hash.replace(/^#/,"").toLowerCase();D=t(C);n(D.getId())}else{var B=G.state;C=B.viewId;if(p.isExisting(C)){D=p.ofId(C)}else{h.warn("Poped view: "+C+" does not exist, keeping current.");D=F}if(p.currentState!=null){E=B.timestamp<p.currentState.timestamp?p.SWITCHTYPE_HISTORYBACK:p.SWITCHTYPE_HISTORYFORWARD}n(D.getId(),B.timestamp)}p.switchTo(D.getId(),E)};var q=function(){window.addEventListener(u?"popstate":"hashchange",a);var D=document.querySelectorAll("*[data-view=true]");var E=null;var C=document.title;var B=function(){var G=-1;for(var F=0;F<D.length;F++){if("true"==D[F].getAttribute("data-view-default")){G=F;break}}if(-1!=G){E=D[G];for(var F=G+1;F<D.length;F++){if("true"==D[F].getAttribute("data-view-default")){D[F].removeAttribute("data-view-default")}}}else{if(0!=D.length){E=D[0];E.setAttribute("data-view-default","true")}}return E};[].forEach.call(D,function(F){p.ofId(F.id);F.classList.remove("active");B();if(null!=E){E.classList.add("active")}F.classList.add("view");(function(){var H=F.getAttribute("data-view-title");var G=p.ofId(F.id);G.on("enter",function(){document.title=null==H?C:H})})()});(function(){var I=p.getDefaultView().getId();var H=location.hash.replace(/^#/i,"").toLowerCase().trim();var F=""==H?p.getDefaultView().getId():H;var G=t(F);h.log("Initial target view: "+G.getId());var J=g.isConstructorOf(history.state);if(null!=history.state){h.log("Found existing state: {}, isViewState? {}",JSON.stringify(history.state),J);if(!(J&&history.state.viewId==G.getId())){n(G.getId())}}else{n(G.getId())}j({srcView:p.getActiveView(),targetView:G,withAnimation:false})})();(function(){e.addTapListener(document.documentElement,function(J){var I=J.changedTouches?J.changedTouches[0].target:J.target;var F;var H=I;while(null==H.getAttribute("data-view-rel")){H=H.parentNode;if(!(H instanceof HTMLElement)){H=null}if(null==H){break}}if(null!=H){F=H.getAttribute("data-view-rel")}if(null==F){return}var K="true"==H.getAttribute("data-view-rel-disabled");if(K){return}if(":back"==F.toLowerCase().trim()){history.go(-1);return}if(":forward"==F.toLowerCase().trim()){history.go(1);return}var G=H.getAttribute("data-view-rel-type");G=null==G||""==G.trim()?"nav":G;if(!/^(?:nav)|(?:change)$/.test(G)){h.warn("Unknown view switch type: {}. {}",G,H);G="nav"}p[G+"To"](F,p.SWITCHTYPE_VIEWSWITCH);J.preventDefault()},{useCapture:true})})();f()};document.addEventListener("DOMContentLoaded",q);l[A]=p})(window,"View");