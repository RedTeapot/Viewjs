window.View=(function(){var n=/mobile|tablet|ip(ad|hone|od)|android/i;var o=("ontouchstart" in window);var i=n.test(navigator.userAgent);var e=(function(){var y="  __com.soft.plugin.touch#"+new Date().getTime()+"__  ";var w=function(B,A){B=B||{};A=A||{};for(var C in A){if(!(C in B)){B[C]=A[C]}}return B};var z=function(B,A){B=B||{};B[A]=B[A]||{};return B[A]};var x=function(D,E,B){if(!i){D.addEventListener?D.addEventListener("click",E):D.attachEvent("onclick",E);return}var C=z(D,y+".tap");C.callbacks=C.callbacks||[];if(C.callbacks.indexOf(E)!=-1){return}C.callbacks.push(E);B=w(B,{timespan:500,delta:{},useCapture:false});B.delta=w(B.delta,{x:10,y:15});var A=z(D,y+".tap.meta");if(null==A.touchstart){A.touchstart=function(F){var G=F.changedTouches?F.changedTouches[0]:F;C.startX=G.screenX;C.startY=G.screenY;C.startTimestamp=Date.now()};D.addEventListener("touchstart",A.touchstart)}if(null==A.touchend){A.touchend=function(H){var J=H.changedTouches?H.changedTouches[0]:H;C.stopX=J.screenX;C.stopY=J.screenY;C.stopTimestamp=Date.now();var I=C.stopTimestamp-C.startTimestamp,G=Math.abs(C.stopX-C.startX),F=Math.abs(C.stopY-C.startY);if(I<=B.timespan&&G<=B.delta.x&&F<=B.delta.y){C.callbacks.forEach(function(K){K&&K.call(D,H)})}};D.addEventListener("touchend",A.touchend,B.useCapture)}};var v=function(E,F,A){if(!i){E.removeEventListener?E.removeEventListener("click",F):E.detachEvent("onclick",F);return}if(!E.hasOwnProperty(y)){return}var D=z(E,y+".tap");var C=D.callbacks.indexOf(F);if(C==-1){return}D.callbacks.splice(C,1);if(D.callbacks.length==0){var B=z(E,y+".tap.meta");E.removeEventListener("touchstart",B.touchstart);E.removeEventListener("touchend",B.touchend,A);delete E[y].tap}};return{addTapListener:x,removeTapListener:v}})();var q=("pushState" in history)&&(typeof history.pushState=="function");console.log("History pushState is "+(q?"":"not ")+"supported");var c=[];var b=function(w,v){w=w||{};v=v||{};for(var x in v){if(!(x in w)){w[x]=v[x]}}return w};var j=(function(){var v=function(w,x){this.type=w;this.timestamp=new Date().getTime();this.data=x;Object.freeze&&Object.freeze(this)};return function(x,w){(function(A,y){var z={};A.on=function(C,B){C=C.toLowerCase();z[C]=z[C]||[];if(z[C].indexOf(B)!=-1){return}z[C].push(B)};A.off=function(D,C){D=D.toLowerCase();z[D]=z[D]||[];var B=z[D].indexOf(C);if(B==-1){return}z[D].splice(B,1)};A.fire=function(B,D){B=B.toLowerCase();var C=new v(B,D);z[B]=z[B]||[];z[B].forEach(function(E){E.call(y,C)})}})(x,w)}})();var g=function(v,w){if(arguments.length<2){w=Date.now()}Object.defineProperty(this,"viewId",{value:v,configurable:false,writable:false,enumerable:true});Object.defineProperty(this,"timestamp",{value:w,configurable:false,writable:false,enumerable:true})};g.isConstructorOf=function(v){if(null==v||typeof v!="object"){return false}return v.hasOwnProperty("viewId")&&v.hasOwnProperty("timestamp")};var s=function(v,x,y){if(arguments.length<2){x=Date.now()}if(arguments.length<3){y=true}var w=new g(v,x);console.log("↓",w);if(q){history.pushState(w,"","#"+v)}else{location.hash=v}l.currentState=w};var k=function(v,x){if(arguments.length<2){x=Date.now()}if(arguments.length<3){updateLocation=true}var w=new g(v,x);console.log("%",w);if(q){history.replaceState(w,"","#"+v)}else{location.hash=v}l.currentState=w};var d=function(v){Error.call(this,v)};d.prototype=Object.create(Error.prototype);var u=function(v,w){this.type=v;this.timestamp=new Date().getTime();this.data=w;Object.freeze&&Object.freeze(this)};var l=function(w){if(null==document.querySelector("#"+w+"[data-view=true]")){throw new d("View of id: "+w+" does not exist(No element matching pattern: '#"+w+"[data-view=true]' found)!")}var v=(function(){var x={};Object.defineProperty(x,"has",{value:function(y){return y in x},configurable:false,writable:false,enumerable:false});Object.defineProperty(x,"set",{value:function(y,z){x[y]=z},configurable:false,writable:false,enumerable:false});Object.defineProperty(x,"get",{value:function(y,z){return x[y]},configurable:false,writable:false,enumerable:false});return x})();j(this,document.querySelector("#"+w));this.getId=function(){return w};this.getDomElement=function(){return document.querySelector("#"+w)};this.find=function(x){return this.getDomElement().querySelector(x)};this.findAll=function(x){return this.getDomElement().querySelectorAll(x)};this.getContext=function(){return v};this.clearContext=function(){v={}};this.isReady=function(){return c.indexOf(this.getId())!=-1};this.isActive=function(){return this.getDomElement().classList.contains("active")};this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))};this.isDirectlyAccessible=function(){var x=document.documentElement.getAttribute("data-view-directly-accessible");x=null==x?"false":x;x=x.toLowerCase();var y=false;if("true"==x){if("false"==this.getDomElement().getAttribute("data-view-directly-accessible")){y=false}else{y=true}}else{if("true"==this.getDomElement().getAttribute("data-view-directly-accessible")){y=true
}else{y=false}}return y};this.getFallbackView=function(){var x=this;var z=[this.getId()];do{var y=x.getDomElement().getAttribute("data-view-fallback");if(null==y||!l.isExisting(y)){console.warn("View: "+x.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view");return l.getDefaultView()}else{x=l.ofId(y);if(z.indexOf(x.getId())!=-1){console.error("Cyclical reference of view on fallback configuration on view: "+this.getId(),z,x.getId());return l.getDefaultView()}if(x.isDirectlyAccessible()){return x}z.push(y)}}while(true)};Object.freeze&&Object.freeze(this)};l.SWITCHTYPE_HISTORYFORWARD="history.forward";l.SWITCHTYPE_HISTORYBACK="history.back";l.SWITCHTYPE_VIEWSWITCH="view.switch";var h=[];var t=null;l.currentState=null;j(l);l.ofId=function(x){for(var w=0;w<h.length;w++){if(h[w].getId().trim()==x.trim()){return h[w]}}var v=new l(x);h.push(v);return v};l.isExisting=function(w){for(var v=0;v<h.length;v++){if(h[v].getId().trim()==w.trim()){return true}}return false};l.getActiveView=function(){for(var v=0;v<h.length;v++){if(h[v].isActive()){return h[v]}}return null};l.getDefaultView=function(){for(var v=0;v<h.length;v++){if(h[v].isDefault()){return h[v]}}return null};l.setSwitchAnimation=function(v){if(!(v instanceof Function)){throw new Error("Invalid argument. Animation of Function is needed.")}t=v;return l};l.getSwitchAnimation=function(){return t};var r=function(w,v,z,y){if(arguments.length<3){y=true}if(arguments.length<2){z=l.SWITCHTYPE_VIEWSWITCH}z=z||l.SWITCHTYPE_VIEWSWITCH;l.fire("beforechange",{currentView:w,targetView:v,type:z});var A=function(){w&&w.getDomElement().classList.remove("active");v.getDomElement().classList.add("active")};w&&w.fire("leave",z);if(!y){A();if(!v.isReady()){c.push(v.getId());v.fire("ready",z)}v.fire("beforeenter",z);v.fire("enter",z);v.fire("afterenter",z)}else{var x=function(){A();if(!v.isReady()){c.push(v.getId());v.fire("ready",z)}v.fire("beforeenter",z);v.fire("enter",z);v.fire("afterenter",z)};if(t){t.call(null,w?w.getDomElement():null,v.getDomElement(),z,x)}else{x()}}l.fire("afterchange",{currentView:w,targetView:v,type:z})};l.switchTo=function(v,y,x){if(arguments.length<3){x=true}if(arguments.length<2){y=l.SWITCHTYPE_VIEWSWITCH}y=y||l.SWITCHTYPE_VIEWSWITCH;var z=l.getActiveView();if(!l.isExisting(v)){throw new Error("target view: "+v+" does not exist!")}if(z.getId().toLowerCase()==v.toLowerCase()){return}console.log(z.getId()+" → "+v,y);var w=l.ofId(v);y=(y.toLowerCase()==l.SWITCHTYPE_HISTORYFORWARD?l.SWITCHTYPE_HISTORYFORWARD:(y.toLowerCase()==l.SWITCHTYPE_HISTORYBACK?l.SWITCHTYPE_HISTORYBACK:l.SWITCHTYPE_VIEWSWITCH));r(z,w,y,x);return l};l.switchView=l.switchTo;l.navTo=function(v,w){var x=new g(v,Date.now());if(":back"==v.toLowerCase().trim()){history.go(-1);return}if(":forward"==v.toLowerCase().trim()){history.go(1);return}if(!l.isExisting(v)){throw new Error("target view: "+v+" does not exist!")}l.switchTo(v,w);s(v);return l};l.updateView=l.navTo;l.changeTo=function(v,w){l.switchTo(v,w);k(v);return l};var f;l.ready=(function(){var w=false;var v=[];f=function(){w=true;setTimeout(function(){v.forEach(function(x){x&&x()})},0)};return function(x){if(w){x&&x();return}if(v.indexOf(x)!=-1){return}v.push(x);return l}})();var p=function(v){var w=null;if(null==v||""==v){w=l.getActiveView()}else{if(!l.isExisting(v)){w=l.getActiveView()}else{if(l.ofId(v).isDirectlyAccessible()){w=l.ofId(v)}else{w=l.ofId(v).getFallbackView()}}}return w};var a=function(A){var z=l.getActiveView();console.log(q?"State poped!":"Hash changed!","Current: "+z.getId());console.log("↑",q?JSON.stringify(A.state):location.hash);var w,y=l.SWITCHTYPE_VIEWSWITCH,x=null;if(null==A.state){y=l.SWITCHTYPE_VIEWSWITCH;w=location.hash.replace(/^#/,"").toLowerCase();x=p(w);k(x.getId())}else{var v=A.state;w=v.viewId;if(l.isExisting(w)){x=l.ofId(w)}else{console.warn("Poped view: "+w+" does not exist, keeping current.");x=z}if(l.currentState!=null){y=v.timestamp<l.currentState.timestamp?l.SWITCHTYPE_HISTORYBACK:l.SWITCHTYPE_HISTORYFORWARD}k(x.getId(),v.timestamp)}l.switchTo(x.getId(),y)};var m=function(){window.addEventListener(q?"popstate":"hashchange",a);[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(v){l.ofId(v.id)});[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(v){v.classList.add("view")});(function(){var x=null;var w=document.querySelectorAll("*[data-view-default=true][data-view=true]");if(0==w.length){x=document.querySelector("*[data-view=true]");if(null==x){console.warn("No view found!")}else{x.setAttribute("data-view-default","true")}}else{x=w[0];for(var v=1;v<w.length;v++){w[v].removeAttribute("data-view-default")}}})();(function(){var x=document.querySelectorAll("*[data-view=true].active");for(var w=0;w<x.length;w++){var v=x[w];v.classList.remove("active")}l.getDefaultView().getDomElement().classList.add("active")})();(function(){var y=l.getDefaultView().getId();var x=location.hash.replace(/^#/i,"").toLowerCase().trim();
var v=""==x?l.getDefaultView().getId():x;var w=p(v);console.log("Initial target view: "+w.getId());var z=g.isConstructorOf(history.state);if(null!=history.state){console.log("Found existing state: ",history.state," isViewState? "+z);if(!(z&&history.state.viewId==w.getId())){k(w.getId())}}else{k(w.getId())}r(l.getActiveView(),w,null,false)})();(function(){var v=document.title;[].forEach.call(document.querySelectorAll("*[data-view=true]"),function(w){var y=w.getAttribute("data-view-title");var x=l.ofId(w.id);x.on("enter",function(){document.title=null==y?v:y})})})();(function(){e.addTapListener(document.documentElement,function(z){var y=z.changedTouches?z.changedTouches[0].target:z.target;var v;var x=y;while(null==x.getAttribute("data-view-rel")){x=x.parentNode;if(!(x instanceof HTMLElement)){x=null}if(null==x){break}}if(null!=x){v=x.getAttribute("data-view-rel")}if(null==v){return}var A="true"==x.getAttribute("data-view-rel-disabled");if(A){return}if(":back"==v.toLowerCase().trim()){history.go(-1);return}if(":forward"==v.toLowerCase().trim()){history.go(1);return}var w=x.getAttribute("data-view-rel-type");w=null==w||""==w.trim()?"nav":w;if(!/^(?:nav)|(?:change)$/.test(w)){console.warn("Unknown view switch type: "+w,x);w="nav"}l[w+"To"](v,l.SWITCHTYPE_VIEWSWITCH);z.preventDefault()},{useCapture:true})})();f()};document.addEventListener("DOMContentLoaded",m);return l})();