(function(k,y){var p=/mobile|tablet|ip(ad|hone|od)|android/i;var q=("ontouchstart" in window);var j=p.test(navigator.userAgent);var w=(function(){var D=function(){if(arguments.length==0){return}var H=arguments;var G=" "+String(arguments[0]);var I=1;G=G.replace(/([^\\])\{\}/g,function(L,J){var K=(H.length-1)<I?"{}":String(B(H[I]));I++;return J+K});G=G.replace(/\\\{\}/g,"{}");return G.substring(1)};var E=function(){var L=new Date();var G=L.getFullYear();var M="0"+String(L.getMonth()+1);M=M.substring(M.length-2);var I="0"+String(L.getDate());I=I.substring(I.length-2);var J="0"+String(L.getHours());J=J.substring(J.length-2);var H="0"+String(L.getMinutes());H=H.substring(H.length-2);var K="0"+String(L.getSeconds());K=K.substring(K.length-2);return M+I+" "+J+":"+H+":"+K};var B=function(G){if(null==G){return null}if((typeof G=="number")||(typeof G=="string")||(typeof G=="boolean")){return G}else{if(typeof G=="function"){return"function "+G.name+"(){...}"}else{if(!(G instanceof Array)&&(typeof G=="object")){if(String(G)!="[object Object]"){return String(G)}else{try{var J={};for(var H in G){J[H]=B(G[H])}return JSON.stringify(J)}catch(I){return String(G)}}}else{if(G instanceof Array){return JSON.stringify(G.map(function(K){return B(K)}))}else{return G}}}}};var A=function(G){return E()+" ["+G+"]: "};var F={};var z=function(G){this.getName=function(){return G};this.debug=function(){var H=D.apply(null,arguments);console.debug(A(G)+H)};this.info=function(){var H=D.apply(null,arguments);console.info(A(G)+H)};this.warn=function(){var H=D.apply(null,arguments);console.warn(A(G)+H)};this.error=function(){var H=D.apply(null,arguments);console.error(A(G)+H)};this.log=function(){var H=D.apply(null,arguments);console.log(A(G)+H)}};var C=function(G){if(G in F){return F[G]}var H=new z(G);F[G]=H;return H};z.ofName=C;return z})();var h=w.ofName("View");var e=(function(){var C="  __com.soft.plugin.touch#"+new Date().getTime()+"__  ";var A=function(F,E){F=F||{};E=E||{};for(var G in E){if(!(G in F)){F[G]=E[G]}}return F};var D=function(F,E){F=F||{};F[E]=F[E]||{};return F[E]};var B=function(H,I,F){if(!j){H.addEventListener?H.addEventListener("click",I):H.attachEvent("onclick",I);return}var G=D(H,C+".tap");G.callbacks=G.callbacks||[];if(G.callbacks.indexOf(I)!=-1){return}G.callbacks.push(I);F=A(F,{timespan:500,delta:{},useCapture:false});F.delta=A(F.delta,{x:10,y:15});var E=D(H,C+".tap.meta");if(null==E.touchstart){E.touchstart=function(J){var K=J.changedTouches?J.changedTouches[0]:J;G.startX=K.screenX;G.startY=K.screenY;G.startTimestamp=Date.now()};H.addEventListener("touchstart",E.touchstart)}if(null==E.touchend){E.touchend=function(L){var N=L.changedTouches?L.changedTouches[0]:L;G.stopX=N.screenX;G.stopY=N.screenY;G.stopTimestamp=Date.now();var M=G.stopTimestamp-G.startTimestamp,K=Math.abs(G.stopX-G.startX),J=Math.abs(G.stopY-G.startY);if(M<=F.timespan&&K<=F.delta.x&&J<=F.delta.y){G.callbacks.forEach(function(O){O&&O.call(H,L)})}};H.addEventListener("touchend",E.touchend,F.useCapture)}};var z=function(I,J,E){if(!j){I.removeEventListener?I.removeEventListener("click",J):I.detachEvent("onclick",J);return}if(!I.hasOwnProperty(C)){return}var H=D(I,C+".tap");var G=H.callbacks.indexOf(J);if(G==-1){return}H.callbacks.splice(G,1);if(H.callbacks.length==0){var F=D(I,C+".tap.meta");I.removeEventListener("touchstart",F.touchstart);I.removeEventListener("touchend",F.touchend,E);delete I[C].tap}};return{addTapListener:B,removeTapListener:z}})();var s=("pushState" in history)&&(typeof history.pushState=="function");h.log("History pushState is "+(s?"":"not ")+"supported");var c=[];var b=function(A,z){A=A||{};z=z||{};for(var B in z){if(!(B in A)){A[B]=z[B]}}return A};var l=(function(){var z=function(A,B){this.type=A;this.timestamp=new Date().getTime();this.data=B;Object.freeze&&Object.freeze(this)};return function(B,A){(function(E,C){var D={};E.on=function(G,F){G=G.toLowerCase();D[G]=D[G]||[];if(D[G].indexOf(F)!=-1){return}D[G].push(F)};E.off=function(H,G){H=H.toLowerCase();D[H]=D[H]||[];var F=D[H].indexOf(G);if(F==-1){return}D[H].splice(F,1)};E.fire=function(F,H){F=F.toLowerCase();var G=new z(F,H);D[F]=D[F]||[];setTimeout(function(){D[F].forEach(function(I){I.call(C,G)})},0)}})(B,A)}})();var g=function(z,A){if(arguments.length<2){A=Date.now()}Object.defineProperty(this,"viewId",{value:z,configurable:false,writable:false,enumerable:true});Object.defineProperty(this,"timestamp",{value:A,configurable:false,writable:false,enumerable:true});this.toString=function(){return JSON.stringify(this)};this.clone=function(){return JSON.parse(this.toString())}};g.isConstructorOf=function(z){if(null==z||typeof z!="object"){return false}return z.hasOwnProperty("viewId")&&z.hasOwnProperty("timestamp")};var u=function(z,B,C){if(arguments.length<2){B=Date.now()}if(arguments.length<3){C=true}var A=new g(z,B).clone();h.log("↓ {}",JSON.stringify(A));if(s){history.pushState(A,"","#"+z)}else{location.hash=z}n.currentState=A};var m=function(z,B){if(arguments.length<2){B=Date.now()
}if(arguments.length<3){updateLocation=true}var A=new g(z,B).clone();h.log("% {}",A.clon);if(s){history.replaceState(A,"","#"+z)}else{location.hash=z}n.currentState=A};var d=function(z){Error.call(this,z)};d.prototype=Object.create(Error.prototype);var x=function(z,A){this.type=z;this.timestamp=new Date().getTime();this.data=A;Object.freeze&&Object.freeze(this)};var n=function(C){if(null==document.querySelector("#"+C+"[data-view=true]")){throw new d("View of id: "+C+" does not exist(No element matching pattern: '#"+C+"[data-view=true]' found)!")}var B={};var z=(function(){var D={};Object.defineProperty(D,"has",{value:function(E){return E in D},configurable:false,writable:false,enumerable:false});Object.defineProperty(D,"set",{value:function(E,F){D[E]=F},configurable:false,writable:false,enumerable:false});Object.defineProperty(D,"get",{value:function(E,F){return D[E]},configurable:false,writable:false,enumerable:false});return D})();l(this,document.querySelector("#"+C));var A=this.fire;this.fire=function(D,E){B[D]=E;A(D,E)};Object.defineProperty(this,"logger",{value:w.ofName("View#"+C),configurable:false,writable:false,enumerable:true});this.getLatestEventData=function(D){return B[D]};this.getId=function(){return C};this.getDomElement=function(){return document.querySelector("#"+C)};this.find=function(D){return this.getDomElement().querySelector(D)};this.findAll=function(D){return this.getDomElement().querySelectorAll(D)};this.getContext=function(){return z};this.clearContext=function(){z={}};this.isReady=function(){return c.indexOf(this.getId())!=-1};this.isActive=function(){return this.getDomElement().classList.contains("active")};this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))};this.isDirectlyAccessible=function(){var D=document.documentElement.getAttribute("data-view-directly-accessible");D=null==D?"false":D;D=D.toLowerCase();var E=false;if("true"==D){if("false"==this.getDomElement().getAttribute("data-view-directly-accessible")){E=false}else{E=true}}else{if("true"==this.getDomElement().getAttribute("data-view-directly-accessible")){E=true}else{E=false}}return E};this.getFallbackView=function(){var D=this;var F=[this.getId()];do{var E=D.getDomElement().getAttribute("data-view-fallback");if(null==E||!n.isExisting(E)){h.warn("View: "+D.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view");return n.getDefaultView()}else{D=n.ofId(E);if(F.indexOf(D.getId())!=-1){h.error("Cyclical reference of view on fallback configuration on view: {}. Chain: {}, view id: {}",this.getId(),F,D.getId());return n.getDefaultView()}if(D.isDirectlyAccessible()){return D}F.push(E)}}while(true)};Object.freeze&&Object.freeze(this)};n.SWITCHTYPE_HISTORYFORWARD="history.forward";n.SWITCHTYPE_HISTORYBACK="history.back";n.SWITCHTYPE_VIEWSWITCH="view.switch";var i=[];var v=null;n.currentState=null;l(n);n.ofId=function(B){for(var A=0;A<i.length;A++){if(i[A].getId().trim()==B.trim()){return i[A]}}var z=new n(B);i.push(z);return z};n.isExisting=function(A){for(var z=0;z<i.length;z++){if(i[z].getId().trim()==A.trim()){return true}}return false};n.getActiveView=function(){for(var z=0;z<i.length;z++){if(i[z].isActive()){return i[z]}}return null};n.getDefaultView=function(){for(var z=0;z<i.length;z++){if(i[z].isDefault()){return i[z]}}return null};n.setSwitchAnimation=function(z){if(!(z instanceof Function)){throw new Error("Invalid argument. Animation of Function is needed.")}v=z;return n};n.getSwitchAnimation=function(){return v};var t=function(A,z,D,C){if(arguments.length<3){C=true}if(arguments.length<2){D=n.SWITCHTYPE_VIEWSWITCH}D=D||n.SWITCHTYPE_VIEWSWITCH;n.fire("beforechange",{currentView:A,targetView:z,type:D});var E=function(){A&&A.getDomElement().classList.remove("active");z.getDomElement().classList.add("active")};A&&A.fire("leave",D);if(!C){E();if(!z.isReady()){c.push(z.getId());z.fire("ready",D)}z.fire("beforeenter",D);z.fire("enter",D);z.fire("afterenter",D)}else{var B=function(){E();if(!z.isReady()){c.push(z.getId());z.fire("ready",D)}z.fire("beforeenter",D);z.fire("enter",D);z.fire("afterenter",D)};if(v){v.call(null,A?A.getDomElement():null,z.getDomElement(),D,B)}else{B()}}n.fire("afterchange",{currentView:A,targetView:z,type:D})};n.switchTo=function(z,C,B){if(arguments.length<3){B=true}if(arguments.length<2){C=n.SWITCHTYPE_VIEWSWITCH}C=C||n.SWITCHTYPE_VIEWSWITCH;var D=n.getActiveView();if(!n.isExisting(z)){throw new Error("target view: "+z+" does not exist!")}if(D.getId().toLowerCase()==z.toLowerCase()){return}h.log("{} → {} {}",D.getId(),z,C);var A=n.ofId(z);C=(C.toLowerCase()==n.SWITCHTYPE_HISTORYFORWARD?n.SWITCHTYPE_HISTORYFORWARD:(C.toLowerCase()==n.SWITCHTYPE_HISTORYBACK?n.SWITCHTYPE_HISTORYBACK:n.SWITCHTYPE_VIEWSWITCH));t(D,A,C,B);return n};n.switchView=n.switchTo;n.navTo=function(z,A){var B=new g(z,Date.now());if(":back"==z.toLowerCase().trim()){history.go(-1);return}if(":forward"==z.toLowerCase().trim()){history.go(1);
return}if(!n.isExisting(z)){throw new Error("target view: "+z+" does not exist!")}n.switchTo(z,A);u(z);return n};n.updateView=n.navTo;n.changeTo=function(z,A){n.switchTo(z,A);m(z);return n};n.Logger=w;var f;n.ready=(function(){var A=false;var z=[];f=function(){A=true;setTimeout(function(){z.forEach(function(B){B&&B()})},0)};return function(B){if(A){B&&B();return}if(z.indexOf(B)!=-1){return}z.push(B);return n}})();var r=function(z){var A=null;if(null==z||""==z){A=n.getActiveView()}else{if(!n.isExisting(z)){A=n.getActiveView()}else{if(n.ofId(z).isDirectlyAccessible()){A=n.ofId(z)}else{A=n.ofId(z).getFallbackView()}}}return A};var a=function(E){var D=n.getActiveView();h.log("{} Current: {}",s?"State poped!":"Hash changed!",D.getId());h.log("↑ {}",s?JSON.stringify(E.state):location.hash);var A,C=n.SWITCHTYPE_VIEWSWITCH,B=null;if(null==E.state){C=n.SWITCHTYPE_VIEWSWITCH;A=location.hash.replace(/^#/,"").toLowerCase();B=r(A);m(B.getId())}else{var z=E.state;A=z.viewId;if(n.isExisting(A)){B=n.ofId(A)}else{h.warn("Poped view: "+A+" does not exist, keeping current.");B=D}if(n.currentState!=null){C=z.timestamp<n.currentState.timestamp?n.SWITCHTYPE_HISTORYBACK:n.SWITCHTYPE_HISTORYFORWARD}m(B.getId(),z.timestamp)}n.switchTo(B.getId(),C)};var o=function(){window.addEventListener(s?"popstate":"hashchange",a);var B=document.querySelectorAll("*[data-view=true]");var C=null;var A=document.title;var z=function(){var E=-1;for(var D=0;D<B.length;D++){if("true"==B[D].getAttribute("data-view-default")){E=D;break}}if(-1!=E){C=B[E];for(var D=E+1;D<B.length;D++){if("true"==B[D].getAttribute("data-view-default")){B[D].removeAttribute("data-view-default")}}}else{if(0!=B.length){C=B[0];C.setAttribute("data-view-default","true")}}return C};[].forEach.call(B,function(D){n.ofId(D.id);D.classList.remove("active");z();if(null!=C){C.classList.add("active")}D.classList.add("view");(function(){var F=D.getAttribute("data-view-title");var E=n.ofId(D.id);E.on("enter",function(){document.title=null==F?A:F})})()});(function(){var G=n.getDefaultView().getId();var F=location.hash.replace(/^#/i,"").toLowerCase().trim();var D=""==F?n.getDefaultView().getId():F;var E=r(D);h.log("Initial target view: "+E.getId());var H=g.isConstructorOf(history.state);if(null!=history.state){h.log("Found existing state: {}, isViewState? {}",JSON.stringify(history.state),H);if(!(H&&history.state.viewId==E.getId())){m(E.getId())}}else{m(E.getId())}t(n.getActiveView(),E,null,false)})();(function(){e.addTapListener(document.documentElement,function(H){var G=H.changedTouches?H.changedTouches[0].target:H.target;var D;var F=G;while(null==F.getAttribute("data-view-rel")){F=F.parentNode;if(!(F instanceof HTMLElement)){F=null}if(null==F){break}}if(null!=F){D=F.getAttribute("data-view-rel")}if(null==D){return}var I="true"==F.getAttribute("data-view-rel-disabled");if(I){return}if(":back"==D.toLowerCase().trim()){history.go(-1);return}if(":forward"==D.toLowerCase().trim()){history.go(1);return}var E=F.getAttribute("data-view-rel-type");E=null==E||""==E.trim()?"nav":E;if(!/^(?:nav)|(?:change)$/.test(E)){h.warn("Unknown view switch type: {}. {}",E,F);E="nav"}n[E+"To"](D,n.SWITCHTYPE_VIEWSWITCH);H.preventDefault()},{useCapture:true})})();f()};document.addEventListener("DOMContentLoaded",o);k[y]=n})(window,"View");