!function(ctx,name){var env=function(){var e=navigator.userAgent,t=/(?:MQQBrowser|QQ)/.test(e),i=/(?:UCWEB|UCBrowser)/.test(e),n=/(?:Safari)/.test(e),r=/(?:Opera Mini)/.test(e),o=/(?:Mac OS)/.test(e),a=/(?:Android)/.test(e),s=/(?:Windows Phone)/.test(e),u=o&&/(?:iPad)/.test(e),l=o&&/(?:iPhone)/.test(e),c=/(?:Tablet|PlayBook)/.test(e)||u,f=/(?:Mobile)/.test(e)&&!u||s;return{isQB:t,isUC:i,isSafari:n,isOpera:r,isIOS:o,isAndroid:a,isWindowsPhone:s,isIPad:u,isIPhone:l,isTablet:c,isMobile:f,isPc:!f&&!c}}(),setDftValue=function(e,t,i){arguments.length<3&&(i=!1),e=e||{},t=t||{};for(var n in t)n in e&&!(n in e&&null==e[n]&&i)||(e[n]=t[n]);return e},defineReadOnlyProperty=function(e,t,i){Object.defineProperty(e,t,{value:i,configurable:!1,writable:!1,enumerable:!0})},try2exec=function(e,t,i){if(null!=e&&"function"==typeof e)try{e.apply(t,i)}catch(t){var n=t instanceof Error||null!=t&&"object"==typeof t&&"stack"in t,r="Error occured while executing function: {}. {}"+(n?" stack:\n{}":"");globalLogger.error(r,e.name,t,n?t.stack:null)}},try2Call=function(func,ctx,args){if(null!=func&&"function"==typeof func)try{for(var tmp="",index=2,i=2;i<arguments.length;i++)tmp+=",arguments["+i+"]";eval("func.call(ctx"+tmp+")")}catch(e){console.error("Error occured while executing function: "+func.name,e)}},isEmptyString=function(e,t){return arguments.length<2&&(t=!1),null===e||void 0===e||(e=String(e),t&&(e=e.trim()),0==e.length)},isNullOrUndefined=function(e){return null===e||void 0===e},ifStringEquals=function(e,t,i,n){return arguments.length<4&&(n=!0),arguments.length<3&&(i=!0),isNullOrUndefined(e)?!!isNullOrUndefined(t):!isNullOrUndefined(t)&&(n&&(e=String(e).trim(),t=String(t).trim()),i||(e=e.toLowerCase(),t=t.toLowerCase()),e===t)},ifStringEqualsIgnoreCase=function(e,t,i){return arguments.length<3&&(i=!0),ifStringEquals(e,t,!1,i)},eventDrive=function(){var e=function(e,t){this.type=e,this.timestamp=(new Date).getTime(),this.data=t,Object.freeze&&Object.freeze(this)};return function(t,i){var n={},r=function(e){n[e]=n[e]||[]};t.on=function(e,t){e=e.toLowerCase(),r(e),n[e].indexOf(t)==-1&&n[e].push(t)},t.off=function(e,t){e=e.toLowerCase(),r(e);var i=n[e].indexOf(t);i!=-1&&n[e].splice(i,1)},t.fire=function(t,o,a){arguments.length<3&&(a=!0),t=t.toLowerCase();var s=new e(t,o),u=function(){r(t),n[t].forEach(function(e){"function"==typeof e&&e.call(i,s)})};a?setTimeout(u,0):u()}}}(),Logger=function(){var e,t,i=function(){if(0!=arguments.length){var e=arguments,t=" "+String(arguments[0]),i=1;return t=t.replace(/([^\\])\{\}/g,function(t,n){var o=e.length-1<i?"{}":String(r(e[i]));return i++,n+o}),t=t.replace(/\\\{\}/g,"{}"),t.substring(1)}},n=function(){var e=new Date,t=(e.getFullYear(),"0"+String(e.getMonth()+1));t=t.substring(t.length-2);var i="0"+String(e.getDate());i=i.substring(i.length-2);var n="0"+String(e.getHours());n=n.substring(n.length-2);var r="0"+String(e.getMinutes());r=r.substring(r.length-2);var o="0"+String(e.getSeconds());return o=o.substring(o.length-2),t+i+" "+n+":"+r+":"+o},r=function(e){if(null==e)return null;if("number"==typeof e||"string"==typeof e||"boolean"==typeof e)return e;if("function"==typeof e)return"function "+e.name+"(){...}";if(e instanceof Array||"object"!=typeof e)return e instanceof Array?JSON.stringify(e.map(function(e){return r(e)})):e;if("[object Object]"!=String(e))return String(e);try{var t={};for(var i in e)t[i]=r(e[i]);return JSON.stringify(t)}catch(t){return String(e)}},o=function(e){return n()+" ["+e+"]: "},a={};!function(){var i=!0;e=function(){return i},t=function(e){i=e}}();var s=function(t){var n=!0;this.isEnabled=function(){return e()&&n},this.setIsEnabled=function(e){return n=e,this},this.getName=function(){return t},this.debug=function(){if(this.isEnabled()){var e=i.apply(null,arguments);console.debug(o(t)+e)}},this.info=function(){if(this.isEnabled()){var e=i.apply(null,arguments);console.info(o(t)+e)}},this.warn=function(){if(this.isEnabled()){var e=i.apply(null,arguments);console.warn(o(t)+e)}},this.error=function(){if(this.isEnabled()){var e=i.apply(null,arguments);console.error(o(t)+e)}},this.log=function(){if(this.isEnabled()){var e=i.apply(null,arguments);console.log(o(t)+e)}}},u=function(e){if(e in a)return a[e];var t=new s(e);return a[e]=t,t};return s.ofName=u,s.isGloballyEnabled=e,s.setIsGloballyEnabled=t,s}(),touch=function(){var e=/mobile|tablet|ip(ad|hone|od)|android/i,t=(window,e.test(navigator.userAgent)),i="  __com.soft.plugin.touch#"+(new Date).getTime()+"__  ",n=function(e,t){return e=e||{},e[t]=e[t]||{},e[t]};return{addTapListener:function(e,r,o){if(!t)return void(e.addEventListener?e.addEventListener("click",r):e.attachEvent("onclick",r));var a=n(e,i+".tap");if(a.callbacks=a.callbacks||[],a.callbacks.indexOf(r)==-1){a.callbacks.push(r),o=setDftValue(o,{timespan:500,delta:{},useCapture:!1}),o.delta=setDftValue(o.delta,{x:10,y:15});var s=n(e,i+".tap.meta");null==s.touchstart&&(s.touchstart=function(e){var t=e.changedTouches?e.changedTouches[0]:e;a.startX=t.screenX,a.startY=t.screenY,a.startTimestamp=Date.now()},e.addEventListener("touchstart",s.touchstart)),null==s.touchend&&(s.touchend=function(t){var i=t.changedTouches?t.changedTouches[0]:t;a.stopX=i.screenX,a.stopY=i.screenY,a.stopTimestamp=Date.now();var n=a.stopTimestamp-a.startTimestamp,r=Math.abs(a.stopX-a.startX),s=Math.abs(a.stopY-a.startY);n<=o.timespan&&r<=o.delta.x&&s<=o.delta.y&&a.callbacks.forEach(function(i){i&&i.call(e,t)})},e.addEventListener("touchend",s.touchend,o.useCapture))}},removeTapListener:function(e,r,o){if(!t)return void(e.removeEventListener?e.removeEventListener("click",r):e.detachEvent("onclick",r));if(e.hasOwnProperty(i)){var a=n(e,i+".tap"),s=a.callbacks.indexOf(r);if(s!=-1&&(a.callbacks.splice(s,1),0==a.callbacks.length)){var u=n(e,i+".tap.meta");e.removeEventListener("touchstart",u.touchstart),e.removeEventListener("touchend",u.touchend,o),delete e[i].tap}}}}}(),resolution=function(){var e=[],t=function(){return window.innerWidth<=window.innerHeight},i=function(){return window.innerWidth>window.innerHeight},n=t(),r=function(i){n==t()?setTimeout(r,20):(setTimeout(function(){globalLogger.debug("Orientation changes. Is portrait: {}",t()),e.forEach(function(e){e&&e(i)})},0),n=t())};window.addEventListener("onorientationchange"in window?"orientationchange":"resize",r);var o=function(t){e.indexOf(t)==-1&&e.push(t)},a={isPortrait:t,isLandscape:i,addChangeListener:o};return Object.freeze&&Object.freeze(a),a}(),layout=function(){var e=document.documentElement.clientWidth,t=document.documentElement.clientHeight,i=320/568,n=!0,r=[],o=function(){},a={},s=function(){return e},u=function(){return t},l=function(){return document.documentElement.clientWidth},c=function(){return document.documentElement.clientHeight},f=function(){return e<=t},w=function(){return!isPortrait()},d=function(){return l()<=c()},g=function(){return!d()},h=function(){return e/t},v=function(){return l()/c()},p=function(){return i},V=function(e){return i=e,a},m=function(e,t){document.body.style="width: "+e+"px; height: "+t+"px; margin: 0 auto;"},y=m,b=m,I=y,E=m,S=y,P=function(){var e=l(),t=c();return g()?y(e,t):m(e,t),{width:e,height:t}},L=P,A=function(){var e,t;return g()?(t=c(),e=t*i,S(e,t)):(e=l(),t=c(),E(e,t)),{width:e,height:t}},O=function(e){if(r.indexOf(e)==-1)return r.push(e),a},T=function(e){var t=r.indexOf(e);if(t!=-1)return r.splice(t,1),a},C=function(){var i;i=env.isPc?A():env.isTablet?L():P();var n=Math.abs(e-i.width)>=.1||Math.abs(t-i.height)>=.1;e=i.width,t=i.height;var o=l(),s=c();return n&&setTimeout(function(){globalLogger.debug("Layout changes. Layout: {} * {}, browser: {} * {}",e,t,o,s),r.forEach(function(i){"function"==typeof i&&try2Call(i,null,e,t,o,s)})},0),a};return setDftValue(a,{getLayoutWidth:s,getLayoutHeight:u,getBrowserWidth:l,getBrowserHeight:c,isLayoutPortrait:f,isLayoutLandscape:w,isBrowserPortrait:d,isBrowserLandscape:g,getLayoutWidthHeightRatio:h,getBrowserWidthHeightRatio:v,getExpectedWidthHeightRatio:p,setExpectedWidthHeightRatio:V,init:function(e){return e=setDftValue(e,{autoReLayoutWhenResize:!0,layoutAsMobilePortrait:m,layoutAsMobileLandscape:y,layoutAsTabletLandscape:I,layoutAsTabletPortrait:b,layoutAsPcPortrait:E,layoutAsPcLandscape:S}),n=!!e.autoReLayoutWhenResize,n&&resolution.addChangeListener(C),m=e.layoutAsMobilePortrait||o,y=e.layoutAsMobileLandscape||o,b=e.layoutAsTabletPortrait||o,I=e.layoutAsTabletLandscape||o,E=e.layoutAsPcPortrait||o,S=e.layoutAsPcLandscape||o,a},doLayout:C,addLayoutChangeListener:O,removeLayoutChangeListener:T}),Object.freeze&&Object.freeze(a),a}(),globalLogger=Logger.ofName("View"),docEle=document.documentElement,NOT_SUPPLIED=new Object,PSVIEW_BACK=":back",PSVIEW_FORWARD=":forward",viewInstances=[],readyViews=[],viewParameters={},viewSwitchAnimation=null,attr$view="data-view",attr$view_default="data-view-default",attr$view_directly_accessible="data-view-directly-accessible",attr$view_fallback="data-view-fallback",attr$view_rel="data-view-rel",attr$view_rel_disabled="data-view-rel-disabled",attr$view_rel_type="data-view-rel-type",attr$view_title="data-view-title",attr$view_os="data-view-os",historyPushPopSupported="pushState"in history&&"function"==typeof history.pushState;globalLogger.log("History pushState is "+(historyPushPopSupported?"":"not ")+"supported");var isPseudoView=function(e){return":back"==e||":forward"==e},setViewParameter=function(e,t,i){if(!View.ifExists(e)&&!isPseudoView(e))throw new Error("View of id: "+e+" does not exist.");if(arguments.length<3)throw new Error("Invalid argument length. Both parameter name and value should be specified.");return viewParameters[e]=viewParameters[e]||{},viewParameters[e][String(t)]=i,View},setViewParameters=function(e,t){if(!View.ifExists(e)&&!isPseudoView(e))throw new Error("View of id: "+e+" does not exist.");if(void 0===t&&(t=null),"object"!=typeof t)throw new Error("Parameters specified should be an object or null.");return viewParameters[e]=t,View},clearViewParameters=function(e){return delete viewParameters[e],View},getViewObjs=function(){return document.querySelectorAll("*[data-view=true]")},getViewObjOfId=function(e){return document.querySelector("#"+e+"[data-view=true]")},ViewState=function(){var e=function(e,t,i){arguments.length<3&&(i=null),arguments.length<2&&(t=Date.now()),defineReadOnlyProperty(this,"viewId",e),defineReadOnlyProperty(this,"timestamp",t),defineReadOnlyProperty(this,"options",i),this.toString=function(){return JSON.stringify(this)},this.clone=function(){return JSON.parse(this.toString())}};return e.isConstructorOf=function(e){return null!=e&&"object"==typeof e&&(e.hasOwnProperty("viewId")&&e.hasOwnProperty("timestamp"))},e}(),xEncodeURIComponent=function(e){return encodeURIComponent(String(e)).replace(/\+/gm,"%2B")},concatViewOptions=function(e,t){var i=String(e),n=null==t?[]:Object.keys(t),r=n.reduce(function(e,i,n,r){return e+"&"+xEncodeURIComponent(i)+"="+xEncodeURIComponent(t[i])},"");return r.length>0&&(i+="!"+r.substring(1)),i},pushViewState=function(e,t,i){arguments.length<3&&(i=null),arguments.length<2&&(t=Date.now());var n=new ViewState(e,t,i).clone();globalLogger.log("↓ {}",JSON.stringify(n)),historyPushPopSupported?history.pushState(n,"","#"+concatViewOptions(e,i)):location.hash=concatViewOptions(e,i),View.currentState=n},replaceViewState=function(e,t,i){arguments.length<3&&(i=null),arguments.length<2&&(t=Date.now());var n=new ViewState(e,t,i).clone();globalLogger.log("% {}",JSON.stringify(n)),historyPushPopSupported?history.replaceState(n,"","#"+concatViewOptions(e,i)):location.hash=concatViewOptions(e,i),View.currentState=n},ViewConfiguration=function(e,t){var i,n=e,r=NOT_SUPPLIED;this.getName=function(){return n},this.getValue=function(e){if(NOT_SUPPLIED==r){if(arguments.length<1)return;return e}return r},this.setValue=function(e,t){return arguments.length<2&&(t=!1),(t||NOT_SUPPLIED==r)&&(r=e),this},this.getApplication=function(){return i},this.setApplication=function(e){return"function"!=typeof e?void globalLogger.warn("Configuration application should be of type: 'Function'"):(i=e,this)},this.apply=function(){if("function"==typeof i)try{i.call(this,r)}catch(i){globalLogger.error("Fail to apply configuration: {} = {} for view of id: {}\n{}",e,String(r),t,i),i instanceof Error?console.error(i,i.stack):console.error(i)}return this},this.reflectToDom=function(){return null==t||""==t.trim()?this:View.ifExists(t)?(View.ofId(t).getDomElement().setAttribute("data-viewconfig_"+this.getName(),String(this.getValue())),this):(globalLogger.warn("No view of id '{}' found to reflect view config: {}={}.",t,this.getName(),this.getValue()),this)},Object.freeze(this)},ViewConfigurationSet=function(e){var t={};this.has=function(e){return e in t},this.get=function(i){var n;return i in t?n=t[i]:(n=new ViewConfiguration(i,e),t[i]=n),n},this.applyAll=function(){var e=Object.keys(t).map(function(e){return t[e]});0!=e.length&&setTimeout(function(){e.forEach(function(e){try{e.apply()}catch(e){e instanceof Error?console.error(e,e.stack):console.error(e)}})},0)},this.listAll=function(){return Object.keys(t)}},ViewContext=function(){var e={};defineReadOnlyProperty(this,"has",function(t){return t in e}),defineReadOnlyProperty(this,"set",function(t,i){return e[t]=i,this}),defineReadOnlyProperty(this,"get",function(t){return e[t]}),defineReadOnlyProperty(this,"remove",function(t){var i=e[t];return delete e[t],i}),defineReadOnlyProperty(this,"clear",function(){return e={},this})},ViewLayout=function(){var e={},t=function(){return layout.isLayoutPortrait()},i=t,n=function(e){var t=NOT_SUPPLIED,n=!0,r=NOT_SUPPLIED;defineReadOnlyProperty(this,"setLayoutAction",function(i){return"function"!=typeof i?(globalLogger.error("Layout action for view of id: {} should be of type: Function.",e),this):(t=i,this)}),defineReadOnlyProperty(this,"doLayout",function(){if("function"!=typeof t)return globalLogger.warn("No layout function for view of id {} supplied.",e),this;var n=i()?"portrait":"landscape";return r==n?(globalLogger.debug("Skip doing layout for view of id: {} for orientation remains the same.",e),this):(docEle.offsetWidth=docEle.offsetHeight,t(),r=n,this)}),defineReadOnlyProperty(this,"setIfLayoutWhenLayoutChanges",function(e){return n=e,this});var o=this;layout.addLayoutChangeListener(function(){return n?View.ofId(e).isActive()?(globalLogger.debug("Layout changes, doing layout for view of id: {}",e),void o.doLayout()):void globalLogger.debug("Layout changes, but view of id: {} will not respond to this for view is not active.",e):void globalLogger.debug("Layout changes, but view of id: {} will not respond to this for flag: 'layoutWhenLayoutChanges' is {}.",e,n)})};return n.ofId=function(t){if(t in e)return e[t];var i=new n(t);return e[t]=i,i},n.implIsPortrait=function(e){return"function"!=typeof e?(globalLogger.error("Implementation of 'isPortrait' should be of type: Function."),n):(i=e,n)},n}(),View=function(e){if(null===document.querySelector("#"+e+"[data-view=true]"))throw new Error("View of id: "+e+" does not exist(No element matching pattern: '#"+e+"[data-view=true]' found)!");var t={},i=new ViewContext,n=new ViewConfigurationSet(e);eventDrive(this,document.querySelector("#"+e));var r=this.fire;this.fire=function(e,i,n){t[e]=i,r(e,i,n)},defineReadOnlyProperty(this,"logger",Logger.ofName("View#"+e)),defineReadOnlyProperty(this,"config",n),defineReadOnlyProperty(this,"context",i),this.getLatestEventData=function(e){return t[e]},this.getContext=function(){return i},this.clearContext=function(){return i.clear(),this},this.getId=function(){return e},this.getDomElement=function(){return document.querySelector("#"+e)},this.find=function(e){return this.getDomElement().querySelector(e)},this.findAll=function(e){return this.getDomElement().querySelectorAll(e)},this.setLayoutAction=function(t,i){arguments.length<2&&(i=!0),ViewLayout.ofId(e).setIfLayoutWhenLayoutChanges(!!i).setLayoutAction(t)},this.hasParameter=function(e){if(null===e||void 0===e)return!1;var t=viewParameters[this.getId()];return null!=t&&e in t},this.getParameter=function(e){var t=viewParameters[this.getId()];return arguments.length<1?t:null==t?null:t[e]},this.seekParameter=function(e){if(this.hasParameter(e))return this.getParameter(e);if(View.hasActiveViewOption(e))return View.getActiveViewOption(e);var t=new RegExp("\\b"+e+"\\b=([^&\\?]*)"),i=location.search.match(t);return null==i?null:i=decodeURIComponent(i[1])},this.isReady=function(){return readyViews.indexOf(this.getId())!=-1},this.isActive=function(){return this.getDomElement().classList.contains("active")},this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))},this.isDirectlyAccessible=function(){var e=this.getDomElement().getAttribute("data-view-directly-accessible");return e=null==e?null:e.toLowerCase(),View.isDirectlyAccessible()?"false"!=e:"true"==e},this.setAsDirectlyAccessible=function(){this.getDomElement().setAttribute("data-view-directly-accessible","true")},this.setTitle=function(e){return null==e?(this.getDomElement().removeAttribute("data-view-title"),this):(this.getDomElement().setAttribute("data-view-title",String(e)),this)},this.getTitle=function(e){return this.getDomElement().getAttribute("data-view-title")},this.setFallbackViewId=function(e){return null==e||""==e.trim()?this:View.ifExists(e)?this.getId()==e?this:void this.getDomElement().setAttribute("data-view-fallback",e):(globalLogger.warn("No view of id: {} found.",e),this)},this.getFallbackView=function(){for(var e=this,t=[this.getId()];;){var i=e.getDomElement().getAttribute("data-view-fallback");if(null==i||!View.ifExists(i))return globalLogger.warn("View: "+e.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view"),View.getDefaultView();if(e=View.ofId(i),t.indexOf(e.getId())!=-1)return globalLogger.error("Cyclical reference of view on fallback configuration on view: {}. Chain: {}, view id: {}",this.getId(),t,e.getId()),View.getDefaultView();if(e.isDirectlyAccessible())return e;t.push(i)}},Object.freeze&&Object.freeze(this)};defineReadOnlyProperty(View,"SWITCHTYPE_HISTORYFORWARD","history.forward"),defineReadOnlyProperty(View,"SWITCHTYPE_HISTORYBACK","history.back"),defineReadOnlyProperty(View,"SWITCHTYPE_VIEWNAV","view.nav"),defineReadOnlyProperty(View,"SWITCHTYPE_VIEWCHANGE","view.change");var normalizeSwitchType=function(e){null!=e&&""!=String(e).trim()||(e=View.SWITCHTYPE_VIEWNAV);var t=ifStringEqualsIgnoreCase(e,View.SWITCHTYPE_VIEWNAV),i=ifStringEqualsIgnoreCase(e,View.SWITCHTYPE_VIEWCHANGE),n=ifStringEqualsIgnoreCase(e,View.SWITCHTYPE_HISTORYBACK),r=ifStringEqualsIgnoreCase(e,View.SWITCHTYPE_HISTORYFORWARD);return n||r||t||i||(e=View.SWITCHTYPE_VIEWNAV),e};View.currentState=null,View.Logger=Logger,View.layout=layout,eventDrive(View),View.ofId=function(e){for(var t=0; t<viewInstances.length; t++)if(viewInstances[t].getId().trim()==e.trim())return viewInstances[t];var i=new View(e);return viewInstances.push(i),i},View.ifExists=function(e){for(var t=0;t<viewInstances.length;t++)if(viewInstances[t].getId().trim()==e.trim())return!0;return!1},View.isExisting=View.ifExists,View.listAll=function(){return[].concat(viewInstances)},View.setAsDefault=function(e){for(var t=getViewObjs(),i=0;i<t.length;i++)t[i].removeAttribute("data-view-default");var n=getViewObjOfId(e);return null==n?(globalLogger.error("No view dom element of id: {} found to set as default.",e),View):(n.setAttribute("data-view-default","true"),View)},View.isDirectlyAccessible=function(){return ifStringEqualsIgnoreCase("true",docEle.getAttribute("data-view-directly-accessible"))},View.setIsDirectlyAccessible=function(e){return docEle.setAttribute("data-view-directly-accessible",String(!!e).toLowerCase()),View},View.getActiveView=function(){for(var e=0;e<viewInstances.length;e++)if(viewInstances[e].isActive())return viewInstances[e];return null},View.getDefaultView=function(){for(var e=0;e<viewInstances.length;e++)if(viewInstances[e].isDefault())return viewInstances[e];return null},View.setSwitchAnimation=function(e){if(!(e instanceof Function))throw new Error("Invalid argument. Animation of Function is needed.");return viewSwitchAnimation=e,View},View.getSwitchAnimation=function(){return viewSwitchAnimation};var parseViewInfoFromHash=function(e){if(""==e)return null;var t=e.match(/^#([\w\$\-]+)(?:!+(.*))?/);if(null==t)return null;var i=(t[1],null);if(null!=t[2]&&""!=t[2].trim()){var n=t[2].split(/\s*&\s*/);0!=n.length&&(i={},n.forEach(function(e){var t=e.split(/\s*=\s*/);i[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}))}return{viewId:t[1],options:i}};View.getActiveViewOptions=function(){var e=parseViewInfoFromHash(location.hash);return null==e?null:e.options},View.hasActiveViewOption=function(e){var t=View.getActiveViewOptions();return null!=t&&e in t},View.getActiveViewOption=function(e){var t=View.getActiveViewOptions();return null==t?null:t[e]},View.implIsPortrait=function(){return ViewLayout.implIsPortrait.apply(ViewLayout,arguments),View};var switchView=function(e){e=setDftValue(e,{srcView:null,targetView:null,type:View.SWITCHTYPE_VIEWNAV,withAnimation:!0,params:null});var t=e.srcView,i=e.targetView,n=normalizeSwitchType(e.type),r=e.params,o=ifStringEqualsIgnoreCase(n,View.SWITCHTYPE_HISTORYBACK),a=ifStringEqualsIgnoreCase(n,View.SWITCHTYPE_HISTORYFORWARD),s=function(){var e=i.getId();clearViewParameters(e),o?":back"in viewParameters&&(setViewParameters(e,viewParameters[":back"]),delete viewParameters[":back"]):a?":forward"in viewParameters&&(setViewParameters(e,viewParameters[":forward"]),delete viewParameters[":forward"]):setViewParameters(e,r);var s={sourceView:t,type:n,params:r},u=function(e,t){try{i.fire(e,s,t)}catch(t){globalLogger.error("Error occured while firing event: {} with data: {}",e,s),t instanceof Error?console.error(t,t.stack):console.error(t)}};t&&t.getDomElement().classList.remove("active"),t&&t.fire("leave",{targetView:i,type:n}),u("beforeenter",!1),i.getDomElement().classList.add("active"),ViewLayout.ofId(e).doLayout(),i.isReady()||(readyViews.push(e),u("ready",!1)),u("enter",!1),u("afterenter",!1)};View.fire("beforechange",{currentView:t,targetView:i,type:n,params:r}),e.withAnimation&&viewSwitchAnimation?viewSwitchAnimation.call(null,t?t.getDomElement():null,i.getDomElement(),n,s):s(),View.fire("afterchange",{currentView:t,targetView:i,type:n,params:r})},show=function(e,t){if(t=setDftValue(t,{},!0),!View.ifExists(e))throw new Error("Target view: "+e+" does not exist!");var i=View.getActiveView();if(i&&ifStringEqualsIgnoreCase(i.getId(),e))return View;globalLogger.log("{} → {} {}",i?i.getId():null,e,JSON.stringify(t));var n=View.ofId(e);return t.srcView=i,t.targetView=n,switchView(t),View};View.show=show,View.switchTo=function(e,t,i,n){return arguments.length<4&&(n=null),arguments.length<3&&(i=!0),t=normalizeSwitchType(t),show(e,{type:t,withAnimation:i,params:n}),View},View.switchView=View.switchTo,View.navTo=function(e,t){e=e.trim(),t=setDftValue(t,{});var i=View.getActiveView();return i&&ifStringEqualsIgnoreCase(i.getId(),e)?View:":back"==e?(View.back(t),View):":forward"==e?(View.forward(t),View):(t.type=View.SWITCHTYPE_VIEWNAV,show(e,t),pushViewState(e,Date.now(),null==t?null:t.options),View)},View.updateView=View.navTo,View.changeTo=function(e,t){t=setDftValue(t,{});var i=View.getActiveView();return i&&ifStringEqualsIgnoreCase(i.getId(),e)?View:(t.type=View.SWITCHTYPE_VIEWCHANGE,show(e,t),replaceViewState(e,Date.now(),null==t?null:t.options),View)},View.back=function(e){clearViewParameters(":back"),null!=e&&"params"in e&&setViewParameters(":back",e.params),history.go(-1)},View.forward=function(e){clearViewParameters(":forward"),null!=e&&"params"in e&&setViewParameters(":forward",e.params),history.go(1)};var documentTitle=document.title,setDocumentTitle=function(e){return isEmptyString(e,!0)?(globalLogger.warn("Invalid document title: "+e),View):(document.title=documentTitle=e,View)};View.setDocumentTitle=setDocumentTitle;var isViewInited=!1,isViewReady=!1,markViewReady,markViewToBeInited,markViewInited,viewInitializer,viewInitializerExecTime,getActiveOrDefaultView=function(){var e=View.getActiveView();return null==e&&(e=View.getDefaultView()),e},getFinalView=function(e){var t=null;return isEmptyString(e,!0)||!View.ifExists(e)?t=getActiveOrDefaultView():(t=View.ofId(e),t.isDirectlyAccessible()||(t=t.getFallbackView())),t},stateChangeListener=function(e){var t=View.getActiveView(),i=null==t?null:t.getId();globalLogger.log("{} Current: {}",historyPushPopSupported?"State poped!":"Hash changed!",t.getId()),globalLogger.log("↑ {}",historyPushPopSupported?JSON.stringify(e.state):location.hash);var n,r,o=View.SWITCHTYPE_VIEWNAV,a=null;if(null==e.state){o=View.SWITCHTYPE_VIEWNAV;var s,u=parseViewInfoFromHash(location.hash);null==u?(a=t,s=i):(n=u.viewId,a=getFinalView(n),s=a.getId());var l=s==n;r=s==i?View.currentState.options:l?u.options:null,replaceViewState(s,Date.now(),r)}else{var c=e.state;n=c.viewId,View.ifExists(n)?(a=View.ofId(n),r=c.options):(globalLogger.warn("Poped view: "+n+" does not exist, keeping current."),a=t,r=null);var s=a.getId();null!=View.currentState&&(o=c.timestamp<View.currentState.timestamp?View.SWITCHTYPE_HISTORYBACK:View.SWITCHTYPE_HISTORYFORWARD),replaceViewState(s,c.timestamp,r)}View.show(a.getId(),{type:o,options:r})},init=function(){markViewToBeInited(),docEle.setAttribute("data-view-os",env.isIOS?"ios":env.isAndroid?"android":env.isWindowsPhone?"wp":"unknown"),window.addEventListener(historyPushPopSupported?"popstate":"hashchange",stateChangeListener);var e=getViewObjs();[].forEach.call(e,function(e){View.ofId(e.id),e.classList.remove("active"),e.classList.add("view"),function(){View.ofId(e.id).on("enter",function(){var t=e.getAttribute("data-view-title");document.title=null==t?documentTitle:t})}()});var t=null;t=function(){for(var t=null,i=-1,n=0; n<e.length; n++)if("true"==e[n].getAttribute("data-view-default")){i=n;break}if(-1!=i){t=e[i];for(var n=i+1; n<e.length; n++)"true"==e[n].getAttribute("data-view-default")&&e[n].removeAttribute("data-view-default")}else 0!=e.length?(t=e[0],t.setAttribute("data-view-default","true")):globalLogger.warn("No view exists to determine the default view.");return t}(),null!=t&&t.classList.add("active"),function(){touch.addTapListener(docEle,function(e){for(var t,i=e.changedTouches?e.changedTouches[0].target:e.target,n=i;null==n.getAttribute("data-view-rel")&&(n=n.parentNode,n instanceof HTMLElement||(n=null),null!=n););if(null!=n&&(t=n.getAttribute("data-view-rel")),null!=t){if(!("true"==n.getAttribute("data-view-rel-disabled"))){if(e.preventDefault(),/^(http|https|ftp):\/\//gim.test(t))return void(window.location.href=t);if(/^\s*@+/.test(t)){var r=t.replace(/^\s*@+/,"").trim();return""==r?void globalLogger.warn("Empty file path for data-view-rel: '{}'",t):void(window.location.href=r)}if(ifStringEqualsIgnoreCase(":back",t))return void history.go(-1);if(ifStringEqualsIgnoreCase(":forward",t))return void history.go(1);var o=View.getActiveView(),a=null==o?null:o.getId();if(null==a||a!=t){var s=n.getAttribute("data-view-rel-type");s=isEmptyString(s,!0)?"nav":s,/^(?:nav)|(?:change)$/.test(s)||(globalLogger.warn("Unknown view switch type: {}. {}",s,n),s="nav"),View[s+"To"](t)}}}},{useCapture:!0})}(),markViewInited(),markViewReady(),function(){var e=null==t?null:t.id,i=parseViewInfoFromHash(location.hash),n=null==i?null:i.viewId,r=null==i?null:i.options,o=null,a=isEmptyString(e,!0);if(!isEmptyString(n,!0)&&View.ifExists(n)?o=n:(globalLogger.warn("No view of id: {}(specified in the location hash) found.",n),!a&&View.ifExists(e)?o=e:(globalLogger.warn("No view of id: {}(default view id) found.",e),o=null)),isEmptyString(o,!0))return void globalLogger.warn("Can not determine the initial view!");var s=getFinalView(o);if(null==s)return void globalLogger.error("No final view found for view of id: {}",o);o=s.getId(),o!=n&&(r=null),replaceViewState(o,Date.now(),r),switchView({srcView:View.getActiveView(),targetView:s,withAnimation:!1,params:null})}()};View.beforeInit=function(){var e=[];return markViewToBeInited=function(){e.forEach(try2exec),e=[]},markViewInited=function(){isViewInited=!0},function(t){return isViewInited?View:e.indexOf(t)!=-1?View:(e.push(t),View)}}(),View.ready=function(){var e=[];return markViewReady=function(){isViewReady=!0,e.forEach(try2exec),e=[]},function(t){return isViewReady?(try2exec(t),View):e.indexOf(t)!=-1?View:(e.push(t),View)}}(),View.setInitializer=function(e,t){if("function"==typeof e){arguments.length<2&&(t="domready");var i="domready, rightnow".split(/\s*,\s*/);i.indexOf(t)==-1&&(globalLogger.warn("Unknown initializer exec time: {}. Supported: {}",t,i),t="domready"),viewInitializer=e,viewInitializerExecTime=t,isViewInited||"rightnow"!=t||(globalLogger.info("Calling specified view initializer right now"),e(init))}},document.addEventListener("DOMContentLoaded",function(){null==viewInitializer?(globalLogger.info("Initializing View automatically"),init()):"domready"==viewInitializerExecTime&&(globalLogger.info("Calling specified view initializer on dom ready"),viewInitializer(init))}),ctx.View=View}(window,"View");