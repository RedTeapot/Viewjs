!function(t,e){var n=function(){var t,e,n=function(){if(0!=arguments.length){var t=arguments,e=" "+String(arguments[0]),n=1;return e=e.replace(/([^\\])\{\}/g,function(e,i){var o=t.length-1<n?"{}":String(r(t[n]));return n++,i+o}),e=e.replace(/\\\{\}/g,"{}"),e.substring(1)}},i=function(){var t=new Date,e=(t.getFullYear(),"0"+String(t.getMonth()+1));e=e.substring(e.length-2);var n="0"+String(t.getDate());n=n.substring(n.length-2);var i="0"+String(t.getHours());i=i.substring(i.length-2);var r="0"+String(t.getMinutes());r=r.substring(r.length-2);var o="0"+String(t.getSeconds());return o=o.substring(o.length-2),e+n+" "+i+":"+r+":"+o},r=function(t){if(null==t)return null;if("number"==typeof t||"string"==typeof t||"boolean"==typeof t)return t;if("function"==typeof t)return"function "+t.name+"(){...}";if(t instanceof Array||"object"!=typeof t)return t instanceof Array?JSON.stringify(t.map(function(t){return r(t)})):t;if("[object Object]"!=String(t))return String(t);try{var e={};for(var n in t)e[n]=r(t[n]);return JSON.stringify(e)}catch(e){return String(t)}},o=function(t){return i()+" ["+t+"]: "},a={};!function(){var n=!0;t=function(){return n},e=function(t){n=t}}();var u=function(e){var i=!0;this.isEnabled=function(){return t()&&i},this.setIsEnabled=function(t){return i=t,this},this.getName=function(){return e},this.debug=function(){if(this.isEnabled()){var t=n.apply(null,arguments);console.debug(o(e)+t)}},this.info=function(){if(this.isEnabled()){var t=n.apply(null,arguments);console.info(o(e)+t)}},this.warn=function(){if(this.isEnabled()){var t=n.apply(null,arguments);console.warn(o(e)+t)}},this.error=function(){if(this.isEnabled()){var t=n.apply(null,arguments);console.error(o(e)+t)}},this.log=function(){if(this.isEnabled()){var t=n.apply(null,arguments);console.log(o(e)+t)}}},l=function(t){if(t in a)return a[t];var e=new u(t);return a[t]=e,e};return u.ofName=l,u.isGloballyEnabled=t,u.setIsGloballyEnabled=e,u}(),i=function(){var t="  __com.soft.plugin.touch#"+(new Date).getTime()+"__  ",e=function(t,e){t=t||{},e=e||{};for(var n in e)n in t||(t[n]=e[n]);return t},n=function(t,e){return t=t||{},t[e]=t[e]||{},t[e]};return{addTapListener:function(i,r,o){if(!d)return void(i.addEventListener?i.addEventListener("click",r):i.attachEvent("onclick",r));var a=n(i,t+".tap");if(a.callbacks=a.callbacks||[],a.callbacks.indexOf(r)==-1){a.callbacks.push(r),o=e(o,{timespan:500,delta:{},useCapture:!1}),o.delta=e(o.delta,{x:10,y:15});var u=n(i,t+".tap.meta");null==u.touchstart&&(u.touchstart=function(t){var e=t.changedTouches?t.changedTouches[0]:t;a.startX=e.screenX,a.startY=e.screenY,a.startTimestamp=Date.now()},i.addEventListener("touchstart",u.touchstart)),null==u.touchend&&(u.touchend=function(t){var e=t.changedTouches?t.changedTouches[0]:t;a.stopX=e.screenX,a.stopY=e.screenY,a.stopTimestamp=Date.now();var n=a.stopTimestamp-a.startTimestamp,r=Math.abs(a.stopX-a.startX),u=Math.abs(a.stopY-a.startY);n<=o.timespan&&r<=o.delta.x&&u<=o.delta.y&&a.callbacks.forEach(function(e){e&&e.call(i,t)})},i.addEventListener("touchend",u.touchend,o.useCapture))}},removeTapListener:function(e,i,r){if(!d)return void(e.removeEventListener?e.removeEventListener("click",i):e.detachEvent("onclick",i));if(e.hasOwnProperty(t)){var o=n(e,t+".tap"),a=o.callbacks.indexOf(i);if(a!=-1&&(o.callbacks.splice(a,1),0==o.callbacks.length)){var u=n(e,t+".tap.meta");e.removeEventListener("touchstart",u.touchstart),e.removeEventListener("touchend",u.touchend,r),delete e[t].tap}}}}}(),r=function(t,e,n){arguments.length<3&&(n=!1),t=t||{},e=e||{};for(var i in e)i in t&&!(i in t&&null==t[i]&&n)||(t[i]=e[i]);return t},o=function(){var t=function(t,e){this.type=t,this.timestamp=(new Date).getTime(),this.data=e,Object.freeze&&Object.freeze(this)};return function(e,n){var i={},r=function(t){i[t]=i[t]||[]};e.on=function(t,e){t=t.toLowerCase(),r(t),i[t].indexOf(e)==-1&&i[t].push(e)},e.off=function(t,e){t=t.toLowerCase(),r(t);var n=i[t].indexOf(e);n!=-1&&i[t].splice(n,1)},e.fire=function(e,o){e=e.toLowerCase();var a=new t(e,o);r(e),i[e].forEach(function(t){t.call(n,a)})}}}(),a=function(t,e,n){Object.defineProperty(t,e,{value:n,configurable:!1,writable:!1,enumerable:!0})},u=function(t,e,n){if(null!=t&&"function"==typeof t)try{t.apply(e,n)}catch(e){w.error("Error occured while executing function: {}. {}",t.name,e)}},l=function(t,e){return arguments.length<2&&(e=!1),null===t||void 0===t||(t=String(t),e&&(t=t.trim()),0==t.length)},s=function(t){return null===t||void 0===t},c=function(t,e,n,i){return arguments.length<4&&(i=!0),arguments.length<3&&(n=!0),s(t)?!!s(e):!s(e)&&(i&&(t=String(t).trim(),e=String(e).trim()),n||(t=t.toLowerCase(),e=e.toLowerCase()),t===e)},f=function(t,e,n){return arguments.length<3&&(n=!0),c(t,e,!1,n)},h=/mobile|tablet|ip(ad|hone|od)|android/i,d=(window,h.test(navigator.userAgent)),g=new Object,v=document.documentElement,w=n.ofName("View"),p=[],m=null,b="pushState"in history&&"function"==typeof history.pushState;w.log("History pushState is "+(b?"":"not ")+"supported");var I=[],E={},y=function(t){return":back"==t||":forward"==t},S=function(t,e){if(!L.ifExists(t)&&!y(t))throw new Error("View of id: "+t+" does not exist.");if(void 0===e&&(e=null),"object"!=typeof e)throw new Error("Parameters specified should be an object or null.");return E[t]=e,L},T=function(t){return delete E[t],L},A=function(t,e,n){arguments.length<3&&(n=null),arguments.length<2&&(e=Date.now()),a(this,"viewId",t),a(this,"timestamp",e),a(this,"options",n),this.toString=function(){return JSON.stringify(this)},this.clone=function(){return JSON.parse(this.toString())}};A.isConstructorOf=function(t){return null!=t&&"object"==typeof t&&(t.hasOwnProperty("viewId")&&t.hasOwnProperty("timestamp"))};var V=function(t){return encodeURIComponent(String(t)).replace(/\+/gm,"%2B")},D=function(t,e){var n=String(t),i=null==e?[]:Object.keys(e),r=i.reduce(function(t,n,i,r){return t+"&"+V(n)+"="+V(e[n])},"");return r.length>0&&(n+="!"+r.substring(1)),n},C=function(t,e,n){arguments.length<3&&(n=null),arguments.length<2&&(e=Date.now());var i=new A(t,e,n).clone();w.log("↓ {}",JSON.stringify(i)),b?history.pushState(i,"","#"+D(t,n)):location.hash=D(t,n),L.currentState=i},O=function(t,e,n){arguments.length<3&&(n=null),arguments.length<2&&(e=Date.now());var i=new A(t,e,n).clone();w.log("% {}",JSON.stringify(i)),b?history.replaceState(i,"","#"+D(t,n)):location.hash=D(t,n),L.currentState=i},W=function(t,e){var n,i=t,r=g;this.getName=function(){return i},this.getValue=function(t){if(g==r){if(arguments.length<1)return;return t}return r},this.setValue=function(t){return r=t,this},this.getApplication=function(){return n},this.setApplication=function(t){return n=t,this},this.apply=function(){return"function"==typeof n&&n(r),this},this.reflectToDom=function(){return null==e||""==e.trim()?this:L.ifExists(e)?(L.ofId(e).getDomElement().setAttribute("data-viewconfig_"+this.getName(),String(this.getValue())),this):(w.warn("No view of id '{}' found to reflect view config: {}={}.",e,this.getName(),this.getValue()),this)},Object.freeze(this)},k=function(t){var e={};this.has=function(t){return t in e},this.get=function(n){var i;return n in e?i=e[n]:(i=new W(n,t),e[n]=i),i},this.applyAll=function(){var t=Object.keys(e).map(function(t){return e[t]});0!=t.length&&setTimeout(function(){t.forEach(function(t){try{t.apply()}catch(t){console.error(t)}})},0)},this.listAll=function(){return Object.keys(e)}},H=function(){var t={};a(this,"has",function(e){return e in t}),a(this,"set",function(e,n){return t[e]=n,this}),a(this,"get",function(e){return t[e]}),a(this,"remove",function(e){var n=t[e];return delete t[e],n}),a(this,"clear",function(){return t={},this})},L=function(t){if(null===document.querySelector("#"+t+"[data-view=true]"))throw new Error("View of id: "+t+" does not exist(No element matching pattern: '#"+t+"[data-view=true]' found)!");var e={},i=new H,r=new k(t);o(this,document.querySelector("#"+t));var u=this.fire;this.fire=function(t,n){e[t]=n,u(t,n)},a(this,"logger",n.ofName("View#"+t)),a(this,"config",r),a(this,"context",i),this.getLatestEventData=function(t){return e[t]},this.getContext=function(){return i},this.clearContext=function(){return i.clear(),this},this.getId=function(){return t},this.getDomElement=function(){return document.querySelector("#"+t)},this.find=function(t){return this.getDomElement().querySelector(t)},this.findAll=function(t){return this.getDomElement().querySelectorAll(t)},this.getParameter=function(t){var e=E[this.getId()];return arguments.length<1?e:null==e?null:e[t]},this.isReady=function(){return I.indexOf(this.getId())!=-1},this.isActive=function(){return this.getDomElement().classList.contains("active")},this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))},this.isDirectlyAccessible=function(){var t=this.getDomElement().getAttribute("data-view-directly-accessible");return t=null==t?null:t.toLowerCase(),L.isDirectlyAccessible()?"false"!=t:"true"==t},this.setAsDirectlyAccessible=function(){this.getDomElement().setAttribute("data-view-directly-accessible","true")},this.setFallbackViewId=function(t){return null==t||""==t.trim()?this:L.ifExists(t)?this.getId()==t?this:void this.getDomElement().setAttribute("data-view-fallback",t):(w.warn("No view of id: {} found.",t),this)},this.getFallbackView=function(){for(var t=this,e=[this.getId()];;){var n=t.getDomElement().getAttribute("data-view-fallback");if(null==n||!L.ifExists(n))return w.warn("View: "+t.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view"),L.getDefaultView();if(t=L.ofId(n),e.indexOf(t.getId())!=-1)return w.error("Cyclical reference of view on fallback configuration on view: {}. Chain: {}, view id: {}",this.getId(),e,t.getId()),L.getDefaultView();if(t.isDirectlyAccessible())return t;e.push(n)}},Object.freeze&&Object.freeze(this)};L.SWITCHTYPE_HISTORYFORWARD="history.forward",L.SWITCHTYPE_HISTORYBACK="history.back",L.SWITCHTYPE_VIEWSWITCH="view.switch",L.Logger=n,L.currentState=null,o(L),L.ofId=function(t){for(var e=0;e<p.length;e++)if(p[e].getId().trim()==t.trim())return p[e];var n=new L(t);return p.push(n),n},L.ifExists=function(t){for(var e=0;e<p.length;e++)if(p[e].getId().trim()==t.trim())return!0;return!1},L.isExisting=L.ifExists,L.listAll=function(){return[].concat(p)},L.setAsDefault=function(t){var e=L.getDefaultView();if(null!=e){if(e.getId()==t)return;e.getDomElement().removeAttribute("data-view-default")}return L.ofId(t).getDomElement().setAttribute("data-view-default","true"),L},L.isDirectlyAccessible=function(){return f("true",v.getAttribute("data-view-directly-accessible"))},L.setIsDirectlyAccessible=function(t){return v.setAttribute("data-view-directly-accessible",String(!!t).toLowerCase()),L},L.getActiveView=function(){for(var t=0;t<p.length;t++)if(p[t].isActive())return p[t];return null},L.getDefaultView=function(){for(var t=0;t<p.length;t++)if(p[t].isDefault())return p[t];return null},L.setSwitchAnimation=function(t){if(!(t instanceof Function))throw new Error("Invalid argument. Animation of Function is needed.");return m=t,L},L.getSwitchAnimation=function(){return m};var x=function(t){if(""==t)return null;var e=t.match(/^#([\w\$\-]+)(?:!+(.*))?/);if(null==e)return null;var n=(e[1],null);if(null!=e[2]&&""!=e[2].trim()){var i=e[2].split(/\s*&\s*/);0!=i.length&&(n={},i.forEach(function(t){var e=t.split(/\s*=\s*/);n[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}))}return{viewId:e[1],options:n}};L.getActiveViewOptions=function(){var t=x(location.hash);return null==t?null:t.options};var Y=function(t){t=r(t,{srcView:null,targetView:null,type:L.SWITCHTYPE_VIEWSWITCH,withAnimation:!0,params:null});var e=t.srcView,n=t.targetView,i=t.type,o=t.params;null==i&&(i=L.SWITCHTYPE_VIEWSWITCH);var a=f(i,L.SWITCHTYPE_HISTORYBACK),u=f(i,L.SWITCHTYPE_HISTORYFORWARD);a||u||(i=L.SWITCHTYPE_VIEWSWITCH),L.fire("beforechange",{currentView:e,targetView:n,type:i,params:o}),e&&e.fire("leave",{targetView:n,type:i});var l=function(){e&&e.getDomElement().classList.remove("active"),n.getDomElement().classList.add("active")},s=function(){var t=n.getId();T(t),a?":back"in E&&(S(t,E[":back"]),delete E[":back"]):u?":forward"in E&&(S(t,E[":forward"]),delete E[":forward"]):S(t,o);var r={sourceView:e,type:i,params:o};n.isReady()||(I.push(t),n.fire("ready",r)),["beforeenter","enter","afterenter"].forEach(function(t){n.fire(t,r)})},c=function(){l(),s()};t.withAnimation&&m?m.call(null,e?e.getDomElement():null,n.getDomElement(),i,c):c(),L.fire("afterchange",{currentView:e,targetView:n,type:i,params:o})},P=function(t,e){if(e=r(e,{type:L.SWITCHTYPE_VIEWSWITCH},!0),!L.ifExists(t))throw new Error("Target view: "+t+" does not exist!");var n=L.getActiveView();if(f(n.getId(),t))return L;w.log("{} → {} {}",n.getId(),t,JSON.stringify(e));var i=L.ofId(t);return e.srcView=n,e.targetView=i,Y(e),L};L.show=P,L.switchTo=function(t,e,n,i){return arguments.length<4&&(i=null),arguments.length<3&&(n=!0),arguments.length<2&&(e=L.SWITCHTYPE_VIEWSWITCH),e=e||L.SWITCHTYPE_VIEWSWITCH,P(t,{type:e,withAnimation:n,params:i}),L},L.switchView=L.switchTo,L.navTo=function(t,e){return t=t.trim(),f(L.getActiveView().getId(),t)?L:":back"==t?(L.back(e),L):":forward"==t?(L.forward(e),L):(P(t,e),C(t,Date.now(),null==e?null:e.options),L)},L.updateView=L.navTo,L.changeTo=function(t,e){return f(L.getActiveView().getId(),t)?L:(P(t,e),O(t,Date.now(),null==e?null:e.options),L)},L.back=function(t){T(":back"),null!=t&&"params"in t&&S(":back",t.params),history.go(-1)},L.forward=function(t){T(":forward"),null!=t&&"params"in t&&S(":forward",t.params),history.go(1)};var _=document.title,N=function(t){return l(t,!0)?(w.warn("Invalid document title: "+t),L):(document.title=_=t,L)};L.setDocumentTitle=N;var R,j,F;L.beforeInit=function(){var t=!1;j=function(){e.forEach(u),e=[]};var e=[];return F=function(){t=!0},function(n){return t?L:e.indexOf(n)!=-1?L:(e.push(n),L)}}(),L.ready=function(){var t=!1,e=[];return R=function(){t=!0,setTimeout(function(){e.forEach(u),e=[]},0)},function(n){return t?(u(n),L):e.indexOf(n)!=-1?L:(e.push(n),L)}}();var J=function(){var t=L.getActiveView();return null==t&&(t=L.getDefaultView()),t},q=function(t){var e=null;return l(t,!0)||!L.ifExists(t)?e=J():(e=L.ofId(t),e.isDirectlyAccessible()||(e=e.getFallbackView())),e},M=function(t){var e=L.getActiveView(),n=null==e?null:e.getId();w.log("{} Current: {}",b?"State poped!":"Hash changed!",e.getId()),w.log("↑ {}",b?JSON.stringify(t.state):location.hash);var i,r,o=L.SWITCHTYPE_VIEWSWITCH,a=null;if(null==t.state){o=L.SWITCHTYPE_VIEWSWITCH;var u=x(location.hash);i=u.viewId,a=q(i);var l=a.getId(),s=l==i;r=l==n?L.currentState.options:s?u.options:null,O(l,Date.now(),r)}else{var c=t.state;i=c.viewId,L.ifExists(i)?(a=L.ofId(i),r=c.options):(w.warn("Poped view: "+i+" does not exist, keeping current."),a=e,r=null);var l=a.getId();null!=L.currentState&&(o=c.timestamp<L.currentState.timestamp?L.SWITCHTYPE_HISTORYBACK:L.SWITCHTYPE_HISTORYFORWARD),O(l,c.timestamp,r)}L.show(a.getId(),{type:o,options:r})},X=function(){j(),window.addEventListener(b?"popstate":"hashchange",M);var t=document.querySelectorAll("*[data-view=true]");[].forEach.call(t,function(t){L.ofId(t.id),t.classList.remove("active"),t.classList.add("view"),function(){var e=t.getAttribute("data-view-title");L.ofId(t.id).on("enter",function(){document.title=null==e?_:e})}()});var e=null;e=function(){for(var e=null,n=-1,i=0;i<t.length;i++)if("true"==t[i].getAttribute("data-view-default")){n=i;break}if(-1!=n){e=t[n];for(var i=n+1;i<t.length;i++)"true"==t[i].getAttribute("data-view-default")&&t[i].removeAttribute("data-view-default")}else 0!=t.length?(e=t[0],e.setAttribute("data-view-default","true")):w.warn("No view exists to determine the default view.");return e}(),null!=e&&e.classList.add("active"),function(){var t=null==e?null:e.id,n=x(location.hash),i=null==n?null:n.viewId,r=null==n?null:n.options,o=l(i,!0)?t:i;if(l(o,!0))return void w.warn("Can not determine the initial view!");var a=q(o);o=a.getId(),o!=i&&(r=null),O(o,Date.now(),r),Y({srcView:L.getActiveView(),targetView:a,withAnimation:!1,params:null})}(),function(){i.addTapListener(v,function(t){for(var e,n=t.changedTouches?t.changedTouches[0].target:t.target,i=n;null==i.getAttribute("data-view-rel")&&(i=i.parentNode,i instanceof HTMLElement||(i=null),null!=i););if(null!=i&&(e=i.getAttribute("data-view-rel")),null!=e){if(!("true"==i.getAttribute("data-view-rel-disabled"))){if(t.preventDefault(),/^(http|https|ftp):\/\//gim.test(e))return void(window.location.href=e);if(f(":back",e))return void history.go(-1);if(f(":forward",e))return void history.go(1);var r=L.getActiveView(),o=null==r?null:r.getId();if(null==o||o!=e){var a=i.getAttribute("data-view-rel-type");a=l(a,!0)?"nav":a,/^(?:nav)|(?:change)$/.test(a)||(w.warn("Unknown view switch type: {}. {}",a,i),a="nav"),L[a+"To"](e,{type:L.SWITCHTYPE_VIEWSWITCH})}}}},{useCapture:!0})}(),F(),R()};document.addEventListener("DOMContentLoaded",X),t.View=L}(window);