!function(t,e){var n=function(){var t,e,n=function(){if(0!=arguments.length){var t=arguments,e=" "+String(arguments[0]),n=1;return e=e.replace(/([^\\])\{\}/g,function(e,i){var a=t.length-1<n?"{}":String(r(t[n]));return n++,i+a}),e=e.replace(/\\\{\}/g,"{}"),e.substring(1)}},i=function(){var t=new Date,e=(t.getFullYear(),"0"+String(t.getMonth()+1));e=e.substring(e.length-2);var n="0"+String(t.getDate());n=n.substring(n.length-2);var i="0"+String(t.getHours());i=i.substring(i.length-2);var r="0"+String(t.getMinutes());r=r.substring(r.length-2);var a="0"+String(t.getSeconds());return a=a.substring(a.length-2),e+n+" "+i+":"+r+":"+a},r=function(t){if(null==t)return null;if("number"==typeof t||"string"==typeof t||"boolean"==typeof t)return t;if("function"==typeof t)return"function "+t.name+"(){...}";if(t instanceof Array||"object"!=typeof t)return t instanceof Array?JSON.stringify(t.map(function(t){return r(t)})):t;if("[object Object]"!=String(t))return String(t);try{var e={};for(var n in t)e[n]=r(t[n]);return JSON.stringify(e)}catch(e){return String(t)}},a=function(t){return i()+" ["+t+"]: "},o={};!function(){var n=!0;t=function(){return n},e=function(t){n=t}}();var u=function(e){var i=!0;this.isEnabled=function(){return t()&&i},this.setIsEnabled=function(t){return i=t,this},this.getName=function(){return e},this.debug=function(){if(this.isEnabled()){var t=n.apply(null,arguments);console.debug(a(e)+t)}},this.info=function(){if(this.isEnabled()){var t=n.apply(null,arguments);console.info(a(e)+t)}},this.warn=function(){if(this.isEnabled()){var t=n.apply(null,arguments);console.warn(a(e)+t)}},this.error=function(){if(this.isEnabled()){var t=n.apply(null,arguments);console.error(a(e)+t)}},this.log=function(){if(this.isEnabled()){var t=n.apply(null,arguments);console.log(a(e)+t)}}},l=function(t){if(t in o)return o[t];var e=new u(t);return o[t]=e,e};return u.ofName=l,u.isGloballyEnabled=t,u.setIsGloballyEnabled=e,u}(),i=function(){var t="  __com.soft.plugin.touch#"+(new Date).getTime()+"__  ",e=function(t,e){t=t||{},e=e||{};for(var n in e)n in t||(t[n]=e[n]);return t},n=function(t,e){return t=t||{},t[e]=t[e]||{},t[e]};return{addTapListener:function(i,r,a){if(!d)return void(i.addEventListener?i.addEventListener("click",r):i.attachEvent("onclick",r));var o=n(i,t+".tap");if(o.callbacks=o.callbacks||[],o.callbacks.indexOf(r)==-1){o.callbacks.push(r),a=e(a,{timespan:500,delta:{},useCapture:!1}),a.delta=e(a.delta,{x:10,y:15});var u=n(i,t+".tap.meta");null==u.touchstart&&(u.touchstart=function(t){var e=t.changedTouches?t.changedTouches[0]:t;o.startX=e.screenX,o.startY=e.screenY,o.startTimestamp=Date.now()},i.addEventListener("touchstart",u.touchstart)),null==u.touchend&&(u.touchend=function(t){var e=t.changedTouches?t.changedTouches[0]:t;o.stopX=e.screenX,o.stopY=e.screenY,o.stopTimestamp=Date.now();var n=o.stopTimestamp-o.startTimestamp,r=Math.abs(o.stopX-o.startX),u=Math.abs(o.stopY-o.startY);n<=a.timespan&&r<=a.delta.x&&u<=a.delta.y&&o.callbacks.forEach(function(e){e&&e.call(i,t)})},i.addEventListener("touchend",u.touchend,a.useCapture))}},removeTapListener:function(e,i,r){if(!d)return void(e.removeEventListener?e.removeEventListener("click",i):e.detachEvent("onclick",i));if(e.hasOwnProperty(t)){var a=n(e,t+".tap"),o=a.callbacks.indexOf(i);if(o!=-1&&(a.callbacks.splice(o,1),0==a.callbacks.length)){var u=n(e,t+".tap.meta");e.removeEventListener("touchstart",u.touchstart),e.removeEventListener("touchend",u.touchend,r),delete e[t].tap}}}}}(),r=function(t,e,n){arguments.length<3&&(n=!1),t=t||{},e=e||{};for(var i in e)i in t&&!(i in t&&null==t[i]&&n)||(t[i]=e[i]);return t},a=function(){var t=function(t,e){this.type=t,this.timestamp=(new Date).getTime(),this.data=e,Object.freeze&&Object.freeze(this)};return function(e,n){var i={},r=function(t){i[t]=i[t]||[]};e.on=function(t,e){t=t.toLowerCase(),r(t),i[t].indexOf(e)==-1&&i[t].push(e)},e.off=function(t,e){t=t.toLowerCase(),r(t);var n=i[t].indexOf(e);n!=-1&&i[t].splice(n,1)},e.fire=function(e,a){e=e.toLowerCase();var o=new t(e,a);r(e),i[e].forEach(function(t){t.call(n,o)})}}}(),o=function(t,e,n){Object.defineProperty(t,e,{value:n,configurable:!1,writable:!1,enumerable:!0})},u=function(t,e,n){if(null!=t&&"function"==typeof t)try{t.apply(e,n)}catch(e){var i=e instanceof Error||null!=e&&"object"==typeof e&&"stack"in e,r="Error occured while executing function: {}. {}"+(i?" stack:\n{}":"");w.error(r,t.name,e,i?e.stack:null)}},l=function(t,e){return arguments.length<2&&(e=!1),null===t||void 0===t||(t=String(t),e&&(t=t.trim()),0==t.length)},s=function(t){return null===t||void 0===t},c=function(t,e,n,i){return arguments.length<4&&(i=!0),arguments.length<3&&(n=!0),s(t)?!!s(e):!s(e)&&(i&&(t=String(t).trim(),e=String(e).trim()),n||(t=t.toLowerCase(),e=e.toLowerCase()),t===e)},f=function(t,e,n){return arguments.length<3&&(n=!0),c(t,e,!1,n)},h=/mobile|tablet|ip(ad|hone|od)|android/i,d=(window,h.test(navigator.userAgent)),g=new Object,v=document.documentElement,w=n.ofName("View"),p=[],m=null,b="pushState"in history&&"function"==typeof history.pushState;w.log("History pushState is "+(b?"":"not ")+"supported");var y=[],E={},I=function(t){return":back"==t||":forward"==t},S=function(t,e){if(!Y.ifExists(t)&&!I(t))throw new Error("View of id: "+t+" does not exist.");if(void 0===e&&(e=null),"object"!=typeof e)throw new Error("Parameters specified should be an object or null.");return E[t]=e,Y},T=function(t){return delete E[t],Y},A=function(){return document.querySelectorAll("*[data-view=true]")},V=function(t){return document.querySelector("#"+t+"[data-view=true]")},C=function(t,e,n){arguments.length<3&&(n=null),arguments.length<2&&(e=Date.now()),o(this,"viewId",t),o(this,"timestamp",e),o(this,"options",n),this.toString=function(){return JSON.stringify(this)},this.clone=function(){return JSON.parse(this.toString())}};C.isConstructorOf=function(t){return null!=t&&"object"==typeof t&&(t.hasOwnProperty("viewId")&&t.hasOwnProperty("timestamp"))};var D=function(t){return encodeURIComponent(String(t)).replace(/\+/gm,"%2B")},O=function(t,e){var n=String(t),i=null==e?[]:Object.keys(e),r=i.reduce(function(t,n,i,r){return t+"&"+D(n)+"="+D(e[n])},"");return r.length>0&&(n+="!"+r.substring(1)),n},k=function(t,e,n){arguments.length<3&&(n=null),arguments.length<2&&(e=Date.now());var i=new C(t,e,n).clone();w.log("↓ {}",JSON.stringify(i)),b?history.pushState(i,"","#"+O(t,n)):location.hash=O(t,n),Y.currentState=i},W=function(t,e,n){arguments.length<3&&(n=null),arguments.length<2&&(e=Date.now());var i=new C(t,e,n).clone();w.log("% {}",JSON.stringify(i)),b?history.replaceState(i,"","#"+O(t,n)):location.hash=O(t,n),Y.currentState=i},H=function(t,e){var n,i=t,r=g;this.getName=function(){return i},this.getValue=function(t){if(g==r){if(arguments.length<1)return;return t}return r},this.setValue=function(t,e){return arguments.length<2&&(e=!1),(e||g==r)&&(r=t),this},this.getApplication=function(){return n},this.setApplication=function(t){return n=t,this},this.apply=function(){return"function"==typeof n&&n.call(this,r),this},this.reflectToDom=function(){return null==e||""==e.trim()?this:Y.ifExists(e)?(Y.ofId(e).getDomElement().setAttribute("data-viewconfig_"+this.getName(),String(this.getValue())),this):(w.warn("No view of id '{}' found to reflect view config: {}={}.",e,this.getName(),this.getValue()),this)},Object.freeze(this)},L=function(t){var e={};this.has=function(t){return t in e},this.get=function(n){var i;return n in e?i=e[n]:(i=new H(n,t),e[n]=i),i},this.applyAll=function(){var t=Object.keys(e).map(function(t){return e[t]});0!=t.length&&setTimeout(function(){t.forEach(function(t){try{t.apply()}catch(t){console.error(t)}})},0)},this.listAll=function(){return Object.keys(e)}},x=function(){var t={};o(this,"has",function(e){return e in t}),o(this,"set",function(e,n){return t[e]=n,this}),o(this,"get",function(e){return t[e]}),o(this,"remove",function(e){var n=t[e];return delete t[e],n}),o(this,"clear",function(){return t={},this})},Y=function(t){if(null===document.querySelector("#"+t+"[data-view=true]"))throw new Error("View of id: "+t+" does not exist(No element matching pattern: '#"+t+"[data-view=true]' found)!");var e={},i=new x,r=new L(t);a(this,document.querySelector("#"+t));var u=this.fire;this.fire=function(t,n){e[t]=n,u(t,n)},o(this,"logger",n.ofName("View#"+t)),o(this,"config",r),o(this,"context",i),this.getLatestEventData=function(t){return e[t]},this.getContext=function(){return i},this.clearContext=function(){return i.clear(),this},this.getId=function(){return t},this.getDomElement=function(){return document.querySelector("#"+t)},this.find=function(t){return this.getDomElement().querySelector(t)},this.findAll=function(t){return this.getDomElement().querySelectorAll(t)},this.hasParameter=function(t){if(null===t||void 0===t)return!1;var e=E[this.getId()];return null!=e&&t in e},this.getParameter=function(t){var e=E[this.getId()];return arguments.length<1?e:null==e?null:e[t]},this.isReady=function(){return y.indexOf(this.getId())!=-1},this.isActive=function(){return this.getDomElement().classList.contains("active")},this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))},this.isDirectlyAccessible=function(){var t=this.getDomElement().getAttribute("data-view-directly-accessible");return t=null==t?null:t.toLowerCase(),Y.isDirectlyAccessible()?"false"!=t:"true"==t},this.setAsDirectlyAccessible=function(){this.getDomElement().setAttribute("data-view-directly-accessible","true")},this.setFallbackViewId=function(t){return null==t||""==t.trim()?this:Y.ifExists(t)?this.getId()==t?this:void this.getDomElement().setAttribute("data-view-fallback",t):(w.warn("No view of id: {} found.",t),this)},this.getFallbackView=function(){for(var t=this,e=[this.getId()];;){var n=t.getDomElement().getAttribute("data-view-fallback");if(null==n||!Y.ifExists(n))return w.warn("View: "+t.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view"),Y.getDefaultView();if(t=Y.ofId(n),e.indexOf(t.getId())!=-1)return w.error("Cyclical reference of view on fallback configuration on view: {}. Chain: {}, view id: {}",this.getId(),e,t.getId()),Y.getDefaultView();if(t.isDirectlyAccessible())return t;e.push(n)}},Object.freeze&&Object.freeze(this)};Y.SWITCHTYPE_HISTORYFORWARD="history.forward",Y.SWITCHTYPE_HISTORYBACK="history.back",Y.SWITCHTYPE_VIEWSWITCH="view.switch",Y.Logger=n,Y.currentState=null,a(Y),Y.ofId=function(t){for(var e=0; e<p.length; e++)if(p[e].getId().trim()==t.trim())return p[e];var n=new Y(t);return p.push(n),n},Y.ifExists=function(t){for(var e=0; e<p.length; e++)if(p[e].getId().trim()==t.trim())return!0;return!1},Y.isExisting=Y.ifExists,Y.listAll=function(){return[].concat(p)},Y.setAsDefault=function(t){for(var e=A(),n=0; n<e.length; n++)e[n].removeAttribute("data-view-default");var i=V(t);return null==i?(w.error("No view dom element of id: {} found to set as default.",t),Y):(i.setAttribute("data-view-default","true"),Y)},Y.isDirectlyAccessible=function(){return f("true",v.getAttribute("data-view-directly-accessible"))},Y.setIsDirectlyAccessible=function(t){return v.setAttribute("data-view-directly-accessible",String(!!t).toLowerCase()),Y},Y.getActiveView=function(){for(var t=0;t<p.length;t++)if(p[t].isActive())return p[t];return null},Y.getDefaultView=function(){for(var t=0;t<p.length;t++)if(p[t].isDefault())return p[t];return null},Y.setSwitchAnimation=function(t){if(!(t instanceof Function))throw new Error("Invalid argument. Animation of Function is needed.");return m=t,Y},Y.getSwitchAnimation=function(){return m};var P=function(t){if(""==t)return null;var e=t.match(/^#([\w\$\-]+)(?:!+(.*))?/);if(null==e)return null;var n=(e[1],null);if(null!=e[2]&&""!=e[2].trim()){var i=e[2].split(/\s*&\s*/);0!=i.length&&(n={},i.forEach(function(t){var e=t.split(/\s*=\s*/);n[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}))}return{viewId:e[1],options:n}};Y.getActiveViewOptions=function(){var t=P(location.hash);return null==t?null:t.options};var N=function(t){t=r(t,{srcView:null,targetView:null,type:Y.SWITCHTYPE_VIEWSWITCH,withAnimation:!0,params:null});var e=t.srcView,n=t.targetView,i=t.type,a=t.params;null==i&&(i=Y.SWITCHTYPE_VIEWSWITCH);var o=f(i,Y.SWITCHTYPE_HISTORYBACK),u=f(i,Y.SWITCHTYPE_HISTORYFORWARD);o||u||(i=Y.SWITCHTYPE_VIEWSWITCH),Y.fire("beforechange",{currentView:e,targetView:n,type:i,params:a}),e&&e.fire("leave",{targetView:n,type:i});var l=function(){e&&e.getDomElement().classList.remove("active"),n.getDomElement().classList.add("active")},s=function(){var t=n.getId();T(t),o?":back"in E&&(S(t,E[":back"]),delete E[":back"]):u?":forward"in E&&(S(t,E[":forward"]),delete E[":forward"]):S(t,a);var r={sourceView:e,type:i,params:a};n.isReady()||(y.push(t),n.fire("ready",r)),["beforeenter","enter","afterenter"].forEach(function(t){n.fire(t,r)})},c=function(){l(),s()};t.withAnimation&&m?m.call(null,e?e.getDomElement():null,n.getDomElement(),i,c):c(),Y.fire("afterchange",{currentView:e,targetView:n,type:i,params:a})},_=function(t,e){if(e=r(e,{type:Y.SWITCHTYPE_VIEWSWITCH},!0),!Y.ifExists(t))throw new Error("Target view: "+t+" does not exist!");var n=Y.getActiveView();if(f(n.getId(),t))return Y;w.log("{} → {} {}",n.getId(),t,JSON.stringify(e));var i=Y.ofId(t);return e.srcView=n,e.targetView=i,N(e),Y};Y.show=_,Y.switchTo=function(t,e,n,i){return arguments.length<4&&(i=null),arguments.length<3&&(n=!0),arguments.length<2&&(e=Y.SWITCHTYPE_VIEWSWITCH),e=e||Y.SWITCHTYPE_VIEWSWITCH,_(t,{type:e,withAnimation:n,params:i}),Y},Y.switchView=Y.switchTo,Y.navTo=function(t,e){return t=t.trim(),f(Y.getActiveView().getId(),t)?Y:":back"==t?(Y.back(e),Y):":forward"==t?(Y.forward(e),Y):(_(t,e),k(t,Date.now(),null==e?null:e.options),Y)},Y.updateView=Y.navTo,Y.changeTo=function(t,e){return f(Y.getActiveView().getId(),t)?Y:(_(t,e),W(t,Date.now(),null==e?null:e.options),Y)},Y.back=function(t){T(":back"),null!=t&&"params"in t&&S(":back",t.params),history.go(-1)},Y.forward=function(t){T(":forward"),null!=t&&"params"in t&&S(":forward",t.params),history.go(1)};var j=document.title,R=function(t){return l(t,!0)?(w.warn("Invalid document title: "+t),Y):(document.title=j=t,Y)};Y.setDocumentTitle=R;var F,J,q;Y.beforeInit=function(){var t=!1;J=function(){e.forEach(u),e=[]};var e=[];return q=function(){t=!0},function(n){return t?Y:e.indexOf(n)!=-1?Y:(e.push(n),Y)}}(),Y.ready=function(){var t=!1,e=[];return F=function(){t=!0,setTimeout(function(){e.forEach(u),e=[]},0)},function(n){return t?(u(n),Y):e.indexOf(n)!=-1?Y:(e.push(n),Y)}}();var M=function(){var t=Y.getActiveView();return null==t&&(t=Y.getDefaultView()),t},X=function(t){var e=null;return l(t,!0)||!Y.ifExists(t)?e=M():(e=Y.ofId(t),e.isDirectlyAccessible()||(e=e.getFallbackView())),e},z=function(t){var e=Y.getActiveView(),n=null==e?null:e.getId();w.log("{} Current: {}",b?"State poped!":"Hash changed!",e.getId()),w.log("↑ {}",b?JSON.stringify(t.state):location.hash);var i,r,a=Y.SWITCHTYPE_VIEWSWITCH,o=null;if(null==t.state){a=Y.SWITCHTYPE_VIEWSWITCH;var u,l=P(location.hash);null==l?(o=e,u=n):(i=l.viewId,o=X(i),u=o.getId());var s=u==i;r=u==n?Y.currentState.options:s?l.options:null,W(u,Date.now(),r)}else{var c=t.state;i=c.viewId,Y.ifExists(i)?(o=Y.ofId(i),r=c.options):(w.warn("Poped view: "+i+" does not exist, keeping current."),o=e,r=null);var u=o.getId();null!=Y.currentState&&(a=c.timestamp<Y.currentState.timestamp?Y.SWITCHTYPE_HISTORYBACK:Y.SWITCHTYPE_HISTORYFORWARD),W(u,c.timestamp,r)}Y.show(o.getId(),{type:a,options:r})},B=function(){J(),window.addEventListener(b?"popstate":"hashchange",z);var t=A();[].forEach.call(t,function(t){Y.ofId(t.id),t.classList.remove("active"),t.classList.add("view"),function(){var e=t.getAttribute("data-view-title");Y.ofId(t.id).on("enter",function(){document.title=null==e?j:e})}()});var e=null;e=function(){for(var e=null,n=-1,i=0; i<t.length; i++)if("true"==t[i].getAttribute("data-view-default")){n=i;break}if(-1!=n){e=t[n];for(var i=n+1; i<t.length; i++)"true"==t[i].getAttribute("data-view-default")&&t[i].removeAttribute("data-view-default")}else 0!=t.length?(e=t[0],e.setAttribute("data-view-default","true")):w.warn("No view exists to determine the default view.");return e}(),null!=e&&e.classList.add("active"),function(){var t=null==e?null:e.id,n=P(location.hash),i=null==n?null:n.viewId,r=null==n?null:n.options,a=l(i,!0)?t:i;if(l(a,!0))return void w.warn("Can not determine the initial view!");var o=X(a);a=o.getId(),a!=i&&(r=null),W(a,Date.now(),r),N({srcView:Y.getActiveView(),targetView:o,withAnimation:!1,params:null})}(),function(){i.addTapListener(v,function(t){for(var e,n=t.changedTouches?t.changedTouches[0].target:t.target,i=n;null==i.getAttribute("data-view-rel")&&(i=i.parentNode,i instanceof HTMLElement||(i=null),null!=i););if(null!=i&&(e=i.getAttribute("data-view-rel")),null!=e){if(!("true"==i.getAttribute("data-view-rel-disabled"))){if(t.preventDefault(),/^(http|https|ftp):\/\//gim.test(e))return void(window.location.href=e);if(/^\s*@+/.test(e)){var r=e.replace(/^\s*@+/,"").trim();return""==r?void w.warn("Empty file path for data-view-rel: '{}'",e):void(window.location.href=r)}if(f(":back",e))return void history.go(-1);if(f(":forward",e))return void history.go(1);var a=Y.getActiveView(),o=null==a?null:a.getId();if(null==o||o!=e){var u=i.getAttribute("data-view-rel-type");u=l(u,!0)?"nav":u,/^(?:nav)|(?:change)$/.test(u)||(w.warn("Unknown view switch type: {}. {}",u,i),u="nav"),Y[u+"To"](e,{type:Y.SWITCHTYPE_VIEWSWITCH})}}}},{useCapture:!0})}(),q(),F()};document.addEventListener("DOMContentLoaded",B),t.View=Y}(window);