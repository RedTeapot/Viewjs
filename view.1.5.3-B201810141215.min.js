/**
 * View.js v1.5.3-B201810141215
 * author: Billy, wmjhappy_ok@126.com
 * license: MIT
 */
!function(t,e){if("View"in t)return void console.error("Plugin name: 'View' has already been used.");t.View={}}(window),function(t,e){var n=function(){var t=function(t,e){this.type=t,this.timestamp=(new Date).getTime(),this.data=e,Object.freeze&&Object.freeze(this)};return function(e,n){var i={},r=function(t){i[t]=i[t]||[]};e.on=function(t,e){String(t).replace(/(\s*,){2,}/,",").toLowerCase().split(/\s*,\s*/).forEach(function(t){r(t),i[t].indexOf(e)==-1&&i[t].push(e)})},e.off=function(t,e){String(t).replace(/(\s*,){2,}/,",").toLowerCase().split(/\s*,\s*/).forEach(function(t){r(t);var n=i[t].indexOf(e);n!=-1&&i[t].splice(n,1)})},e.fire=function(e,o,a){arguments.length<3&&(a=!0),String(e).replace(/(\s*,){2,}/,",").toLowerCase().split(/\s*,\s*/).forEach(function(e){var u=new t(e,o),l=function(){r(e);for(var t=0;t<i[e].length;t++){var o=i[e][t];if("function"==typeof o)try{o.call(n,u)}catch(t){console.error(t,t.stack)}}};a?setTimeout(l,0):l()})}}}();t.View.eventDrive=n}(window),function(t,e){var n=function(){var t,e,n=function(){if(0!=arguments.length){var t=arguments,e=" "+String(arguments[0]),n=1;return e=e.replace(/([^\\])\{\}/g,function(e,i){var o=t.length-1<n?"{}":String(r(t[n]));return n++,i+o}),e=e.replace(/\\\{\}/g,"{}"),e.substring(1)}},i=function(){var t=new Date,e=(t.getFullYear(),"0"+String(t.getMonth()+1));e=e.substring(e.length-2);var n="0"+String(t.getDate());n=n.substring(n.length-2);var i="0"+String(t.getHours());i=i.substring(i.length-2);var r="0"+String(t.getMinutes());r=r.substring(r.length-2);var o="0"+String(t.getSeconds());return o=o.substring(o.length-2),e+n+" "+i+":"+r+":"+o},r=function(t){if(null==t)return null;if("number"==typeof t||"string"==typeof t||"boolean"==typeof t)return t;if("function"==typeof t)return"function "+t.name+"(){...}";if("object"!=typeof t||Array.isArray(t))return t instanceof Array?"["+t.map(function(t){return r(t)}).join(", ")+"]":t;if("[object Object]"!=String(t))return String(t);var e=JSON.stringify(t);if("{}"!=e)return e;try{var n={};for(var i in t)n[i]=r(t[i]);return JSON.stringify(n)}catch(t){return e}},o=function(t){return i()+" ["+t+"]: "},a={};!function(){var n=!0;t=function(){return n},e=function(t){n=t}}();var u=function(e){var i=!0;this.isEnabled=function(){return t()&&i},this.setIsEnabled=function(t){return i=t,this},this.getName=function(){return e},this.debug=function(){if(this.isEnabled()){var t=n.apply(null,arguments);console.debug(o(e)+t)}},this.info=function(){if(this.isEnabled()){var t=n.apply(null,arguments);console.info(o(e)+t)}},this.warn=function(){if(this.isEnabled()){var t=n.apply(null,arguments);console.warn(o(e)+t)}},this.error=function(){if(this.isEnabled()){var t=n.apply(null,arguments);console.error(o(e)+t)}},this.log=function(){if(this.isEnabled()){var t=n.apply(null,arguments);console.log(o(e)+t)}}},l=function(t){if(t in a)return a[t];var e=new u(t);return a[t]=e,e};return u.ofName=l,u.isGloballyEnabled=t,u.setIsGloballyEnabled=e,u}();n.globalLogger=n.ofName("View"),t.View.Logger=n}(window),function(ctx,name){var globalLogger=ctx.View.Logger.globalLogger,setDftValue=function(t,e,n){arguments.length<3&&(n=!1),t=t||{},e=e||{};for(var i in e)i in t&&!(i in t&&null==t[i]&&n)||(t[i]=e[i]);return t},defineReadOnlyProperty=function(t,e,n){Object.defineProperty(t,e,{value:n,configurable:!1,writable:!1,enumerable:!0})},try2Apply=function(t,e,n){if(null!=t&&"function"==typeof t)try{t.apply(e,n)}catch(e){var i=e instanceof Error||null!=e&&"object"==typeof e&&"stack"in e,r="Error occured while executing function: {}. {}"+(i?" stack:\n{}":"");globalLogger.error(r,t.name,e,i?e.stack:null)}},try2Call=function(func,ctx,args){if(null!=func&&"function"==typeof func)try{var len=arguments.length;if(1==len)return func();if(2==len)return func.call(ctx);if(3==len)return func.call(ctx,arguments[2]);if(4==len)return func.call(ctx,arguments[2],arguments[3]);if(5==len)return func.call(ctx,arguments[2],arguments[3],arguments[4]);if(6==len)return func.call(ctx,arguments[2],arguments[3],arguments[4],arguments[5]);if(7==len)return func.call(ctx,arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]);for(var tmp="",index=2,i=2;i<arguments.length;i++)tmp+=",arguments["+i+"]";var rst;return void eval("rst = func.call(ctx"+tmp+")")}catch(t){return void console.error("Error occured while executing function: "+func.name,t,t.stack)}},isEmptyString=function(t,e){return arguments.length<2&&(e=!1),null===t||void 0===t||(t=String(t),e&&(t=t.trim()),0==t.length)},isNullOrUndefined=function(t){return null===t||void 0===t},ifStringEquals=function(t,e,n,i){return arguments.length<4&&(i=!0),arguments.length<3&&(n=!0),isNullOrUndefined(t)?!!isNullOrUndefined(e):!isNullOrUndefined(e)&&(i&&(t=String(t).trim(),e=String(e).trim()),n||(t=t.toLowerCase(),e=e.toLowerCase()),t===e)},ifStringEqualsIgnoreCase=function(t,e,n){return arguments.length<3&&(n=!0),ifStringEquals(t,e,!1,n)},randomString=function(){var t="0123456789abcdefghijklmnopqrstuvwxyz";return function(e){arguments.length<1&&(e="");for(var n=10,i="";n-- >0;){var r=Math.floor(Math.random()*t.length);i+=t.charAt(r)}return e+i}}(),xEncodeURIComponent=function(t){return encodeURIComponent(String(t)).replace(/\+/gm,"%2B")},getUniqueString=function(){var t=0;return function(){var e=Date.now(),n=e.toString(36),i="00"+(t++).toString(36);return i=i.substring(i.length-2),(n+i).toUpperCase()}}(),env=function(){var t=navigator.userAgent,e=/(?:MQQBrowser|QQ)/.test(t),n=/(?:UCWEB|UCBrowser)/.test(t),i=/(?:Safari)/.test(t),r=/(?:Opera Mini)/.test(t),o=/(?:Mac OS)/.test(t),a=/(?:Android)/.test(t),u=/(?:Windows Phone)/.test(t),l=o&&/(?:iPad)/.test(t),s=o&&/(?:iPhone)/.test(t),f=/(?:Tablet|PlayBook)/.test(t)||l,c=/(?:Mobile)/.test(t)&&!l||u,d=!c&&!f,g={},h=function(){g.isQB=e,g.isUC=n,g.isSafari=i,g.isOpera=r,g.isIOS=o,g.isAndroid=a,g.isWindowsPhone=u,g.isIPad=l,g.isIPhone=s,g.isTablet=f,g.isMobile=c,g.isPc=d},v=function(){return t=navigator.userAgent,e=/(?:MQQBrowser|QQ)/.test(t),n=/(?:UCWEB|UCBrowser)/.test(t),i=/(?:Safari)/.test(t),r=/(?:Opera Mini)/.test(t),o=/(?:Mac OS)/.test(t),a=/(?:Android)/.test(t),u=/(?:Windows Phone)/.test(t),l=o&&/(?:iPad)/.test(t),s=o&&/(?:iPhone)/.test(t),f=/(?:Tablet|PlayBook)/.test(t)||l,c=/(?:Mobile)/.test(t)&&!l||u,d=!c&&!f,h(),g};return g.refresh=v,g}();ctx.View.util={setDftValue:setDftValue,defineReadOnlyProperty:defineReadOnlyProperty,try2Apply:try2Apply,try2Call:try2Call,isEmptyString:isEmptyString,isNullOrUndefined:isNullOrUndefined,ifStringEquals:ifStringEquals,ifStringEqualsIgnoreCase:ifStringEqualsIgnoreCase,randomString:randomString,xEncodeURIComponent:xEncodeURIComponent,getUniqueString:getUniqueString,env:env}}(window,"View"),function(t,e){var n=t.View.util,i=t.View.Logger,r=i.globalLogger,o=function(){var t=[],e=function(){var e;return function(i){clearTimeout(e),e=setTimeout(function(){for(var e=0;e<t.length;e++)n.try2Call(t[e],null,i)},20)}}(),i=function(){var t=document.documentElement;return t.clientWidth<=t.clientHeight},o=function(){var t=document.documentElement;return t.clientWidth>t.clientHeight},a=function(){var t=!1,n=-1,r=i(),o=function(){t=!0,n=Date.now()},u=function(){t=!1,n=-1},l=function(t){r==i()?setTimeout(a,20):(u(),r=i(),e(t))};return u(),function(e){if(t){Date.now()-n<500?l(e):u()}else o(),l(e)}}(),u=function(){var t,n=0,i=0,r=function(){n=0,i=0},o=function(){clearTimeout(t),t=setTimeout(e,20)},a=function(){var t=window.innerWidth,e=window.innerHeight,r=Math.abs(t-n);(0==n||r<.01&&e>i)&&(n=t,i=e,o())};return a.reset=r,a.try2ExecChangeCallbacks=o,a}();!function(){var t,i=null,o=function(){u.reset(),clearInterval(t),t=null},l=function(){o(),t=setInterval(u,50)};return function(){setInterval(function(){n.env.refresh(),n.env.isPc?("pc"!=i&&(r.debug("Page viewing mode to PC mode."),o(),window.removeEventListener("orientationchange",a),e(),window.addEventListener("resize",e)),i="pc"):("!pc"!=i&&(r.debug("Page viewing mode to none-PC mode."),window.removeEventListener("resize",e),e(),window.addEventListener("orientationchange",a),l()),i="!pc")},30)}}()();var l=function(e){t.indexOf(e)==-1&&t.push(e)},s={isPortrait:i,isLandscape:o,addChangeListener:l};return Object.freeze&&Object.freeze(s),s}();t.View.resolution=o}(window),function(t,e){var n=t.View.util,i=t.View.resolution,r=function(){var t=320/568,e=!0,r=[],o={},a=document.documentElement,u=function(){return a.querySelector("[data-view-container]")||document.body},l=function(){return u().clientWidth},s=function(){return u().clientHeight},f=function(){return window.innerWidth||a.clientWidth},c=function(){return window.innerHeight||a.clientHeight},d=function(){return l()<=s()},g=function(){return!isPortrait()},h=function(){return f()<=c()},v=function(){return!h()},w=function(){return f()/c()},p=function(){return f()/c()},m=function(){return t},y=function(e){return t=e,o},b=function(t,e){var n=this,i=n.style;i.width=t+"px",i.height=e+"px"},S=b,E=S,V=E,I=S,A=I,C=V,O=C,L=S,P=L,T=V,x=T,D=function(){var t=f(),e=c(),i=v()?V:S;n.try2Call(i,u(),t,e)},N=function(){var t=f(),e=c(),i=v()?O:A;n.try2Call(i,u(),t,e)},R=function(){var e=f(),i=c();h()?n.try2Call(P,u(),e,i):x===T?(e=i*t,n.try2Call(S,u(),e,i)):n.try2Call(x,u(),e,i)},W=function(t){if(r.indexOf(t)==-1)return r.push(t),o},k=function(t){var e=r.indexOf(t);if(e!=-1)return r.splice(e,1),o},q=function(){var t=l(),e=s();return function(i){arguments.length<1&&(i=!0),n.env.isPc?R():n.env.isTablet?N():D();var a=l(),u=s(),d=f(),g=c();if(Math.abs(t-a)>=.1||Math.abs(e-u)>=.1){var h=function(){for(var t=0;t<r.length;t++){var e=r[t];"function"==typeof e&&n.try2Call(e,null,a,u,d,g)}};i?setTimeout(h,0):h()}return o}}(),H=function(t){return t=n.setDftValue(t,{autoReLayoutWhenResize:!0,layoutAsMobilePortrait:S,layoutAsMobileLandscape:V,layoutAsTabletLandscape:O,layoutAsTabletPortrait:A,layoutAsPcPortrait:P,layoutAsPcLandscape:x}),e=!!t.autoReLayoutWhenResize,e&&i.addChangeListener(q),"function"==typeof t.layoutAsMobilePortrait&&(S=t.layoutAsMobilePortrait),"function"==typeof t.layoutAsMobileLandscape&&(V=t.layoutAsMobileLandscape),"function"==typeof t.layoutAsTabletPortrait&&(A=t.layoutAsTabletPortrait),"function"==typeof t.layoutAsTabletLandscape&&(O=t.layoutAsTabletLandscape),"function"==typeof t.layoutAsPcPortrait&&(P=t.layoutAsPcPortrait),"function"==typeof t.layoutAsPcLandscape&&(x=t.layoutAsPcLandscape),o};return(0,n.setDftValue)(o,{getLayoutWidth:l,getLayoutHeight:s,getBrowserWidth:f,getBrowserHeight:c,isLayoutPortrait:d,isLayoutLandscape:g,isBrowserPortrait:h,isBrowserLandscape:v,getLayoutWidthHeightRatio:w,getBrowserWidthHeightRatio:p,getExpectedWidthHeightRatio:m,setExpectedWidthHeightRatio:y,init:H,doLayout:q,addLayoutChangeListener:W,removeLayoutChangeListener:k}),Object.freeze&&Object.freeze(o),o}();t.View.layout=r}(window),function(t,e){var n=t.View.util,i=function(){var t=/mobile|tablet|ip(ad|hone|od)|android/i,e=(window,t.test(navigator.userAgent)),i="  __com.soft.plugin.touch#"+(new Date).getTime()+"__  ",r=function(t,e){return t=t||{},t[e]=t[e]||{},t[e]};return{addTapListener:function(t,o,a){if(!e)return void(t.addEventListener?t.addEventListener("click",o):t.attachEvent("onclick",o));var u=r(t,i+".tap");if(u.callbacks=u.callbacks||[],u.callbacks.indexOf(o)==-1){u.callbacks.push(o),a=n.setDftValue(a,{timespan:500,delta:{},useCapture:!1}),a.delta=n.setDftValue(a.delta,{x:10,y:15});var l=r(t,i+".tap.meta");null==l.touchstart&&(l.touchstart=function(t){var e=t.changedTouches?t.changedTouches[0]:t;u.startX=e.screenX,u.startY=e.screenY,u.startTimestamp=Date.now()},t.addEventListener("touchstart",l.touchstart)),null==l.touchend&&(l.touchend=function(e){var i=e.changedTouches?e.changedTouches[0]:e;u.stopX=i.screenX,u.stopY=i.screenY,u.stopTimestamp=Date.now();var r=u.stopTimestamp-u.startTimestamp,o=Math.abs(u.stopX-u.startX),l=Math.abs(u.stopY-u.startY);if(r<=a.timespan&&o<=a.delta.x&&l<=a.delta.y)for(var s=0;s<u.callbacks.length;s++)n.try2Call(u.callbacks[s],t,e)},t.addEventListener("touchend",l.touchend,a.useCapture))}},removeTapListener:function(t,n,o){if(!e)return void(t.removeEventListener?t.removeEventListener("click",n):t.detachEvent("onclick",n));if(t.hasOwnProperty(i)){var a=r(t,i+".tap"),u=a.callbacks.indexOf(n);if(u!=-1&&(a.callbacks.splice(u,1),0==a.callbacks.length)){var l=r(t,i+".tap.meta");t.removeEventListener("touchstart",l.touchstart),t.removeEventListener("touchend",l.touchend,o),delete t[i].tap}}}}}();t.View.touch=i}(window),function(t,e){var n=t.View.util,i=function(){var t={};n.defineReadOnlyProperty(this,"has",function(e){return e in t}),n.defineReadOnlyProperty(this,"set",function(e,n){return t[e]=n,this}),n.defineReadOnlyProperty(this,"get",function(e){return t[e]}),n.defineReadOnlyProperty(this,"remove",function(e){var n=t[e];return delete t[e],n}),n.defineReadOnlyProperty(this,"clear",function(){return t={},this})};t.View.ViewContext=i}(window),function(t,e){var n=t.View.Logger.globalLogger,i={},r=function(t,e){var r,o=t,a=i;this.getName=function(){return o},this.getValue=function(t){if(i==a){if(arguments.length<1)return;return t}return a},this.setValue=function(t,e){return arguments.length<2&&(e=!1),(e||i==a)&&(a=t),this},this.getApplication=function(){return r},this.setApplication=function(t){return"function"!=typeof t?(n.warn("Configuration application should be of type: 'Function'."),this):(r=t,this)},this.apply=function(){if("function"==typeof r)try{r.call(this,a)}catch(i){n.error("Fail to apply configuration: {} = {} for view of id: {}\n{}",t,String(a),e,i),i instanceof Error?console.error(i,i.stack):console.error(i)}return this},this.reflectToDom=function(){return null==e||""==e.trim()?this:View.ifExists(e)?(View.ofId(e).getDomElement().setAttribute("data-viewconfig_"+this.getName(),String(this.getValue())),this):(n.warn("No view of id '{}' found to reflect view config: {}={}.",e,this.getName(),this.getValue()),this)},Object.freeze(this)};t.View.ViewConfiguration=r}(window),function(t,e){var n=t.View.util,i=t.View.ViewConfiguration,r=function(t){var e={};this.has=function(t){return t in e},this.get=function(n){var r;return n in e?r=e[n]:(r=new i(n,t),e[n]=r),r},this.applyAll=function(){var t=Object.keys(e).map(function(t){return e[t]});if(0!=t.length)return setTimeout(function(){for(var e=0;e<t.length;e++){var i=t[e];n.try2Call(i.apply,i)}},0),this},this.listAll=function(){return Object.keys(e)}};t.View.ViewConfigurationSet=r}(window),function(t,e){var n=t.View.util,i=t.View.layout,r=t.View.Logger.globalLogger,o=document.documentElement,a={},u=function(){var t={},e=-1,u=-1,l=0,s=0,f=function(t){var f=function(){},c=!0,d=50,g=a;n.defineReadOnlyProperty(this,"setLayoutAction",function(e){return"function"!=typeof e?(r.error("Layout action for view of id: {} should be of type: Function.",t),this):(f!=e&&(g=a,f=e),this)}),n.defineReadOnlyProperty(this,"getLayoutAction",function(){return f}),n.defineReadOnlyProperty(this,"doLayout",function(){return"function"!=typeof f?this:((Math.abs(l-e)>.05||Math.abs(s-u)>.05)&&(o.offsetWidth=o.offsetHeight),f(),e=l,u=s,this)}),n.defineReadOnlyProperty(this,"setLayoutCushionTime",function(t){return null==t||isNaN(t=Number(t))||t<0?(r.error("Invalid layout cushion time. Should be a digit greater than or equal to 0."),this):(d=t,this)}),n.defineReadOnlyProperty(this,"getLayoutCushionTime",function(t){return d}),n.defineReadOnlyProperty(this,"setIfLayoutWhenLayoutChanges",function(t){return c=t,this});var h,v=this;i.addLayoutChangeListener(function(e,n){c&&View.ofId(t).isActive()&&(r.debug("Layout changes, doing layout for view of id: {}. Width: {}, height: {}",t,e,n),l=e,s=n,clearTimeout(h),d>0?h=setTimeout(function(){v.doLayout()},d):v.doLayout())})};return f.ofId=function(e){if(e in t)return t[e];var n=new f(e);return t[e]=n,n},f.implIsPortrait=function(t){return r.warn("This method is redundant and deprecated and will be removed in the future."),f},f}();t.View.ViewLayout=u}(window),function(t,e){var n=t.View.util,i=function(){var t=n.randomString("ViewState_"),e=function(e,i,r){arguments.length<3&&(r=null),arguments.length<2&&(i=n.getUniqueString()),i=i||n.getUniqueString(),n.defineReadOnlyProperty(this,"viewId",e),n.defineReadOnlyProperty(this,"sn",i),n.defineReadOnlyProperty(this,"options",r),n.defineReadOnlyProperty(this,"flag",t),this.toString=function(){return JSON.stringify(this)},this.clone=function(){return JSON.parse(this.toString())}};return e.isConstructorOf=function(t){return null!=t&&"object"==typeof t&&(t.hasOwnProperty("viewId")&&t.hasOwnProperty("sn")&&String(t.flag).startsWith("ViewState_"))},e}();t.View.ViewState=i}(window),function(t,e){var n=t.View.util,i=function(){var t=n.randomString("OperationState_"),e=function(e,i){arguments.length<2&&(timeBasedUniqueString=n.getUniqueString()),timeBasedUniqueString=timeBasedUniqueString||n.getUniqueString(),n.defineReadOnlyProperty(this,"serialNumber",e),n.defineReadOnlyProperty(this,"sn",timeBasedUniqueString),n.defineReadOnlyProperty(this,"flag",t),this.toString=function(){return JSON.stringify(this)},this.clone=function(){return JSON.parse(this.toString())}};e.isConstructorOf=function(t){return null!=t&&"object"==typeof t&&(t.hasOwnProperty("serialNumber")&&t.hasOwnProperty("sn")&&String(t.flag).startsWith("OperationState_"))};var r=null,o={};return e.pushState=function(t,e){var n=new i(t).clone();history.pushState(n,"",""),r=n,o[t]=e},window.addEventListener("popstate",function(t){if(e.isConstructorOf(r)){var i=t.state&&t.state.sn&&t.state.sn<r.sn,a=o[r.serialNumber];i&&null!=a&&(n.try2Call(a),delete o[r.serialNumber])}var u=t.state;r=e.isConstructorOf(u)?u:null}),e}();t.View.OperationState=i}(window),function(t,e){var n=t.View.util,i=t.View.Logger,r=t.View.eventDrive,o=(i.globalLogger,{}),a=n.randomString("__ViewWantedDataListenFlag__"),u=(n.randomString("_@sep@_"),{}),l=function(t){var e=o;r(this,this);var i=this;this.want=function(t,i){return this.isFulfilled()?n.try2Call(t,null,e,{dataResolveMethod:"provideExisting"}):n.try2Call(i),this},this.listen=function(t){return this.isFulfilled()&&n.try2Call(t,null,e),"function"!=typeof t[a]&&(t[a]=function(e){n.try2Call(t,null,e.data)}),i.on("fulfilled",t[a]),this},this.fulfill=function(t){return e=t,this.fire("fulfilled",t),this},this.isFulfilled=function(){return o!==e}},s=function(t){if(t in u)throw new Error("Instance for view of id: "+t+" exists already.");var e={};this.ofName=function(t){return t in e?e[t]:(e[t]=new l(t),e[t])},this.want=function(t,e,n){return this.ofName(t).want(e,n)},this.listen=function(t,e){return this.ofName(t).listen(e)},this.fulfill=function(t,e){return this.ofName(t).fulfill(e)},this.isFulfilled=function(t){return this.ofName(t).isFulfilled()},u[t]=this};s.ofName=function(t,e){return t in u?u[t].ofName(e):(u[t]=new s(t)).ofName(e)},t.View.ViewWantedData=s}(window),function(t,e){var n=t[e].util,i=t[e].eventDrive,r=(t[e].util.env,t[e].Logger),o=t[e].touch,a=t[e].layout,u=t[e].ViewState,l=t[e].OperationState,s=t[e].ViewConfigurationSet,f=t[e].ViewContext,c=t[e].ViewLayout,d=t[e].ViewWantedData,g=r.globalLogger,h=document.documentElement,v=(new Object,[]),w=[],p={},m=null,y="320/568",b="pushState"in history&&"function"==typeof history.pushState;g.log("History pushState is "+(b?"":"not ")+"supported");var S=function(t){return":back"==t||":forward"==t||":default-view"==t},E=function(t,e){if(!D.ifExists(t)&&!S(t))throw new Error("View of id: "+t+" does not exist.");if(void 0===e&&(e=null),"object"!=typeof e)throw new Error("Parameters specified should be an object or null.");return p[t]=e,D},V=function(t){return delete p[t],D},I=function(){return document.querySelectorAll("*[data-view=true]")},A=function(t){return document.querySelector("#"+t+"[data-view=true]")},C=function(t,e){var i=String(t),r=null==e?[]:Object.keys(e),o=r.reduce(function(t,i,r,o){return t+"&"+n.xEncodeURIComponent(i)+"="+n.xEncodeURIComponent(e[i])},"");return o.length>0&&(i+="!"+o.substring(1)),i},O=function(t,e,i){arguments.length<3&&(i=null),arguments.length<2&&(e=n.getUniqueString()),e=e||n.getUniqueString();var r=new u(t,e,i).clone();g.log("↓ {}",JSON.stringify(r)),b?history.pushState(r,"","#"+C(t,i)):location.hash=C(t,i),D.currentState=r},L=function(t,e,i){arguments.length<3&&(i=null),arguments.length<2&&(e=n.getUniqueString()),e=e||n.getUniqueString();var r=new u(t,e,i).clone();g.log("% {}",JSON.stringify(r)),b?history.replaceState(r,"","#"+C(t,i)):location.hash=C(t,i),D.currentState=r},P=function(t){if(null==t||""==String(t).trim())return null;var e=null,n=t.split(/\s*&\s*/);return 0!=n.length&&(e={},n.forEach(function(t){var n=t.split(/\s*=\s*/);e[decodeURIComponent(n[0])]=decodeURIComponent(n[1])})),e},T=function(t){if(""==t)return null;var e=t.match(/^#([\w\$\-]+)(?:!+(.*))?/);if(null==e)return null;var n=(e[1],P(e[2]));return{viewId:e[1],options:n}},x=function(){return null==D.currentState?null:D.currentState.viewId},D=function(t){if(null===document.querySelector("#"+t+"[data-view=true]"))throw new Error("View of id: "+t+" does not exist(No element matching pattern: '#"+t+"[data-view=true]' found)!");var e={},o=new f,a=new s(t),u=new d(t);i(this,document.querySelector("#"+t));var l=this.fire;this.fire=function(t,n,i){e[t]=n,l(t,n,i)},n.defineReadOnlyProperty(this,"logger",r.ofName("View#"+t)),n.defineReadOnlyProperty(this,"config",a),n.defineReadOnlyProperty(this,"context",o),this.getLatestEventData=function(t){return e[t]},this.getContext=function(){return o},this.clearContext=function(){return o.clear(),this},this.getId=function(){return t},this.getDomElement=function(){return document.querySelector("#"+t)},this.getGroupName=function(){var t=this.getDomElement().getAttribute("data-view-group");return null==t?t:String(t).toLowerCase()},this.find=function(t){return this.getDomElement().querySelector(t)},this.findAll=function(t){return this.getDomElement().querySelectorAll(t)},this.fulfillWantedData=function(t,e){var i=t+":fulFillCallback",r=this.getParameter(i);return"function"==typeof r&&(g.info("Found auto attached(by 'View.want()' method) fulfill listener(parameter name: '{}'), auto execute this listener with fulfilled data.",i),n.try2Call(r,null,e,{dataResolveMethod:"resolveLater"})),u.fulfill(t,e),this},this.isWantedDataFulfilled=function(t){return u.isFulfilled(t)},this.setLayoutAction=function(e,n){return arguments.length<2&&(n=!0),c.ofId(t).setIfLayoutWhenLayoutChanges(!!n).setLayoutAction(e),this},this.getLayoutAction=function(){return c.ofId(t).getLayoutAction()},this.hasParameter=function(t){if(null===t||void 0===t)return!1;var e=p[this.getId()];return null!=e&&t in e},this.getParameter=function(t){var e=p[this.getId()];return arguments.length<1?e:null==e?null:e[t]},this.seekParameter=function(t){if(this.hasParameter(t))return this.getParameter(t);if(D.hasActiveViewOption(t))return D.getActiveViewOption(t);var e=new RegExp("\\b"+t+"\\b=([^&\\?]*)"),n=location.search.match(e);return null==n?null:n=decodeURIComponent(n[1])},this.isReady=function(){return w.indexOf(this.getId())!=-1},this.isActive=function(){return this.getDomElement().classList.contains("active")},this.isDefault=function(){return/true/i.test(this.getDomElement().getAttribute("data-view-default"))},this.isDirectlyAccessible=function(){var t=this.getDomElement().getAttribute("data-view-directly-accessible");return t=null==t?null:t.toLowerCase(),D.isDirectlyAccessible()?"false"!=t:"true"==t},this.setAsDirectlyAccessible=function(t){return arguments.lengt<1&&(t=!0),this.getDomElement().setAttribute("data-view-directly-accessible",String(t)),this},this.setTitle=function(t){return null==t?(this.getDomElement().removeAttribute("data-view-title"),this):(t=String(t),this.getDomElement().setAttribute("data-view-title",t),this.isActive()&&(document.title=t),this)},this.getTitle=function(t){return this.getDomElement().getAttribute("data-view-title")},this.setFallbackViewId=function(t){if(null==t||""==t.trim())return this;if(n.ifStringEqualsIgnoreCase(":default-view",t)){var e=D.getDefaultView();if(null==e)return g.error("No default view found."),this;t=e.getId()}else if(/^~/.test(t)){var i=t.substring(1),r=k(i);if(null==r)return g.warn("No view of group: {} found.",i),this;t=r}return D.ifExists(t)?this.getId()==t?this:(this.getDomElement().setAttribute("data-view-fallback",t),this):(g.warn("No view of id: {} found.",t),this)},this.getFallbackView=function(){for(var t=this,e=[this.getId()];;){var i=t.getDomElement().getAttribute("data-view-fallback");if(n.ifStringEqualsIgnoreCase(":default-view",i))return D.getDefaultView();if(/^~/.test(i)){var r=i.substring(1),o=k(r);if(null==o)return D.getDefaultView();i=o}if(null==i||!D.ifExists(i))return g.warn("View: "+t.getId()+" is not permited to access directly, and no fallback configuration found, thus returning the default view"),D.getDefaultView();if(t=D.ofId(i),e.indexOf(t.getId())!=-1)return g.error("Cyclical reference of view on fallback configuration on view: {}. Chain: {}, view id: {}",this.getId(),e,t.getId()),D.getDefaultView();if(t.isDirectlyAccessible())return t;e.push(i)}},Object.freeze&&Object.freeze(this)};n.defineReadOnlyProperty(D,"SWITCHTYPE_HISTORYFORWARD","history.forward"),n.defineReadOnlyProperty(D,"SWITCHTYPE_HISTORYBACK","history.back"),n.defineReadOnlyProperty(D,"SWITCHTYPE_VIEWNAV","view.nav"),n.defineReadOnlyProperty(D,"SWITCHTYPE_VIEWCHANGE","view.change");var N=function(t){null!=t&&""!=String(t).trim()||(t=D.SWITCHTYPE_VIEWNAV);var e=n.ifStringEqualsIgnoreCase(t,D.SWITCHTYPE_VIEWNAV),i=n.ifStringEqualsIgnoreCase(t,D.SWITCHTYPE_VIEWCHANGE),r=n.ifStringEqualsIgnoreCase(t,D.SWITCHTYPE_HISTORYBACK),o=n.ifStringEqualsIgnoreCase(t,D.SWITCHTYPE_HISTORYFORWARD);return r||o||e||i||(t=D.SWITCHTYPE_VIEWNAV),t};D.currentState=null,D.Logger=r,D.layout=a,i(D),D.getViewContainerDomElement=function(){var t=document.querySelector("[data-view-container]");return null==t&&(t=document.body),t},D.ofId=function(t){for(var e=0;e<v.length;e++)if(v[e].getId().trim()==t.trim())return v[e];var n=new D(t);return v.push(n),n},D.ifExists=function(t){for(var e=0;e<v.length;e++)if(v[e].getId().trim()==t.trim())return!0;return!1},D.isExisting=function(){return g.warn("This is method is deprecated, please use 'View.ifExists' instead."),D.ifExists.apply(D,arguments)},D.listAll=function(t){arguments.length>1&&(t=String(t).toLowerCase());var e=[].concat(v);return arguments.length<1||""==t?e:e.filter(function(e){return t==e.getGroupName()})},D.listAllGroups=function(){return D.listAll().reduce(function(t,e){var n=e.getGroupName();return null==n||""==String(n).trim()||t.indexOf(n)!=-1?t:(t.push(n),t)},[])},D.setAsDefault=function(t){if(n.isEmptyString(t,!0))return g.warn("No view id supplied to set as default."),D;for(var e=I(),i=0;i<e.length;i++)e[i].removeAttribute("data-view-default");var r=A(t);return null==r?(g.error("No view dom element of id: {} found to set as default.",t),D):(r.setAttribute("data-view-default","true"),D)},D.isDirectlyAccessible=function(){var t=h.getAttribute("data-view-directly-accessible");return n.ifStringEqualsIgnoreCase("true",t)},D.setIsDirectlyAccessible=function(t){return h.setAttribute("data-view-directly-accessible",String(!!t).toLowerCase()),D},D.getActiveView=function(){for(var t=0;t<v.length;t++)if(v[t].isActive())return v[t];return null},D.getDefaultView=function(){for(var t=0;t<v.length;t++)if(v[t].isDefault())return v[t];return null},D.setSwitchAnimation=function(t){if(!(t instanceof Function))throw new Error("Invalid argument. Animation of Function is needed.");return m=t,D},D.getSwitchAnimation=function(){return m},D.getActiveViewOptions=function(){var t=T(location.hash);return null==t?null:t.options},D.hasActiveViewOption=function(t){var e=D.getActiveViewOptions();return null!=e&&t in e},D.getActiveViewOption=function(t){var e=D.getActiveViewOptions();return null==e?null:e[t]},D.setActiveViewOption=function(t,e){if(null==t||""==String(t).trim())return g.error("Option name should not be empty."),D;var n=D.getActiveView();if(null==n)return g.error("No active view to set option {} = {}.",t,e),D;t=String(t).trim(),e=String(e).trim();var i=D.getActiveViewOptions()||{};return i[t]=e,L(n.getId(),D.currentState?D.currentState.sn:null,i),D},D.wantData=function(t,e,n,i){var r=d.ofName(t,e);if("function"!=typeof i){var o=e+":fulFillCallback";g.info("No parameter meaning 'callback for situation that wanted data is currently not fulfilled' specified, auto assign as View.navTo('{}', {params: {'{}': function(){...}}})",t,o);var a={};a[o]=n,i=function(){D.navTo(t,{params:a})}}return r.want(n,i),D},D.listenWantedData=function(t,e,n){return d.ofName(t,e).listen(n),D},D.implIsPortrait=function(){return c.implIsPortrait.apply(c,arguments),D};var R=function(t){t=n.setDftValue(t,{srcView:null,targetView:null,type:D.SWITCHTYPE_VIEWNAV,withAnimation:!0,params:null});var e=t.srcView,i=t.targetView,r=N(t.type),o=t.params,a=n.ifStringEqualsIgnoreCase(r,D.SWITCHTYPE_HISTORYBACK),u=n.ifStringEqualsIgnoreCase(r,D.SWITCHTYPE_HISTORYFORWARD),l={currentView:e,targetView:i,type:r,params:o},s=function(){var t=i.getId();V(t),a?":back"in p&&(E(t,p[":back"]),delete p[":back"]):u?":forward"in p&&(E(t,p[":forward"]),delete p[":forward"]):E(t,o);var n={sourceView:e,type:r,params:o},s=function(t,e){try{i.fire(t,n,e)}catch(e){g.error("Error occured while firing event: {} with data: {}",t,n),e instanceof Error?console.error(e,e.stack):console.error(e)}};e&&e.getDomElement().classList.remove("active"),e&&e.fire("leave",{targetView:i,type:r}),s("beforeenter",!1),i.getDomElement().classList.add("active"),c.ofId(t).doLayout(),D.fire("change",l,!1),i.isReady()||(w.push(t),s("ready",!1)),s("enter",!1),s("afterenter",!1),D.fire("afterchange",l)};D.fire("beforechange",l,!1),t.withAnimation&&m?m.call(null,e?e.getDomElement():null,i.getDomElement(),r,s):s()},W=function(t,e){if(e=n.setDftValue(e,{},!0),!D.ifExists(t))throw g.log("Trying to navigate to view: {} with params: {}, options: {}",t,e.params,e.options),new Error("Target view: "+t+" does not exist!");var i=D.getActiveView();g.log("{} → {} {}",i?i.getId():null,t,JSON.stringify(e));var r=D.ofId(t);return e.srcView=i,e.targetView=r,R(e),D};D.show=W;var k=function(t){if(null==t||""==String(t).trim())return g.error("Empty view group name!."),null;t=String(t).trim().toLowerCase();var e=D.listAll(t);if(null==e||0==e.length)return g.error("No view of group: {} found.",t),null;var n=e.map(function(t){return t.getId()});return targetViewId=n[0],g.info("Found {} views of group: {}: {}, using the first one: {}.",n.length,t,n,targetViewId),targetViewId};D.navTo=function(t,e){t=t.trim(),e=n.setDftValue(e,{});x(),D.getActiveView();if(n.ifStringEqualsIgnoreCase(":back",t))return D.back(e),D;if(n.ifStringEqualsIgnoreCase(":forward",t))return D.forward(e),D;if(n.ifStringEqualsIgnoreCase(":default-view",t)){var i=D.getDefaultView();if(null==i)return g.error("No default view found."),D;t=i.getId()}if(/^~/.test(t)){var r=t.substring(1),o=k(r);if(null==o)return D;t=o}if(!D.ifExists(t)){g.log("Trying to navigate to view: {} with params: {}, options: {}",t,e.params,e.options);var a=new Error("Target view: "+t+" does not exist! Firing event 'viewnotexist'...");return console.error(a),D.fire("viewnotexist",{targetViewId:t}),D}return e.type=D.SWITCHTYPE_VIEWNAV,O(t,null,null==e?null:e.options),W(t,e),D},D.changeTo=function(t,e){e=n.setDftValue(e,{});x(),D.getActiveView();if(n.ifStringEqualsIgnoreCase(":default-view",t)){var i=D.getDefaultView();if(null==i)return void g.error("No default view found.");t=i.getId()}if(/^~/.test(t)){var r=t.substring(1),o=k(r);if(null==o)return D;t=o}if(!D.ifExists(t)){g.log("Trying to navigate to view: {} with params: {}, options: {}",t,e.params,e.options);var a=new Error("Target view: "+t+" does not exist! Firing event 'viewnotexist'...");return console.error(a),D.fire("viewnotexist",{targetViewId:t}),D}return e.type=D.SWITCHTYPE_VIEWCHANGE,L(t,null,null==e?null:e.options),W(t,e),D},D.back=function(t){return V(":back"),null!=t&&"params"in t&&E(":back",t.params),history.go(-1),D},D.forward=function(t){return V(":forward"),
null!=t&&"params"in t&&E(":forward",t.params),history.go(1),D};var q=document.title,H=function(t){return n.isEmptyString(t,!0)?(g.warn("Invalid document title: "+t),D):(document.title=q=t,D)};D.setDocumentTitle=H,D.onceHistoryBack=function(t){if("function"!=typeof t)throw new Error("Invalid argument! Type of 'Function' is needed.");return l.pushState(n.randomString(),t),D};var U,Y,_,M,F,j=!1,B=!1,z=function(){var t=D.getActiveView();return null==t&&(t=D.getDefaultView()),t},J=function(t){var e=null;return n.isEmptyString(t,!0)||!D.ifExists(t)?e=z():(e=D.ofId(t),e.isDirectlyAccessible()||(e=e.getFallbackView())),e},G=function(t){var e=D.getActiveView(),n=null==e?null:e.getId();g.log("{} Current: {}",b?"State poped!":"Hash changed!",e&&e.getId()),g.log("↑ {}",b?JSON.stringify(t.state):location.hash);var i,r,o=D.SWITCHTYPE_VIEWNAV,a=null;if(null==t.state){o=D.SWITCHTYPE_VIEWNAV;var l,s=T(location.hash);if(null==s?(a=e,l=n):(i=s.viewId,null!=(a=J(i))&&(l=a.getId())),null!=l){var f=l==i;r=l==n?D.currentState?D.currentState.options:null:f?s.options:null,L(l,null,r),D.show(a.getId(),{type:o,options:r})}}else if(u.isConstructorOf(t.state)){var c=t.state;i=c.viewId,D.ifExists(i)?(a=D.ofId(i),r=c.options):(g.warn("Poped view: "+i+" does not exist, keeping current."),a=e,r=null);var l=a.getId();null!=D.currentState&&(o=c.sn<D.currentState.sn?D.SWITCHTYPE_HISTORYBACK:D.SWITCHTYPE_HISTORYFORWARD),L(l,c.sn,r),D.show(a.getId(),{type:o,options:r})}else g.info("Skip state: {}",t.state)},Q=function(){U(),h.setAttribute("data-view-os",n.env.isIOS?"ios":n.env.isAndroid?"android":n.env.isWindowsPhone?"wp":"unknown"),window.addEventListener(b?"popstate":"hashchange",G),function(){var t=document.querySelectorAll("[data-view-container]");if(0==t.length)document.body.setAttribute("data-view-container","");else for(var e=1;e<t.length;e++)t[e].removeAttribute("data-view-container")}();var t=I();[].forEach.call(t,function(t){D.ofId(t.id),t.classList.remove("active"),t.classList.add("view"),function(){D.ofId(t.id).on("enter",function(){var e=t.getAttribute("data-view-title");document.title=null==e?q:e})}()});var e=null;e=function(){for(var e=null,n=-1,i=0;i<t.length;i++)if("true"==t[i].getAttribute("data-view-default")){n=i;break}if(-1!=n){e=t[n];for(var i=n+1;i<t.length;i++)"true"==t[i].getAttribute("data-view-default")&&t[i].removeAttribute("data-view-default")}else 0!=t.length?(e=t[0],e.setAttribute("data-view-default","true")):g.warn("No view exists to determine the default view.");return e}(),null!=e&&e.classList.add("active"),function(){o.addTapListener(h,function(t){for(var e,i=t.changedTouches?t.changedTouches[0].target:t.target,r=i;null==r.getAttribute("data-view-rel")&&(r=r.parentNode,r instanceof HTMLElement||(r=null),null!=r););if(null!=r&&(e=r.getAttribute("data-view-rel")),null!=e&&""!=e.trim()){if(!("true"==r.getAttribute("data-view-rel-disabled"))){if(t.preventDefault(),/^(http|https|ftp):\/\//gim.test(e))return void(window.location.href=e);if(/^\s*@+/.test(e)){var o=e.replace(/^\s*@+/,"").trim();return""==o?void g.warn("Empty file path for data-view-rel: '{}'",e):void(window.location.href=o)}if(n.ifStringEqualsIgnoreCase(":back",e))return void history.go(-1);if(n.ifStringEqualsIgnoreCase(":forward",e))return void history.go(1);if(n.ifStringEqualsIgnoreCase(":default-view",e)){var a=D.getDefaultView();e=null==a?null:a.getId()}var u=null;if(/^~/.test(e)){var l=e.match(/^~([^!]+)(?:!+(.*))?/);if(null==l)return;var s=l[1].trim(),f=P(l[2]),c=k(s);if(null==c)return;e=c,u=f}else{var d=T("#"+e);e=d.viewId,u=d.options}var h=D.getActiveView(),v=(null==h||h.getId(),r.getAttribute("data-view-rel-type"));v=n.isEmptyString(v,!0)?"nav":v,/^(?:nav)|(?:change)$/.test(v)||(g.warn("Unknown view switch type: {}. {}",v,r),v="nav"),D[v+"To"](e,{options:u})}}},{useCapture:!0})}(),function(){var t=document.documentElement.getAttribute("data-view-whr");if(null!=t&&""!==(t=t.trim().toLowerCase())){var e=/(\d+(?:\.\d*)?)\s*\/\s*(\d+(?:\.\d*)?)/i,n=t.match(e);null==n?(g.warn("Invalid view expected width height ratio: {}. Value such as '320/568'(iPhone 5) is valid. Using '{}' instead.",t,y),n=y.exec(e)):g.info("Using specified expected width height ratio: {}",t),a.setExpectedWidthHeightRatio(Number(n[1])/Number(n[2])).init();!function(){for(var t=document.querySelectorAll("input, select, textarea, *[contentEditable]"),e=0;e<t.length;e++)t[e].blur();a.doLayout()}()}}(),g.info("Marking View as initialized and ready"),Y(),_(),function(){if(null!=D.currentState)return void g.debug("Skip showing specified view.");var t=null==e?null:e.id,i=T(location.hash),r=null==i?null:i.viewId,o=null==i?null:i.options,a=null,u=n.isEmptyString(t,!0);if(!n.isEmptyString(r,!0)&&D.ifExists(r)?a=r:(g.warn("No view of id: {}(specified in the location hash) found, trying to show the default view",r),!u&&D.ifExists(t)?a=t:(g.warn("No default view(id: {}) found.",t),a=null)),n.isEmptyString(a,!0))return void g.warn("Can not determine the initial view!");var l=J(a);if(null==l)return void g.error("No final view found for view of id: {}",a);a=l.getId(),a==r||(o=null),g.info("Showing view: {}",a),L(a,null,o);var s=D.getActiveView();R({srcView:s==l?null:s,targetView:l,withAnimation:!1,params:null})}()};D.beforeInit=function(){var t=[];return U=function(){for(var e=0;e<t.length;e++)n.try2Call(t[e]);t=[]},Y=function(){j=!0},function(e){return j?D:t.indexOf(e)!=-1?D:(t.push(e),D)}}(),D.ready=function(){var t=[];return _=function(){B=!0;for(var e=0;e<t.length;e++)n.try2Call(t[e]);t=[]},function(e){return B?(n.try2Call(e),D):t.indexOf(e)!=-1?D:(t.push(e),D)}}(),D.setInitializer=function(t,e){if("function"==typeof t){arguments.length<2&&(e="domready");var n="domready, rightnow".split(/\s*,\s*/);n.indexOf(e)==-1&&(g.warn("Unknown initializer exec time: {}. Supported: {}",e,n),e="domready"),M=t,F=e,j||"rightnow"!=e||(g.info("Calling specified view initializer right now"),t(Q))}},document.addEventListener("DOMContentLoaded",function(){null==M?(g.info("Initializing View automatically"),Q()):"domready"==F&&(g.info("Calling specified view initializer on dom ready"),M(Q))}),t[e]=D}(window,"View");